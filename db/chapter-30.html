<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第30章：AI 应用数据库架构 | 小徐的技术充电站</title>
    <meta name="description" content="小徐技术充电站 - 从零到企业级项目实战">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/simonProjectGuide/assets/style.B7lLaVwf.css" as="style">
    <link rel="preload stylesheet" href="/simonProjectGuide/vp-icons.css" as="style">
    
    <script type="module" src="/simonProjectGuide/assets/app.BQfmDTqa.js"></script>
    <link rel="preload" href="/simonProjectGuide/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/simonProjectGuide/assets/chunks/theme.BtQ-g1HI.js">
    <link rel="modulepreload" href="/simonProjectGuide/assets/chunks/framework.C63nTIu3.js">
    <link rel="modulepreload" href="/simonProjectGuide/assets/db_chapter-30.md.pMa9cJCy.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="theme-color" content="#42b883">
    <meta name="og:type" content="website">
    <meta name="og:locale" content="zh-CN">
    <meta name="og:title" content="小徐的技术充电站">
    <meta name="og:description" content="小徐技术充电站 - 从零到企业级项目实战。">
    <meta name="og:image" content="/og-image.png">
    <link rel="stylesheet" href="/.vitepress/theme/custom.css">
    <script type="module" src="/.vitepress/style/loading.js"></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-41d61863><!--[--><!--]--><!--[--><span tabindex="-1" data-v-05602279></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-05602279>Skip to content</a><!--]--><!----><header class="VPNav" data-v-41d61863 data-v-aeca0f9f><div class="VPNavBar" data-v-aeca0f9f data-v-b4cd3590><div class="wrapper" data-v-b4cd3590><div class="container" data-v-b4cd3590><div class="title" data-v-b4cd3590><div class="VPNavBarTitle has-sidebar" data-v-b4cd3590 data-v-a4d66874><a class="title" href="/simonProjectGuide/" data-v-a4d66874><!--[--><!--]--><!----><span data-v-a4d66874>小徐的技术充电站</span><!--[--><!--]--></a></div></div><div class="content" data-v-b4cd3590><div class="content-body" data-v-b4cd3590><!--[--><!--]--><div class="VPNavBarSearch search" data-v-b4cd3590><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-b4cd3590 data-v-0ae6aabc><span id="main-nav-aria-label" class="visually-hidden" data-v-0ae6aabc> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/simonProjectGuide/" tabindex="0" data-v-0ae6aabc data-v-6811e2e7><!--[--><span data-v-6811e2e7>🏠 首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-0ae6aabc data-v-b2d2dc56><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b2d2dc56><span class="text" data-v-b2d2dc56><!----><span data-v-b2d2dc56>💻 前端全栈</span><span class="vpi-chevron-down text-icon" data-v-b2d2dc56></span></span></button><div class="menu" data-v-b2d2dc56><div class="VPMenu" data-v-b2d2dc56 data-v-fa39d1d9><div class="items" data-v-fa39d1d9><!--[--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/guide/" data-v-44680469><!--[--><span data-v-44680469>📚 学习路线</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/guide/chapter-00.html" data-v-44680469><!--[--><span data-v-44680469>🌱 基础入门</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/guide/chapter-09.html" data-v-44680469><!--[--><span data-v-44680469>🧩 组件开发</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/guide/chapter-16.html" data-v-44680469><!--[--><span data-v-44680469>🏢 企业级开发</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/guide/chapter-25.html" data-v-44680469><!--[--><span data-v-44680469>🚀 进阶之路</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/guide/chapter-40.html" data-v-44680469><!--[--><span data-v-44680469>⭐ 高级拓展</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/guide/chapter-50-project.html" data-v-44680469><!--[--><span data-v-44680469>💼 实战项目</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/guide/appendix-resources.html" data-v-44680469><!--[--><span data-v-44680469>📖 工具速查</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-0ae6aabc data-v-b2d2dc56><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b2d2dc56><span class="text" data-v-b2d2dc56><!----><span data-v-b2d2dc56>☕ Java 架构师之路</span><span class="vpi-chevron-down text-icon" data-v-b2d2dc56></span></span></button><div class="menu" data-v-b2d2dc56><div class="VPMenu" data-v-b2d2dc56 data-v-fa39d1d9><div class="items" data-v-fa39d1d9><!--[--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/java/" data-v-44680469><!--[--><span data-v-44680469>📚 学习路线</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/java/chapter-114.html" data-v-44680469><!--[--><span data-v-44680469>🌱 基础入门</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/java/chapter-124.html" data-v-44680469><!--[--><span data-v-44680469>🌐 Web开发</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/java/chapter-132.html" data-v-44680469><!--[--><span data-v-44680469>🎯 微服务全家桶</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/java/chapter-142.html" data-v-44680469><!--[--><span data-v-44680469>⭐ 高级进阶</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/java/chapter-131.html" data-v-44680469><!--[--><span data-v-44680469>💼 实战项目</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/java/appendix-tools.html" data-v-44680469><!--[--><span data-v-44680469>📖 工具速查</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-0ae6aabc data-v-b2d2dc56><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b2d2dc56><span class="text" data-v-b2d2dc56><!----><span data-v-b2d2dc56>📝 面试通关秘籍</span><span class="vpi-chevron-down text-icon" data-v-b2d2dc56></span></span></button><div class="menu" data-v-b2d2dc56><div class="VPMenu" data-v-b2d2dc56 data-v-fa39d1d9><div class="items" data-v-fa39d1d9><!--[--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/interview/" data-v-44680469><!--[--><span data-v-44680469>📚 学习路线</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/interview/frontend/" data-v-44680469><!--[--><span data-v-44680469>💻 前端面试题</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/interview/java/" data-v-44680469><!--[--><span data-v-44680469>☕ Java面试题</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/interview/ai/" data-v-44680469><!--[--><span data-v-44680469>🤖 AI面试题</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/interview/git/" data-v-44680469><!--[--><span data-v-44680469>🔧 Git面试题</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/interview/devops/" data-v-44680469><!--[--><span data-v-44680469>🚀 DevOps面试题</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-0ae6aabc data-v-b2d2dc56><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b2d2dc56><span class="text" data-v-b2d2dc56><!----><span data-v-b2d2dc56>🔧 Git 完全指南</span><span class="vpi-chevron-down text-icon" data-v-b2d2dc56></span></span></button><div class="menu" data-v-b2d2dc56><div class="VPMenu" data-v-b2d2dc56 data-v-fa39d1d9><div class="items" data-v-fa39d1d9><!--[--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/git/" data-v-44680469><!--[--><span data-v-44680469>📚 学习路线</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/git/chapter-01.html" data-v-44680469><!--[--><span data-v-44680469>🌱 基础入门</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/git/workflow.html" data-v-44680469><!--[--><span data-v-44680469>🔄 进阶实战</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/git/appendix.html" data-v-44680469><!--[--><span data-v-44680469>📖 工具速查</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-0ae6aabc data-v-b2d2dc56><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b2d2dc56><span class="text" data-v-b2d2dc56><!----><span data-v-b2d2dc56>🤖 AI 应用开发</span><span class="vpi-chevron-down text-icon" data-v-b2d2dc56></span></span></button><div class="menu" data-v-b2d2dc56><div class="VPMenu" data-v-b2d2dc56 data-v-fa39d1d9><div class="items" data-v-fa39d1d9><!--[--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/ai/" data-v-44680469><!--[--><span data-v-44680469>📚 学习路线</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/ai/chapter-00.html" data-v-44680469><!--[--><span data-v-44680469>🌱 基础入门</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/ai/chapter-03.html" data-v-44680469><!--[--><span data-v-44680469>⚡ 进阶实战</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/ai/chapter-08-agent-skills.html" data-v-44680469><!--[--><span data-v-44680469>🤖 Agent Skills</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/ai/chapter-08.html" data-v-44680469><!--[--><span data-v-44680469>💼 实战项目</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/ai/chapter-07.html" data-v-44680469><!--[--><span data-v-44680469>🌟 拓展提升</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/ai/appendix-tools.html" data-v-44680469><!--[--><span data-v-44680469>📖 工具速查</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-0ae6aabc data-v-b2d2dc56><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b2d2dc56><span class="text" data-v-b2d2dc56><!----><span data-v-b2d2dc56>🗄️ 数据库完全指南</span><span class="vpi-chevron-down text-icon" data-v-b2d2dc56></span></span></button><div class="menu" data-v-b2d2dc56><div class="VPMenu" data-v-b2d2dc56 data-v-fa39d1d9><div class="items" data-v-fa39d1d9><!--[--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/db/" data-v-44680469><!--[--><span data-v-44680469>📚 学习路线</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/db/chapter-01.html" data-v-44680469><!--[--><span data-v-44680469>🌱 基础入门</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/db/chapter-08.html" data-v-44680469><!--[--><span data-v-44680469>🧩 关系型数据库进阶</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/db/chapter-15.html" data-v-44680469><!--[--><span data-v-44680469>🏢 国产分布式数据库</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/db/chapter-22.html" data-v-44680469><!--[--><span data-v-44680469>🚀 NoSQL与NewSQL</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/db/chapter-27.html" data-v-44680469><!--[--><span data-v-44680469>🤖 时序与向量数据库</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/db/chapter-migration.html" data-v-44680469><!--[--><span data-v-44680469>🔄 迁移与备份实战</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-0ae6aabc data-v-b2d2dc56><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b2d2dc56><span class="text" data-v-b2d2dc56><!----><span data-v-b2d2dc56>🚀 DevOps 实战</span><span class="vpi-chevron-down text-icon" data-v-b2d2dc56></span></span></button><div class="menu" data-v-b2d2dc56><div class="VPMenu" data-v-b2d2dc56 data-v-fa39d1d9><div class="items" data-v-fa39d1d9><!--[--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/" data-v-44680469><!--[--><span data-v-44680469>📚 学习路线</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/chapter-01.html" data-v-44680469><!--[--><span data-v-44680469>🌱 基础入门</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/chapter-05.html" data-v-44680469><!--[--><span data-v-44680469>🐳 容器化编排</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/chapter-08.html" data-v-44680469><!--[--><span data-v-44680469>⚙️ CI/CD自动化</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/chapter-11.html" data-v-44680469><!--[--><span data-v-44680469>📊 监控运维</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/chapter-13.html" data-v-44680469><!--[--><span data-v-44680469>🏗️ 基础设施即代码</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/chapter-14.html" data-v-44680469><!--[--><span data-v-44680469>🔄 GitOps实践</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/chapter-15.html" data-v-44680469><!--[--><span data-v-44680469>🔒 安全实践</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/appendix-project.html" data-v-44680469><!--[--><span data-v-44680469>💼 综合实战项目</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fa39d1d9 data-v-44680469><a class="VPLink link" href="/simonProjectGuide/devops/appendix-tools.html" data-v-44680469><!--[--><span data-v-44680469>📖 工具速查</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-b4cd3590 data-v-2d5b3624><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-2d5b3624 data-v-f07d4e0a data-v-353bc46f><span class="check" data-v-353bc46f><span class="icon" data-v-353bc46f><!--[--><span class="vpi-sun sun" data-v-f07d4e0a></span><span class="vpi-moon moon" data-v-f07d4e0a></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-b4cd3590 data-v-db4f6a72 data-v-667ef305><!--[--><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-b4cd3590 data-v-67eccc95 data-v-b2d2dc56><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b2d2dc56><span class="vpi-more-horizontal icon" data-v-b2d2dc56></span></button><div class="menu" data-v-b2d2dc56><div class="VPMenu" data-v-b2d2dc56 data-v-fa39d1d9><!----><!--[--><!--[--><!----><div class="group" data-v-67eccc95><div class="item appearance" data-v-67eccc95><p class="label" data-v-67eccc95>Appearance</p><div class="appearance-action" data-v-67eccc95><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-67eccc95 data-v-f07d4e0a data-v-353bc46f><span class="check" data-v-353bc46f><span class="icon" data-v-353bc46f><!--[--><span class="vpi-sun sun" data-v-f07d4e0a></span><span class="vpi-moon moon" data-v-f07d4e0a></span><!--]--></span></span></button></div></div></div><div class="group" data-v-67eccc95><div class="item social-links" data-v-67eccc95><div class="VPSocialLinks social-links-list" data-v-67eccc95 data-v-667ef305><!--[--><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-b4cd3590 data-v-f462ea1b><span class="container" data-v-f462ea1b><span class="top" data-v-f462ea1b></span><span class="middle" data-v-f462ea1b></span><span class="bottom" data-v-f462ea1b></span></span></button></div></div></div></div><div class="divider" data-v-b4cd3590><div class="divider-line" data-v-b4cd3590></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-41d61863 data-v-b5ac944a><div class="container" data-v-b5ac944a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b5ac944a><span class="vpi-align-left menu-icon" data-v-b5ac944a></span><span class="menu-text" data-v-b5ac944a>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b5ac944a data-v-402a429b><button data-v-402a429b>回到顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-41d61863 data-v-9f475c00><div class="curtain" data-v-9f475c00></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-9f475c00><span class="visually-hidden" id="sidebar-aria-label" data-v-9f475c00> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-1ec3b14c><section class="VPSidebarItem level-0 collapsible" data-v-1ec3b14c data-v-4af31fea><div class="item" role="button" tabindex="0" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><h2 class="text" data-v-4af31fea>学习路线</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4af31fea><span class="vpi-chevron-right caret-icon" data-v-4af31fea></span></div></div><div class="items" data-v-4af31fea><!--[--><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>学习路线</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-1ec3b14c><section class="VPSidebarItem level-0 collapsible" data-v-1ec3b14c data-v-4af31fea><div class="item" role="button" tabindex="0" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><h2 class="text" data-v-4af31fea>基础入门（第1-7章）</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4af31fea><span class="vpi-chevron-right caret-icon" data-v-4af31fea></span></div></div><div class="items" data-v-4af31fea><!--[--><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-01.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第1章：数据库简介与环境搭建</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-02.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第2章：SQL 核心基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-03.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第3章：MySQL 8.0 快速入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-04.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第4章：PostgreSQL 16 快速入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-05.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第5章：Oracle 快速入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-06.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第6章：Redis 7.x 快速入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-07.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第7章：实战项目1 - 个人博客数据库设计</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-1ec3b14c><section class="VPSidebarItem level-0 collapsible" data-v-1ec3b14c data-v-4af31fea><div class="item" role="button" tabindex="0" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><h2 class="text" data-v-4af31fea>关系型数据库进阶（第8-14章）</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4af31fea><span class="vpi-chevron-right caret-icon" data-v-4af31fea></span></div></div><div class="items" data-v-4af31fea><!--[--><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-08.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第8章：MySQL 8.0+ 新特性深度解析</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-09.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第9章：PostgreSQL 16+ 高级特性</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-10.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第10章：索引优化与性能调优</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-11.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第11章：事务与锁机制</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-12.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第12章：主从复制与高可用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-13.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第13章：实战项目2 - 电商数据库设计</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-14.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第14章：数据库性能调优完全指南</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-1ec3b14c><section class="VPSidebarItem level-0 collapsible" data-v-1ec3b14c data-v-4af31fea><div class="item" role="button" tabindex="0" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><h2 class="text" data-v-4af31fea>国产分布式数据库（第15-21章）</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4af31fea><span class="vpi-chevron-right caret-icon" data-v-4af31fea></span></div></div><div class="items" data-v-4af31fea><!--[--><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-15.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第15章：OceanBase 架构与实践</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-16.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第16章：TiDB HTAP 架构</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-17.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第17章：达梦 DM8 迁移实战</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-18.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第18章：人大金仓 KingbaseES 实战</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-19.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第19章：openGauss 与 GaussDB</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-20.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第20章：TDSQL 腾讯云实践</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-21.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第21章：GBase 南大通用数据库</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-1ec3b14c><section class="VPSidebarItem level-0 collapsible" data-v-1ec3b14c data-v-4af31fea><div class="item" role="button" tabindex="0" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><h2 class="text" data-v-4af31fea>NoSQL 与 NewSQL（第22-26章）</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4af31fea><span class="vpi-chevron-right caret-icon" data-v-4af31fea></span></div></div><div class="items" data-v-4af31fea><!--[--><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-22.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第22章：MongoDB 文档数据库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-23.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第23章：Redis 高级应用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-24.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第24章：Elasticsearch 搜索引擎</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-25.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第25章：分库分表架构设计</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-26.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第26章：分布式事务解决方案</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-1ec3b14c><section class="VPSidebarItem level-0 collapsible has-active" data-v-1ec3b14c data-v-4af31fea><div class="item" role="button" tabindex="0" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><h2 class="text" data-v-4af31fea>时序与向量数据库（第27-30章）</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4af31fea><span class="vpi-chevron-right caret-icon" data-v-4af31fea></span></div></div><div class="items" data-v-4af31fea><!--[--><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-27.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第27章：InfluxDB 时序数据库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-28.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第28章：TDengine IoT 数据库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-29.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第29章：Milvus 向量数据库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-30.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>第30章：AI 应用数据库架构</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-1ec3b14c><section class="VPSidebarItem level-0 collapsible" data-v-1ec3b14c data-v-4af31fea><div class="item" role="button" tabindex="0" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><h2 class="text" data-v-4af31fea>🔄 实战案例</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4af31fea><span class="vpi-chevron-right caret-icon" data-v-4af31fea></span></div></div><div class="items" data-v-4af31fea><!--[--><div class="VPSidebarItem level-1 is-link" data-v-4af31fea data-v-4af31fea><div class="item" data-v-4af31fea><div class="indicator" data-v-4af31fea></div><a class="VPLink link link" href="/simonProjectGuide/db/chapter-migration.html" data-v-4af31fea><!--[--><p class="text" data-v-4af31fea>数据库迁移与备份实战案例</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-41d61863 data-v-be8e7b5b><div class="VPDoc has-sidebar has-aside" data-v-be8e7b5b data-v-9d69c612><!--[--><!--]--><div class="container" data-v-9d69c612><div class="aside" data-v-9d69c612><div class="aside-curtain" data-v-9d69c612></div><div class="aside-container" data-v-9d69c612><div class="aside-content" data-v-9d69c612><div class="VPDocAside" data-v-9d69c612 data-v-3719f533><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3719f533 data-v-789e393e><div class="content" data-v-789e393e><div class="outline-marker" data-v-789e393e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-789e393e>本页目录</div><ul class="VPDocOutlineItem root" data-v-789e393e data-v-7eda7a3b><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3719f533></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-9d69c612><div class="content-container" data-v-9d69c612><!--[--><!--]--><main class="main" data-v-9d69c612><div style="position:relative;" class="vp-doc _simonProjectGuide_db_chapter-30" data-v-9d69c612><div><h1 id="ai-应用数据库架构" tabindex="-1">：AI 应用数据库架构 <a class="header-anchor" href="#ai-应用数据库架构" aria-label="Permalink to &quot;：AI 应用数据库架构&quot;">​</a></h1><blockquote><p><strong>难度等级</strong>：⭐⭐⭐⭐⭐ 专家级 | <strong>学习时长</strong>：15小时 | <strong>实战项目</strong>：AI 智能搜索系统</p></blockquote><h2 id="📚-本章目录" tabindex="-1">📚 本章目录 <a class="header-anchor" href="#📚-本章目录" aria-label="Permalink to &quot;📚 本章目录&quot;">​</a></h2><ul><li><a href="#281-rag-检索增强">29.1 RAG 检索增强</a></li><li><a href="#282-向量搜索优化">29.2 向量搜索优化</a></li><li><a href="#283-混合检索">29.3 混合检索</a></li><li><a href="#284-性能调优">29.4 性能调优</a></li><li><a href="#285-实战项目ai-搜索系统">29.5 实战项目：AI 搜索系统</a></li></ul><hr><h2 id="rag-检索增强" tabindex="-1">RAG 检索增强 <a class="header-anchor" href="#rag-检索增强" aria-label="Permalink to &quot;RAG 检索增强&quot;">​</a></h2><h3 id="什么是-rag" tabindex="-1">什么是 RAG <a class="header-anchor" href="#什么是-rag" aria-label="Permalink to &quot;什么是 RAG&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│            RAG (Retrieval-Augmented Generation)      │</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                      │</span></span>
<span class="line"><span>│  传统 LLM 生成:                                       │</span></span>
<span class="line"><span>│  ┌─────────┐         ┌─────────┐                    │</span></span>
<span class="line"><span>│  │ 用户    │────────→│   LLM   │                    │</span></span>
<span class="line"><span>│  │ 问题    │         │ 生成回答 │                    │</span></span>
<span class="line"><span>│  └─────────┘         └─────────┘                    │</span></span>
<span class="line"><span>│                           │                          │</span></span>
<span class="line"><span>│                           ▼                          │</span></span>
<span class="line"><span>│                    可能产生幻觉                        │</span></span>
<span class="line"><span>│                    知识截止日期限制                    │</span></span>
<span class="line"><span>│                                                      │</span></span>
<span class="line"><span>│  RAG 增强:                                           │</span></span>
<span class="line"><span>│  ┌─────────┐                                         │</span></span>
<span class="line"><span>│  │ 用户    │                                         │</span></span>
<span class="line"><span>│  │ 问题    │                                         │</span></span>
<span class="line"><span>│  └────┬────┘                                         │</span></span>
<span class="line"><span>│       │                                               │</span></span>
<span class="line"><span>│       ├──────────────────┐                          │</span></span>
<span class="line"><span>│       │                  │                          │</span></span>
<span class="line"><span>│       ▼                  ▼                          │</span></span>
<span class="line"><span>│  ┌─────────┐       ┌─────────┐                     │</span></span>
<span class="line"><span>│  │知识库   │       │  搜索   │                     │</span></span>
<span class="line"><span>│  │(文档)   │       │ 引擎    │                     │</span></span>
<span class="line"><span>│  └─────────┘       └────┬────┘                     │</span></span>
<span class="line"><span>│                          │                          │</span></span>
<span class="line"><span>│                    检索相关文档                       │</span></span>
<span class="line"><span>│                          │                          │</span></span>
<span class="line"><span>│                          ▼                          │</span></span>
<span class="line"><span>│  ┌────────────────────────────────────────┐         │</span></span>
<span class="line"><span>│  │            Prompt + 上下文              │         │</span></span>
<span class="line"><span>│  └─────────────────┬──────────────────────┘         │</span></span>
<span class="line"><span>│                    │                                 │</span></span>
<span class="line"><span>│                    ▼                                 │</span></span>
<span class="line"><span>│  ┌─────────┐       ┌─────────┐       ┌─────────┐  │</span></span>
<span class="line"><span>│  │  上下文  │──────→│   LLM   │──────→│ 更准确  │  │</span></span>
<span class="line"><span>│  │         │       │ 生成回答 │       │ 的回答  │  │</span></span>
<span class="line"><span>│  └─────────┘       └─────────┘       └─────────┘  │</span></span>
<span class="line"><span>│                                                      │</span></span>
<span class="line"><span>│  优点:                                              │</span></span>
<span class="line"><span>│  ✅ 减少幻觉                                          │</span></span>
<span class="line"><span>│  ✅ 知识实时更新                                      │</span></span>
<span class="line"><span>│  ✅ 可解释性强                                        │</span></span>
<span class="line"><span>│  ✅ 成本低（不需要微调模型）                           │</span></span>
<span class="line"><span>│                                                      │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="rag-架构设计" tabindex="-1">RAG 架构设计 <a class="header-anchor" href="#rag-架构设计" aria-label="Permalink to &quot;RAG 架构设计&quot;">​</a></h3><p><strong>数据库层</strong>：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pymilvus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Collection, FieldSchema, CollectionSchema, DataType</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pymilvus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connections</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sentence_transformers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SentenceTransformer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chromadb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 连接向量数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">connections.connect(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;localhost&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;19530&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建文档 Collection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fields </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INT64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_primary</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">auto_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doc_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chunk_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">65535</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FLOAT_VECTOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">384</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INT64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CollectionSchema(fields, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;RAG documents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_collection </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Collection(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rag_documents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index_params </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;index_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HNSW&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;M&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;efConstruction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_collection.create_index(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">field_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">index_params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index_params)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 加载嵌入模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">embedder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SentenceTransformer(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;all-MiniLM-L6-v2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>文档处理流程</strong>：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uuid</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> datetime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> datetime</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hashlib</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DocumentProcessor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, chunk_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, chunk_overlap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.chunk_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk_size</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.chunk_overlap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk_overlap</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> chunk_document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, text, doc_id):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;将文档切分为块&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        chunk_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            end </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.chunk_size</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text[start:end]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            chunk_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">_chunk_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunk_idx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            chunks.append({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;chunk_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: chunk_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: chunk,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: start,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> end </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.chunk_overlap</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            chunk_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunks</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> embed_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, chunks):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;生成向量嵌入&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        texts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [chunk[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunks]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        embeddings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> embedder.encode(texts).tolist()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> embeddings</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> store_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, doc_id, chunks, embeddings, metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;存储到向量数据库&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        now </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(datetime.now().timestamp() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        entities </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            [doc_id] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># doc_ids</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            [chunk[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chunk_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunks],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># chunk_ids</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            [chunk[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunks],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># contents</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            embeddings,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># embeddings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            [metadata] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{}] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># metadata</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            [now] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># created_at</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        doc_collection.insert(entities)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        doc_collection.flush()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用示例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">processor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DocumentProcessor(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chunk_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chunk_overlap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 处理文档</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">人工智能（AI）是计算机科学的一个分支，</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">致力于创建能够执行通常需要人类智能的任务的系统。</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">这包括学习、推理、问题解决、感知和语言理解等能力。</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uuid.uuid4())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> processor.chunk_document(document, doc_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">embeddings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> processor.embed_chunks(chunks)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;人工智能介绍&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;author&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AI Expert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;category&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;技术&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AI&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;机器学习&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;深度学习&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">processor.store_chunks(doc_id, chunks, embeddings, metadata)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 加载到内存</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_collection.load()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><p><strong>检索增强生成</strong>：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> openai</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RAGSystem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, collection, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.collection </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> collection</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.top_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> top_k</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> retrieve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, filters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;检索相关文档&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 生成查询向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        query_embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> embedder.encode([query]).tolist()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 构建过滤表达式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        expr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> filters:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            conditions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key, value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> filters.items():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    conditions.append(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata[&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;] == &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    conditions.append(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata[&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;] == </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            expr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; and &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(conditions)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 搜索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.collection.search(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query_embedding,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            anns_field</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            param</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ef&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.top_k,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            expr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expr,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            output_fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doc_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chunk_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, context):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;生成回答&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 构建 prompt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;基于以下上下文信息回答问题。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">上下文信息：</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">问题：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">回答：&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 调用 LLM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> openai.ChatCompletion.create(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你是一个专业的助手，基于提供的上下文信息回答问题。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: prompt}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            max_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.choices[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].message.content</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, filters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;完整 RAG 流程&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 1. 检索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.retrieve(query, filters)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 2. 构建上下文</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        context_parts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            context_parts.append(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[来源: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hit.entity.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;title&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Unknown&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            context_parts.append(hit.entity.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(context_parts)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 3. 生成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.generate(query, context)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;answer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: answer,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;sources&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: hit.entity.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: hit.entity.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: hit.distance</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用示例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RAGSystem(doc_collection, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;什么是人工智能？&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rag.query(query)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;问题：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;回答：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;answer&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">参考来源：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> source </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sources&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;- </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;title&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> (相关度: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:.4f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><hr><h2 id="向量搜索优化" tabindex="-1">向量搜索优化 <a class="header-anchor" href="#向量搜索优化" aria-label="Permalink to &quot;向量搜索优化&quot;">​</a></h2><h3 id="查询优化" tabindex="-1">查询优化 <a class="header-anchor" href="#查询优化" aria-label="Permalink to &quot;查询优化&quot;">​</a></h3><p><strong>1. 动态 Top-K</strong>：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dynamic_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query, min_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_results</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;根据相关性动态调整返回结果数量&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> embedder.encode([query]).tolist()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 先获取更多候选结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc_collection.search(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query_embedding,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        anns_field</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        param</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ef&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">max_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取2倍数量</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        output_fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 过滤低分结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filtered_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.distance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> min_score]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 返回前 max_results 个</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> filtered_results[:max_results]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>2. 查询重写</strong>：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> query_expansion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;查询扩展，提升召回率&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 使用 LLM 生成查询的多个变体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;生成以下查询的3个语义相似的变体，用于信息检索。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">原始查询：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">变体查询（每行一个）：&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> openai.ChatCompletion.create(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-3.5-turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: prompt}],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        max_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    expanded_queries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [query]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    expanded_queries.extend(response.choices[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].message.content.strip().split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> expanded_queries</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> expanded_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;使用查询扩展进行搜索&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    expanded_queries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query_expansion(query)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    all_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> q </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> expanded_queries:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        q_embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> embedder.encode([q]).tolist()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc_collection.search(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">q_embedding,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            anns_field</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            param</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ef&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            output_fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        all_results.extend(results)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 去重（基于 chunk_id）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    seen </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    unique_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all_results:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        chunk_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.entity.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chunk_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> seen:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            seen.add(chunk_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            unique_results.append(result)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 重新排序</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    unique_results.sort(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x: x.distance, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reverse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unique_results[:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p><strong>3. 混合查询策略</strong>：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pymilvus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connections</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HybridSearcher</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, collection):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.collection </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> collection</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dense_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;稠密向量搜索&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        query_embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> embedder.encode([query]).tolist()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.collection.search(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query_embedding,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            anns_field</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            param</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ef&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">top_k,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            output_fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sparse_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;稀疏搜索（基于 BM25）&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 使用 Elasticsearch 进行关键词搜索</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elasticsearch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Elasticsearch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        es </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Elasticsearch([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost:9200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> es.search(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;documents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;query&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;match&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: query</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: top_k</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hits&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hits&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            results.append({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;chunk_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: hit[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;_source&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chunk_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: hit[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;_source&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: hit[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;_score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hybrid_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, alpha</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;混合搜索（稠密 + 稀疏）&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dense_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dense_search(query, top_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sparse_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.sparse_search(query, top_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 归一化分数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dense_scores </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {r.entity.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chunk_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): r.distance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dense_results}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sparse_scores </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {r[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chunk_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]: r[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sparse_results}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 合并分数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        all_chunk_ids </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dense_scores.keys()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sparse_scores.keys())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        combined_scores </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all_chunk_ids:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            dense_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dense_scores.get(chunk_id, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            sparse_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sparse_scores.get(chunk_id, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 归一化到 [0, 1]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            dense_norm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (dense_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dense_scores.values())) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dense_scores.values()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dense_scores.values()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e-6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            sparse_norm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (sparse_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sparse_scores.values())) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sparse_scores.values()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sparse_scores.values()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e-6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 加权组合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            combined_scores[chunk_id] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> alpha </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dense_norm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> alpha) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sparse_norm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 排序</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sorted_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sorted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(combined_scores.items(), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x: x[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reverse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sorted_results[:top_k]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><h3 id="索引优化" tabindex="-1">索引优化 <a class="header-anchor" href="#索引优化" aria-label="Permalink to &quot;索引优化&quot;">​</a></h3><p><strong>1. 多级索引</strong>：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 为不同粒度的数据创建多个索引</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 粗粒度索引（文档级）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_fields </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doc_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_primary</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FLOAT_VECTOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">384</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CollectionSchema(doc_fields)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_collection </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Collection(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;documents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_schema)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 细粒度索引（段落级）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunk_fields </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chunk_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_primary</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doc_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">65535</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FLOAT_VECTOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">384</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunk_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CollectionSchema(chunk_fields)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunk_collection </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Collection(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chunks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunk_schema)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 句子级索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sentence_fields </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sentence_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_primary</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chunk_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FieldSchema(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataType.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FLOAT_VECTOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">384</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sentence_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CollectionSchema(sentence_fields)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sentence_collection </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Collection(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sentences&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sentence_schema)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>2. 自适应索引</strong>：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> adaptive_indexing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(collection, data_size_threshold</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;根据数据量自动选择索引类型&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 获取当前数据量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stats </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> collection.num_entities</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stats </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data_size_threshold:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 小数据量：使用 FLAT 索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        index_params </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;index_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;FLAT&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stats </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data_size_threshold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 中等数据量：使用 IVF_FLAT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        index_params </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;index_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;IVF_FLAT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nlist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 大数据量：使用 HNSW</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        index_params </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;index_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HNSW&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;M&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;efConstruction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 删除旧索引并创建新索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    collection.drop_index()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    collection.create_index(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">field_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">index_params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index_params)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    collection.load()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index_params</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><hr><h2 id="混合检索" tabindex="-1">混合检索 <a class="header-anchor" href="#混合检索" aria-label="Permalink to &quot;混合检索&quot;">​</a></h2><h3 id="多模态检索" tabindex="-1">多模态检索 <a class="header-anchor" href="#多模态检索" aria-label="Permalink to &quot;多模态检索&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transformers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CLIPProcessor, CLIPModel</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PIL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Image</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MultiModalRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 加载 CLIP 模型（支持图像和文本）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CLIPModel.from_pretrained(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openai/clip-vit-base-patch32&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.processor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CLIPProcessor.from_pretrained(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openai/clip-vit-base-patch32&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> embed_image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, image_path):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;生成图像嵌入&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Image.open(image_path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        inputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.processor(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">images</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">return_tensors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        image_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.model.get_image_features(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inputs)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image_features.detach().numpy()[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].tolist()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> embed_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, text):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;生成文本嵌入&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        inputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.processor(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[text], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">return_tensors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">padding</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        text_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.model.get_text_features(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inputs)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text_features.detach().numpy()[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].tolist()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search_by_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, text_query, collection, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;文本查询图像&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        text_embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.embed_text(text_query)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> collection.search(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[text_embedding],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            anns_field</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            param</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ef&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">top_k,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            output_fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image_path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;caption&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search_by_image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, image_path, collection, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;图像查询图像&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        image_embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.embed_image(image_path)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> collection.search(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[image_embedding],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            anns_field</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            param</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ef&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">top_k,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            output_fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image_path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;caption&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="重排序-reranking" tabindex="-1">重排序（Reranking） <a class="header-anchor" href="#重排序-reranking" aria-label="Permalink to &quot;重排序（Reranking）&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Reranker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sentence_transformers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CrossEncoder</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CrossEncoder(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cross-encoder/ms-marco-MiniLM-L-6-v2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rerank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, candidates, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;使用 CrossEncoder 重排序&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 构建查询-文档对</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pairs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[query, candidate[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> candidate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> candidates]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 计算分数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        scores </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.model.predict(pairs)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 组合结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        reranked </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">zip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(candidates, scores))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        reranked.sort(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x: x[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reverse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 返回 Top-K</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [item[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reranked[:top_k]]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用示例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">reranker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reranker()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 初始检索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">initial_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rag.retrieve(query, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重排序</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">candidates </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: hit.entity.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: hit.entity.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> initial_results</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">reranked_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reranker.rerank(query, candidates, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><hr><h2 id="性能调优" tabindex="-1">性能调优 <a class="header-anchor" href="#性能调优" aria-label="Permalink to &quot;性能调优&quot;">​</a></h2><h3 id="批量处理" tabindex="-1">批量处理 <a class="header-anchor" href="#批量处理" aria-label="Permalink to &quot;批量处理&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> batch_embed_and_store</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(texts, batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;批量生成嵌入并存储&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    all_embeddings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(texts), batch_size):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> texts[i:i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batch_size]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        embeddings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> embedder.encode(batch).tolist()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        all_embeddings.extend(embeddings)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all_embeddings</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> batch_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(queries, batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;批量搜索&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    results_list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(queries), batch_size):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queries[i:i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batch_size]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        batch_embeddings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> embedder.encode(batch).tolist()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc_collection.search(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">batch_embeddings,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            anns_field</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embedding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            param</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metric_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COSINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ef&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            output_fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results_list.extend(results)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results_list</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="缓存策略" tabindex="-1">缓存策略 <a class="header-anchor" href="#缓存策略" aria-label="Permalink to &quot;缓存策略&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hashlib</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> functools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lru_cache</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CachedRAG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, rag_system):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.rag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rag_system</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _get_cache_key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, filters):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;生成缓存键&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        key_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;query&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: query, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;filters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: filters}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        key_str </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json.dumps(key_data, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sort_keys</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hashlib.md5(key_str.encode()).hexdigest()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query, filters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, use_cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;带缓存的查询&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cache_key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._get_cache_key(query, filters)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> use_cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cache_key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cache:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;从缓存返回结果&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cache[cache_key]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 执行查询</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.rag.query(query, filters)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 存入缓存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> use_cache:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cache[cache_key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> clear_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;清除缓存&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cache.clear()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="并发查询" tabindex="-1">并发查询 <a class="header-anchor" href="#并发查询" aria-label="Permalink to &quot;并发查询&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> concurrent.futures </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadPoolExecutor</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> async_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(queries, max_workers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;异步并发搜索&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    loop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio.get_event_loop()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    executor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadPoolExecutor(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_workers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">max_workers)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sync_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rag.retrieve(query, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tasks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        loop.run_in_executor(executor, sync_search, query)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queries</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio.gather(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tasks)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    executor.shutdown()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用示例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;什么是AI？&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;深度学习原理&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;神经网络结构&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio.run(async_search(queries))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><hr><h2 id="实战项目-ai-搜索系统" tabindex="-1">实战项目：AI 搜索系统 <a class="header-anchor" href="#实战项目-ai-搜索系统" aria-label="Permalink to &quot;实战项目：AI 搜索系统&quot;">​</a></h2><h3 id="系统架构" tabindex="-1">系统架构 <a class="header-anchor" href="#系统架构" aria-label="Permalink to &quot;系统架构&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│            AI 搜索系统架构                           │</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                      │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────┐       │</span></span>
<span class="line"><span>│  │           前端界面                        │       │</span></span>
<span class="line"><span>│  │  - 搜索框                                │       │</span></span>
<span class="line"><span>│  │  - 过滤器（分类、日期等）                  │       │</span></span>
<span class="line"><span>│  │  - 结果展示                              │       │</span></span>
<span class="line"><span>│  └─────────────────┬────────────────────────┘       │</span></span>
<span class="line"><span>│                    │                                  │</span></span>
<span class="line"><span>│                    ▼                                  │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────┐       │</span></span>
<span class="line"><span>│  │           API 层 (FastAPI)               │       │</span></span>
<span class="line"><span>│  │  - 搜索接口                              │       │</span></span>
<span class="line"><span>│  │  - 文档上传                              │       │</span></span>
<span class="line"><span>│  │  - 结果返回                              │       │</span></span>
<span class="line"><span>│  └─────────────────┬────────────────────────┘       │</span></span>
<span class="line"><span>│                    │                                  │</span></span>
<span class="line"><span>│                    ▼                                  │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────┐       │</span></span>
<span class="line"><span>│  │          业务逻辑层                       │       │</span></span>
<span class="line"><span>│  │  - RAG 系统                              │       │</span></span>
<span class="line"><span>│  │  - 查询重写                              │       │</span></span>
<span class="line"><span>│  │  - 结果重排序                            │       │</span></span>
<span class="line"><span>│  └─────────────────┬────────────────────────┘       │</span></span>
<span class="line"><span>│                    │                                  │</span></span>
<span class="line"><span>│         ┌──────────┼──────────┐                      │</span></span>
<span class="line"><span>│         │          │          │                      │</span></span>
<span class="line"><span>│         ▼          ▼          ▼                      │</span></span>
<span class="line"><span>│  ┌──────────┐ ┌──────────┐ ┌──────────┐            │</span></span>
<span class="line"><span>│  │Milvus    │ │Elasticsearch││PostgreSQL│            │</span></span>
<span class="line"><span>│  │(向量)    │ │(全文)    │ │(元数据)  │            │</span></span>
<span class="line"><span>│  └──────────┘ └──────────┘ └──────────┘            │</span></span>
<span class="line"><span>│                                                      │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="后端实现" tabindex="-1">后端实现 <a class="header-anchor" href="#后端实现" aria-label="Permalink to &quot;后端实现&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fastapi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FastAPI, UploadFile, File, HTTPException</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pydantic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BaseModel</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> List, Optional</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uvicorn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FastAPI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AI Search System&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 数据模型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SearchRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filters: Optional[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_k: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SearchResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    metadata: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    score: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SearchResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    answer: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sources: List[SearchResult]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># API 端点</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@app.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/search&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response_model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SearchResponse)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request: SearchRequest):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;搜索接口&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 执行 RAG 搜索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rag.query(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.query,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            filters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request.filters</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SearchResponse(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;answer&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                SearchResult(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> source </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sources&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTPException(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">detail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@app.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/upload&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> upload_document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file: UploadFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> File(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;上传文档&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 读取文件内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.read()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 处理文档</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content.decode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        doc_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uuid.uuid4())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 分块</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> processor.chunk_document(text, doc_id)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 嵌入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        embeddings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> processor.embed_chunks(chunks)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 存储</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;filename&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.filename,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(content)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        processor.store_chunks(doc_id, chunks, embeddings, metadata)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doc_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: doc_id}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTPException(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">detail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@app.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/health&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> health_check</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;健康检查&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;healthy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动服务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uvicorn.run(app, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><h3 id="前端实现" tabindex="-1">前端实现 <a class="header-anchor" href="#前端实现" aria-label="Permalink to &quot;前端实现&quot;">​</a></h3><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;!</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">DOCTYPE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;AI 搜索系统&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .search-container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            max-width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            margin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .search-box</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            display</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">flex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            gap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            margin-bottom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .search-input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            flex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            font-size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .search-button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            background-color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">#007bff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">white</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            border</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">none</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            cursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pointer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .results</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            margin-top</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .answer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            background-color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">#f8f9fa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            border-radius</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            margin-bottom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            border</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> solid</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> #ddd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            margin-bottom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            border-radius</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        .upload-container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            margin-top</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            border</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dashed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> #ddd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            text-align</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">center</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search-container&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;AI 搜索系统&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search-box&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;queryInput&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search-input&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> placeholder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;输入您的问题...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onclick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">search</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search-button&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;搜索&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;results&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;results&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;upload-container&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;上传文档&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;file&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fileInput&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onclick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uploadFile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;上传&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;queryInput&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).value;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultsDiv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;results&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            resultsDiv.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;p&gt;搜索中...&lt;/p&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/search&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/json&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        query: query,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        top_k: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> html </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;div class=&quot;answer&quot;&gt;&lt;h3&gt;回答：&lt;/h3&gt;&lt;p&gt;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;/p&gt;&lt;/div&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                html </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;h3&gt;参考来源：&lt;/h3&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                data.sources.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    html </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;div class=&quot;source&quot;&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    html </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;p&gt;&lt;strong&gt;分数：&lt;/strong&gt;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> source.score.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toFixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;/p&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    html </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;p&gt;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> source.content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;/p&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    html </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;/div&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                resultsDiv.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                resultsDiv.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;p style=&quot;color: red;&quot;&gt;搜索出错：&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error.message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;/p&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uploadFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fileInput</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fileInput&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fileInput.files[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">file) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;请选择文件&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> formData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FormData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            formData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, file);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/upload&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    body: formData</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;上传成功！文档ID: &#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.doc_id);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;上传失败：&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error.message);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 支持回车搜索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;queryInput&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;keypress&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Enter&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br></div></div><hr><h2 id="✅-本章小结" tabindex="-1">✅ 本章小结 <a class="header-anchor" href="#✅-本章小结" aria-label="Permalink to &quot;✅ 本章小结&quot;">​</a></h2><h3 id="学习检查清单" tabindex="-1">学习检查清单 <a class="header-anchor" href="#学习检查清单" aria-label="Permalink to &quot;学习检查清单&quot;">​</a></h3><p>完成本章学习后，请确认你能够：</p><ul><li>[ ] 理解 RAG 的原理和优势</li><li>[ ] 设计并实现 RAG 系统</li><li>[ ] 优化向量搜索性能（查询优化、索引优化）</li><li>[ ] 实现混合检索（稠密 + 稀疏）</li><li>[ ] 使用重排序提升结果质量</li><li>[ ] 实现多模态检索</li><li>[ ] 进行性能调优（批量处理、缓存、并发）</li><li>[ ] 构建完整的 AI 搜索系统</li></ul><h3 id="核心要点回顾" tabindex="-1">核心要点回顾 <a class="header-anchor" href="#核心要点回顾" aria-label="Permalink to &quot;核心要点回顾&quot;">​</a></h3><ol><li><strong>RAG 架构</strong>：检索 + 生成，减少 LLM 幻觉</li><li><strong>向量优化</strong>：查询重写、混合搜索、重排序</li><li><strong>混合检索</strong>：稠密向量 + 稀疏关键词</li><li><strong>性能调优</strong>：批量处理、缓存、并发查询</li><li><strong>实战应用</strong>：AI 搜索系统（前端 + 后端 + 数据库）</li></ol><h2 id="📚-延伸阅读" tabindex="-1">📚 延伸阅读 <a class="header-anchor" href="#📚-延伸阅读" aria-label="Permalink to &quot;📚 延伸阅读&quot;">​</a></h2><ul><li><a href="./chapter-29.html">第30章：Milvus 向量数据库 →</a></li><li><a href="./chapter-26.html">第27章：InfluxDB 时序数据库 →</a></li><li><a href="https://docs.langchain.com/" target="_blank" rel="noreferrer">LangChain 文档</a></li><li><a href="https://www.anthropic.com/index/retrieval-augmented-generation" target="_blank" rel="noreferrer">RAG 技术指南</a></li></ul><hr><p><strong>更新时间</strong>：2026年2月 | <strong>版本</strong>：v1.0</p></div></div></main><footer class="VPDocFooter" data-v-9d69c612 data-v-7c34dfd0><!--[--><!--]--><div class="edit-info" data-v-7c34dfd0><!----><div class="last-updated" data-v-7c34dfd0><p class="VPLastUpdated" data-v-7c34dfd0 data-v-8952ffe7>最后更新: <time datetime="2026-02-11T08:16:51.000Z" data-v-8952ffe7></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-7c34dfd0><span class="visually-hidden" id="doc-footer-aria-label" data-v-7c34dfd0>Pager</span><div class="pager" data-v-7c34dfd0><a class="VPLink link pager-link prev" href="/simonProjectGuide/db/chapter-29.html" data-v-7c34dfd0><!--[--><span class="desc" data-v-7c34dfd0>上一章</span><span class="title" data-v-7c34dfd0>第29章：Milvus 向量数据库</span><!--]--></a></div><div class="pager" data-v-7c34dfd0><a class="VPLink link pager-link next" href="/simonProjectGuide/db/chapter-migration.html" data-v-7c34dfd0><!--[--><span class="desc" data-v-7c34dfd0>下一章</span><span class="title" data-v-7c34dfd0>数据库迁移与备份实战案例</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-41d61863 data-v-eeeeff1c><div class="container" data-v-eeeeff1c><p class="message" data-v-eeeeff1c>基于 MIT 许可发布</p><p class="copyright" data-v-eeeeff1c>© Simon 小徐 2026 | 邮箱: esimonx@163.com</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"ai_appendix-tools.md\":\"octWFGbx\",\"ai_chapter-00.md\":\"BqX4lUnn\",\"ai_chapter-01.md\":\"BgoEb1Pa\",\"ai_chapter-02.md\":\"BAGfy-eW\",\"ai_chapter-03.md\":\"kbfGT7o6\",\"ai_chapter-04.md\":\"e5byzF_1\",\"ai_chapter-05.md\":\"C1zgmIGb\",\"ai_chapter-06.md\":\"xHp_wNnY\",\"ai_chapter-07.md\":\"BAkMLPMK\",\"ai_chapter-08-agent-skills.md\":\"D_kV2ufv\",\"ai_chapter-08.md\":\"COHlXeVC\",\"ai_chapter-09.md\":\"CLgrfBig\",\"ai_chapter-10.md\":\"vtdrD2pj\",\"ai_index.md\":\"4PeCh52v\",\"ai_tools-setup.md\":\"CtVopcRH\",\"db_backup_chapter-01.md\":\"CtvEnaoT\",\"db_backup_chapter-02.md\":\"BtgUkWq8\",\"db_backup_chapter-03.md\":\"DTypr5El\",\"db_backup_chapter-04.md\":\"CXXPJkhv\",\"db_backup_chapter-05.md\":\"D7W1Lv1e\",\"db_backup_chapter-06.md\":\"DhTEYH7N\",\"db_backup_chapter-07.md\":\"CtL2E951\",\"db_backup_chapter-08.md\":\"B6xuFoKu\",\"db_backup_chapter-09.md\":\"BarunEC4\",\"db_backup_chapter-10.md\":\"hGSjejJF\",\"db_backup_chapter-11.md\":\"C4JA-Hl_\",\"db_backup_chapter-12.md\":\"DbM-GClU\",\"db_backup_chapter-13.md\":\"y2826xYL\",\"db_backup_chapter-15.md\":\"CF82AD2G\",\"db_backup_chapter-16.md\":\"jiPIVVpA\",\"db_backup_chapter-17.md\":\"4MbCdQQX\",\"db_backup_chapter-18.md\":\"DSe5cG7f\",\"db_backup_chapter-19.md\":\"D4zPjXwC\",\"db_backup_chapter-20.md\":\"CVs62QOK\",\"db_backup_chapter-21.md\":\"B9LhMD0r\",\"db_backup_chapter-22.md\":\"BNTTYAa4\",\"db_backup_chapter-23.md\":\"CRzJ7zyJ\",\"db_backup_chapter-24.md\":\"DDC7GStD\",\"db_backup_chapter-25.md\":\"CZSLQK0V\",\"db_backup_chapter-26.md\":\"CiH4-RBY\",\"db_backup_chapter-27.md\":\"BGubVec-\",\"db_backup_chapter-28.md\":\"DcbkqYG8\",\"db_chapter-01.md\":\"CWug2pev\",\"db_chapter-02.md\":\"CsyApkP5\",\"db_chapter-03.md\":\"BqSzsYfq\",\"db_chapter-04.md\":\"DN_vIBv0\",\"db_chapter-05.md\":\"Cs52l3ig\",\"db_chapter-06.md\":\"DJmsS2K6\",\"db_chapter-07.md\":\"CZtC4yNU\",\"db_chapter-08.md\":\"C2pTZFai\",\"db_chapter-09.md\":\"Dapg7HM3\",\"db_chapter-10.md\":\"AlJguB-K\",\"db_chapter-11.md\":\"BCybcpWS\",\"db_chapter-12.md\":\"Debb1kZd\",\"db_chapter-13.md\":\"DWLFYLCh\",\"db_chapter-14.md\":\"BiyXPeSN\",\"db_chapter-15.md\":\"DarDnbRe\",\"db_chapter-16.md\":\"ClDKVBoN\",\"db_chapter-17.md\":\"z2hP6ZER\",\"db_chapter-18.md\":\"BvvL4Hm3\",\"db_chapter-19.md\":\"BM-rhlYx\",\"db_chapter-20.md\":\"C9tyste0\",\"db_chapter-21.md\":\"DEfdLkeF\",\"db_chapter-22.md\":\"CafbIZSy\",\"db_chapter-23.md\":\"GSRwhyUo\",\"db_chapter-24.md\":\"C50DPxbm\",\"db_chapter-25.md\":\"BAxOiMwE\",\"db_chapter-26.md\":\"6tW-9vkX\",\"db_chapter-27.md\":\"ca3uP7Hm\",\"db_chapter-28.md\":\"BmkenJV4\",\"db_chapter-29.md\":\"CnvjVaEv\",\"db_chapter-30.md\":\"pMa9cJCy\",\"db_chapter-migration.md\":\"QHSo1VSF\",\"db_index.md\":\"DfpqtG9S\",\"devops_appendix-project.md\":\"xrhxYklf\",\"devops_appendix-tools.md\":\"DRhzHiRD\",\"devops_chapter-01.md\":\"BcuLU-By\",\"devops_chapter-02.md\":\"cBr7c3-p\",\"devops_chapter-03.md\":\"BX47qfVF\",\"devops_chapter-04.md\":\"da0WM52T\",\"devops_chapter-05.md\":\"19YtBovb\",\"devops_chapter-06.md\":\"Ch53iFy7\",\"devops_chapter-07.md\":\"Dl-Q1OIa\",\"devops_chapter-08.md\":\"B7krpDlg\",\"devops_chapter-09.md\":\"DmonXL4J\",\"devops_chapter-10.md\":\"By7NTdQj\",\"devops_chapter-11.md\":\"BTaEx162\",\"devops_chapter-12.md\":\"C7NFDwBq\",\"devops_chapter-13.md\":\"DoWJJtXU\",\"devops_chapter-14.md\":\"Upp2pdsL\",\"devops_chapter-15.md\":\"BCTz0Zb7\",\"devops_chapter-16-project.md\":\"DQ69V4WU\",\"devops_chapter-17-project.md\":\"CZDptfwh\",\"devops_chapter-18-project.md\":\"iuyyn1g3\",\"devops_index.md\":\"BA6Obm2B\",\"git_appendix.md\":\"C3Wluu2I\",\"git_chapter-01.md\":\"BZf8FeHe\",\"git_chapter-02.md\":\"DplRXGLx\",\"git_chapter-03.md\":\"Cke9X_uL\",\"git_chapter-05.md\":\"Cxy97uc8\",\"git_index.md\":\"BN0O07CC\",\"git_workflow.md\":\"Cjtcp6zy\",\"guide_appendix-checklist.md\":\"CDxQ_hLu\",\"guide_appendix-git.md\":\"BudtnllN\",\"guide_appendix-projects.md\":\"CbRblmUn\",\"guide_appendix-resources.md\":\"CjParQVx\",\"guide_appendix-templates.md\":\"Ekf0g6YC\",\"guide_appendix-vscode.md\":\"DZ1CHpEC\",\"guide_chapter-00.md\":\"ChcAHEIK\",\"guide_chapter-01.md\":\"sGpj2kAU\",\"guide_chapter-02.md\":\"fEMUhewT\",\"guide_chapter-03.md\":\"uW_tZaf4\",\"guide_chapter-04.md\":\"J1l8yTvX\",\"guide_chapter-05.md\":\"ME2KvkxV\",\"guide_chapter-06.md\":\"BPbQgAe1\",\"guide_chapter-07.md\":\"0OPczge2\",\"guide_chapter-08.md\":\"CFUnC5Z8\",\"guide_chapter-09.md\":\"B072KZKJ\",\"guide_chapter-10.md\":\"lb4v89E5\",\"guide_chapter-11.md\":\"DrLqpb3E\",\"guide_chapter-12.md\":\"BI6bJ8Ev\",\"guide_chapter-13.md\":\"C6Ee8Q9m\",\"guide_chapter-14-advanced.md\":\"CboYv1Uj\",\"guide_chapter-14.md\":\"CwzZCNCz\",\"guide_chapter-15.md\":\"BF9iplnG\",\"guide_chapter-16-advanced.md\":\"BwjnCyX9\",\"guide_chapter-16.md\":\"DFmdjgr9\",\"guide_chapter-17.md\":\"CrmoMJY4\",\"guide_chapter-18-advanced.md\":\"CGEb1d73\",\"guide_chapter-18.md\":\"BMRYF2MX\",\"guide_chapter-19.md\":\"B6FDm2FE\",\"guide_chapter-20.md\":\"NqqW1j5y\",\"guide_chapter-21.md\":\"D0QHQ4mH\",\"guide_chapter-22.md\":\"rbyWVK47\",\"guide_chapter-23.md\":\"B6BWTnHb\",\"guide_chapter-24.md\":\"wdgY324s\",\"guide_chapter-25.md\":\"BUxgGUPH\",\"guide_chapter-26.md\":\"BLopEy8X\",\"guide_chapter-27.md\":\"NldE4Y-_\",\"guide_chapter-28.md\":\"B0-jTLl4\",\"guide_chapter-29.md\":\"Izr7GQny\",\"guide_chapter-30.md\":\"C9TeNQIb\",\"guide_chapter-31.md\":\"Cu8gCI5_\",\"guide_chapter-32.md\":\"D4pEPzbM\",\"guide_chapter-33.md\":\"CC1Q_BoR\",\"guide_chapter-34.md\":\"DeibsnrT\",\"guide_chapter-35.md\":\"Ck2KNduX\",\"guide_chapter-36.md\":\"TS7Sqczy\",\"guide_chapter-37.md\":\"D0Ni79Gg\",\"guide_chapter-38.md\":\"DSTIHN_Q\",\"guide_chapter-39.md\":\"Ch-C7h2h\",\"guide_chapter-40.md\":\"CkfP7Ksv\",\"guide_chapter-41.md\":\"Dv-amvIi\",\"guide_chapter-42.md\":\"NyGmRqkL\",\"guide_chapter-43.md\":\"DRrDh7S4\",\"guide_chapter-44.md\":\"CIHTRkHo\",\"guide_chapter-45.md\":\"2L75sAHN\",\"guide_chapter-46.md\":\"VS7-iLkP\",\"guide_chapter-47.md\":\"DeuVSQfb\",\"guide_chapter-48.md\":\"CoksNAhX\",\"guide_chapter-49.md\":\"C-_eNj9a\",\"guide_chapter-50-project.md\":\"AYEDYm7a\",\"guide_chapter-51-project.md\":\"DVYnyI2h\",\"guide_chapter-52-project.md\":\"CX1VpYkD\",\"guide_chapter-53-project.md\":\"CT3yETKW\",\"guide_chapter-54-project.md\":\"CB15wou7\",\"guide_index.md\":\"CcGmnet3\",\"guide_nextjs_appendix-tools.md\":\"CP0nF1Vm\",\"guide_nextjs_chapter-100.md\":\"BfPOEleJ\",\"guide_nextjs_chapter-101.md\":\"TlujgfqQ\",\"guide_nextjs_chapter-102.md\":\"CtHKa_i3\",\"guide_nextjs_chapter-103.md\":\"Bi87zlAw\",\"guide_nextjs_chapter-104.md\":\"Drd9eSLs\",\"guide_nextjs_chapter-105.md\":\"Bob8GyJm\",\"guide_nextjs_chapter-106.md\":\"D7SQeQNV\",\"guide_nextjs_chapter-107.md\":\"CbVvUGi4\",\"guide_nextjs_chapter-108.md\":\"DCrOOELb\",\"guide_nextjs_chapter-109.md\":\"D_13b_oE\",\"guide_nextjs_chapter-110.md\":\"DEJf9CSR\",\"guide_nextjs_chapter-111.md\":\"D7ltGoka\",\"guide_nextjs_chapter-112.md\":\"CHYSF1un\",\"guide_nextjs_chapter-113.md\":\"D62Afa85\",\"guide_nextjs_chapter-81.md\":\"CyFewHQg\",\"guide_nextjs_chapter-82.md\":\"BzRMXFgO\",\"guide_nextjs_chapter-83.md\":\"BBMo3fgS\",\"guide_nextjs_chapter-84.md\":\"Uyzw7ILP\",\"guide_nextjs_chapter-85.md\":\"CkDrwXnw\",\"guide_nextjs_chapter-86.md\":\"2Paevcjz\",\"guide_nextjs_chapter-87.md\":\"CU5XM7E9\",\"guide_nextjs_chapter-88.md\":\"DE6uRLAM\",\"guide_nextjs_chapter-89.md\":\"BmyY0m1_\",\"guide_nextjs_chapter-90.md\":\"CNBo6QDM\",\"guide_nextjs_chapter-91.md\":\"Bct_u-Zl\",\"guide_nextjs_chapter-92.md\":\"BU6l7LwF\",\"guide_nextjs_chapter-93.md\":\"DRsyQp8L\",\"guide_nextjs_chapter-94.md\":\"DUhz5twx\",\"guide_nextjs_chapter-95.md\":\"47OFyNjG\",\"guide_nextjs_chapter-96.md\":\"BSCKysbp\",\"guide_nextjs_chapter-97.md\":\"Tt6xBzqV\",\"guide_nextjs_chapter-98.md\":\"BrB8KeFP\",\"guide_nextjs_chapter-99.md\":\"BevhaksA\",\"guide_nextjs_index.md\":\"DWTcCDFC\",\"guide_nuxt_appendix-tools.md\":\"B3vYykrg\",\"guide_nuxt_chapter-111.md\":\"B7O8Rldo\",\"guide_nuxt_chapter-112.md\":\"Q3rtEwjc\",\"guide_nuxt_chapter-113.md\":\"CwOGk4MD\",\"guide_nuxt_chapter-114.md\":\"DPOhTPms\",\"guide_nuxt_chapter-115.md\":\"BGnaJdPb\",\"guide_nuxt_chapter-116.md\":\"DbQTsUGF\",\"guide_nuxt_chapter-117.md\":\"C47pQF7Y\",\"guide_nuxt_chapter-118.md\":\"1KqXUpdN\",\"guide_nuxt_chapter-119.md\":\"BOj3xdBK\",\"guide_nuxt_chapter-120.md\":\"Dhx1T2q6\",\"guide_nuxt_chapter-121.md\":\"Cu8ooyGv\",\"guide_nuxt_chapter-122.md\":\"DHqb27N8\",\"guide_nuxt_chapter-123.md\":\"8XMrwiRX\",\"guide_nuxt_chapter-124.md\":\"DKpO2-s7\",\"guide_nuxt_chapter-125.md\":\"BTHuZXcG\",\"guide_nuxt_chapter-126.md\":\"C6U0PM76\",\"guide_nuxt_chapter-127.md\":\"BMNUjJTa\",\"guide_nuxt_chapter-128.md\":\"CASk-CuH\",\"guide_nuxt_chapter-129.md\":\"S3LeRw42\",\"guide_nuxt_chapter-130.md\":\"C9wFnmHh\",\"guide_nuxt_chapter-131.md\":\"Cv8jx2mq\",\"guide_nuxt_chapter-132.md\":\"IWsLTEph\",\"guide_nuxt_chapter-133.md\":\"BOzT4-wn\",\"guide_nuxt_chapter-134.md\":\"BOj4L9G1\",\"guide_nuxt_chapter-135.md\":\"iu_Yaurd\",\"guide_nuxt_chapter-136.md\":\"BGXRZnyz\",\"guide_nuxt_chapter-137.md\":\"D9kvgB0r\",\"guide_nuxt_chapter-138.md\":\"5gJtG0sm\",\"guide_nuxt_chapter-139.md\":\"BVQQMZnh\",\"guide_nuxt_chapter-140.md\":\"B9V7ygrD\",\"guide_nuxt_chapter-141.md\":\"BK6tOev4\",\"guide_nuxt_chapter-142.md\":\"BE0_qYkj\",\"guide_nuxt_index.md\":\"mBfY7klJ\",\"guide_react_appendix-tools.md\":\"ECFfOb2I\",\"guide_react_chapter-51.md\":\"BlSRmrjY\",\"guide_react_chapter-52.md\":\"CRj4GE57\",\"guide_react_chapter-53.md\":\"D42dq2Ib\",\"guide_react_chapter-54.md\":\"CO-NXvgx\",\"guide_react_chapter-55.md\":\"DJ1Qd4aM\",\"guide_react_chapter-56.md\":\"gtoD_Gt6\",\"guide_react_chapter-57.md\":\"BRNYuw0c\",\"guide_react_chapter-58.md\":\"CZGc992O\",\"guide_react_chapter-59.md\":\"CyYjNxuA\",\"guide_react_chapter-60.md\":\"C1TVd302\",\"guide_react_chapter-61.md\":\"D7jtWYYU\",\"guide_react_chapter-62.md\":\"OQNFhWAU\",\"guide_react_chapter-63.md\":\"BcmAw0ti\",\"guide_react_chapter-64.md\":\"CwRpKx32\",\"guide_react_chapter-65.md\":\"KCoYMsFG\",\"guide_react_chapter-66.md\":\"61_wJhJe\",\"guide_react_chapter-67.md\":\"DRhLJRF_\",\"guide_react_chapter-68.md\":\"CpSXhlWU\",\"guide_react_chapter-69.md\":\"CwIL_HoS\",\"guide_react_chapter-70.md\":\"DFnCNxbC\",\"guide_react_chapter-71.md\":\"CULW7Peo\",\"guide_react_chapter-72.md\":\"BexnviRm\",\"guide_react_chapter-73.md\":\"C8TC4Pzk\",\"guide_react_chapter-74.md\":\"BAJZlqOl\",\"guide_react_chapter-75.md\":\"tsuopXTE\",\"guide_react_chapter-76.md\":\"k-11sgGg\",\"guide_react_chapter-77.md\":\"BDD6vy3O\",\"guide_react_chapter-78.md\":\"CWPAvl96\",\"guide_react_chapter-79.md\":\"DR6jpg2q\",\"guide_react_chapter-80-project.md\":\"CYkuq9eB\",\"guide_react_chapter-80.md\":\"D9-UVGAa\",\"guide_react_chapter-81.md\":\"DC2pd_Xy\",\"guide_react_chapter-82.md\":\"CNS1XYcP\",\"guide_react_index.md\":\"t0ao5Y_1\",\"guide_vue3_appendix-tools.md\":\"BRc_Qji5\",\"index.md\":\"B3yL6vCF\",\"interview_ai_advanced_chapter-04.md\":\"BZxna_gG\",\"interview_ai_advanced_chapter-05.md\":\"OhM94Tu4\",\"interview_ai_advanced_chapter-06.md\":\"t50lk7i5\",\"interview_ai_advanced_chapter-07.md\":\"D-78Xj8j\",\"interview_ai_advanced_project-interview.md\":\"DreUtqkB\",\"interview_ai_index.md\":\"DViktsKu\",\"interview_ai_intermediate_chapter-01.md\":\"9r82uwUI\",\"interview_ai_intermediate_chapter-02.md\":\"vSE8ZdS6\",\"interview_ai_intermediate_chapter-03.md\":\"B1xGekXK\",\"interview_database_advanced_distributed-transactions.md\":\"DKCezqt6\",\"interview_database_advanced_domestic-databases.md\":\"_9aZAFyh\",\"interview_database_advanced_migration-backup.md\":\"CASh0-YO\",\"interview_database_advanced_nosql-vector.md\":\"CEfWpBic\",\"interview_database_advanced_sharding-distributed.md\":\"CEBZMnvh\",\"interview_database_index.md\":\"Dt3Ztym8\",\"interview_database_intermediate_mysql-basics.md\":\"BKbkT81X\",\"interview_database_intermediate_oracle.md\":\"By_egIj8\",\"interview_database_intermediate_postgresql.md\":\"DtgdUmKq\",\"interview_database_intermediate_redis-cache.md\":\"Cn_Ni6rb\",\"interview_database_intermediate_replication.md\":\"Rk-CTrLI\",\"interview_database_intermediate_transaction-lock.md\":\"BYUKjXdm\",\"interview_devops_advanced_chapter-04.md\":\"sHqsy35w\",\"interview_devops_advanced_chapter-05.md\":\"DyGq-Pah\",\"interview_devops_advanced_chapter-06.md\":\"DDSNsFwR\",\"interview_devops_advanced_chapter-07.md\":\"DlE3CvQj\",\"interview_devops_advanced_project-interview.md\":\"ClzESJGa\",\"interview_devops_index.md\":\"Ccae8HRV\",\"interview_devops_intermediate_chapter-01.md\":\"B7ibjyf3\",\"interview_devops_intermediate_chapter-02.md\":\"C5x-xVYH\",\"interview_devops_intermediate_chapter-03.md\":\"B7QUellp\",\"interview_frontend_advanced_project-interview.md\":\"CMwAxwrP\",\"interview_frontend_bun_bun-runtime.md\":\"CkuGYcDs\",\"interview_frontend_index.md\":\"Cbd_6ahU\",\"interview_frontend_nextjs_advanced_nextjs-advanced.md\":\"Dxa4vBOx\",\"interview_frontend_nextjs_intermediate_nextjs-basics.md\":\"D9yWJhmh\",\"interview_frontend_nuxt_advanced_nuxt-advanced.md\":\"DHEi9RnF\",\"interview_frontend_nuxt_intermediate_nuxt-basics.md\":\"DFq9j-1L\",\"interview_frontend_react_advanced_react-nextjs.md\":\"Bw3fQ9p1\",\"interview_frontend_react_intermediate_react-basics.md\":\"nuhjdu7k\",\"interview_frontend_tooling_biome.md\":\"DDn0Ax5K\",\"interview_frontend_vue3_advanced_vue3-advanced.md\":\"DsgpXYeN\",\"interview_frontend_vue3_intermediate_component-development.md\":\"XMkihT7X\",\"interview_frontend_vue3_intermediate_routing-state.md\":\"CeblrHIu\",\"interview_frontend_vue3_intermediate_vue3-core.md\":\"CV7CwY_x\",\"interview_git_advanced_chapter-04.md\":\"JW3d__oP\",\"interview_git_advanced_chapter-05.md\":\"WBSjXz0F\",\"interview_git_advanced_chapter-06.md\":\"CtcooOFZ\",\"interview_git_index.md\":\"Dt_0Zxfm\",\"interview_git_intermediate_chapter-01.md\":\"D1Pm8olv\",\"interview_git_intermediate_chapter-02.md\":\"B5KGCwz_\",\"interview_git_intermediate_chapter-03.md\":\"DJC7JhjS\",\"interview_index.md\":\"DJ5ro_xE\",\"interview_java_advanced_distributed-system.md\":\"BOxY3CMj\",\"interview_java_advanced_microservices.md\":\"Brmk9ZyF\",\"interview_java_advanced_modern-java.md\":\"p3CO0Fbg\",\"interview_java_advanced_project-interview.md\":\"BUS9InDk\",\"interview_java_index.md\":\"Dfyht_DW\",\"interview_java_intermediate_database-redis.md\":\"LQUCncyf\",\"interview_java_intermediate_java-basics.md\":\"BKO5XrRp\",\"interview_java_intermediate_message-queue.md\":\"BoVoC8_r\",\"interview_java_intermediate_spring-framework.md\":\"DV23eUO7\",\"java_appendix-tools.md\":\"BcYe0Otc\",\"java_chapter-114.md\":\"hR01eS5W\",\"java_chapter-115.md\":\"DFhZYBsG\",\"java_chapter-116.md\":\"_ojjJSG9\",\"java_chapter-117.md\":\"DzZRPSLG\",\"java_chapter-118.md\":\"Bj6B61MX\",\"java_chapter-119.md\":\"DdstZhwc\",\"java_chapter-120.md\":\"aQLPNPL4\",\"java_chapter-121.md\":\"CXRQacG-\",\"java_chapter-122.md\":\"BuABKkG9\",\"java_chapter-123.md\":\"ChEVP0G4\",\"java_chapter-124.md\":\"CcIF9fLU\",\"java_chapter-125-api.md\":\"CJQ8PGHc\",\"java_chapter-125.md\":\"CZ_pe63P\",\"java_chapter-126.md\":\"CNOTV6NL\",\"java_chapter-127.md\":\"C93pgZFe\",\"java_chapter-128-database.md\":\"Ce2xHtNq\",\"java_chapter-128.md\":\"Bp7xmXjV\",\"java_chapter-129.md\":\"SCZ6Tro6\",\"java_chapter-130.md\":\"hZ34wkgm\",\"java_chapter-131.md\":\"CZ3A56O1\",\"java_chapter-132.md\":\"BqHRxMGX\",\"java_chapter-133.md\":\"pz24rtwq\",\"java_chapter-134.md\":\"Ce6LtrB1\",\"java_chapter-135.md\":\"BYa3hNYm\",\"java_chapter-136.md\":\"9ZuhRjTg\",\"java_chapter-137.md\":\"CrKMfSts\",\"java_chapter-138.md\":\"CiQ-Rybb\",\"java_chapter-139.md\":\"BJ1QWmtt\",\"java_chapter-140.md\":\"BoBB7fYZ\",\"java_chapter-141.md\":\"DU3fJrZu\",\"java_chapter-142.md\":\"C-WaZGNs\",\"java_chapter-143.md\":\"C7Se6FGd\",\"java_chapter-144.md\":\"DWRsqvj9\",\"java_chapter-145.md\":\"fNRKIL2-\",\"java_chapter-146.md\":\"3j219kAE\",\"java_chapter-147.md\":\"BbksZUn8\",\"java_chapter-148.md\":\"BVBIxu04\",\"java_index.md\":\"D4DPxCZY\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"小徐的技术充电站\",\"description\":\"小徐技术充电站 - 从零到企业级项目实战\",\"base\":\"/simonProjectGuide/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"🏠 首页\",\"link\":\"/\"},{\"text\":\"💻 前端全栈\",\"items\":[{\"text\":\"📚 学习路线\",\"link\":\"/guide/\"},{\"text\":\"🌱 基础入门\",\"link\":\"/guide/chapter-00\"},{\"text\":\"🧩 组件开发\",\"link\":\"/guide/chapter-09\"},{\"text\":\"🏢 企业级开发\",\"link\":\"/guide/chapter-16\"},{\"text\":\"🚀 进阶之路\",\"link\":\"/guide/chapter-25\"},{\"text\":\"⭐ 高级拓展\",\"link\":\"/guide/chapter-40\"},{\"text\":\"💼 实战项目\",\"link\":\"/guide/chapter-50-project\"},{\"text\":\"📖 工具速查\",\"link\":\"/guide/appendix-resources\"}]},{\"text\":\"☕ Java 架构师之路\",\"items\":[{\"text\":\"📚 学习路线\",\"link\":\"/java/\"},{\"text\":\"🌱 基础入门\",\"link\":\"/java/chapter-114\"},{\"text\":\"🌐 Web开发\",\"link\":\"/java/chapter-124\"},{\"text\":\"🎯 微服务全家桶\",\"link\":\"/java/chapter-132\"},{\"text\":\"⭐ 高级进阶\",\"link\":\"/java/chapter-142\"},{\"text\":\"💼 实战项目\",\"link\":\"/java/chapter-131\"},{\"text\":\"📖 工具速查\",\"link\":\"/java/appendix-tools\"}]},{\"text\":\"📝 面试通关秘籍\",\"items\":[{\"text\":\"📚 学习路线\",\"link\":\"/interview/\"},{\"text\":\"💻 前端面试题\",\"link\":\"/interview/frontend/\"},{\"text\":\"☕ Java面试题\",\"link\":\"/interview/java/\"},{\"text\":\"🤖 AI面试题\",\"link\":\"/interview/ai/\"},{\"text\":\"🔧 Git面试题\",\"link\":\"/interview/git/\"},{\"text\":\"🚀 DevOps面试题\",\"link\":\"/interview/devops/\"}]},{\"text\":\"🔧 Git 完全指南\",\"items\":[{\"text\":\"📚 学习路线\",\"link\":\"/git/\"},{\"text\":\"🌱 基础入门\",\"link\":\"/git/chapter-01\"},{\"text\":\"🔄 进阶实战\",\"link\":\"/git/workflow\"},{\"text\":\"📖 工具速查\",\"link\":\"/git/appendix\"}]},{\"text\":\"🤖 AI 应用开发\",\"items\":[{\"text\":\"📚 学习路线\",\"link\":\"/ai/\"},{\"text\":\"🌱 基础入门\",\"link\":\"/ai/chapter-00\"},{\"text\":\"⚡ 进阶实战\",\"link\":\"/ai/chapter-03\"},{\"text\":\"🤖 Agent Skills\",\"link\":\"/ai/chapter-08-agent-skills\"},{\"text\":\"💼 实战项目\",\"link\":\"/ai/chapter-08\"},{\"text\":\"🌟 拓展提升\",\"link\":\"/ai/chapter-07\"},{\"text\":\"📖 工具速查\",\"link\":\"/ai/appendix-tools\"}]},{\"text\":\"🗄️ 数据库完全指南\",\"items\":[{\"text\":\"📚 学习路线\",\"link\":\"/db/\"},{\"text\":\"🌱 基础入门\",\"link\":\"/db/chapter-01\"},{\"text\":\"🧩 关系型数据库进阶\",\"link\":\"/db/chapter-08\"},{\"text\":\"🏢 国产分布式数据库\",\"link\":\"/db/chapter-15\"},{\"text\":\"🚀 NoSQL与NewSQL\",\"link\":\"/db/chapter-22\"},{\"text\":\"🤖 时序与向量数据库\",\"link\":\"/db/chapter-27\"},{\"text\":\"🔄 迁移与备份实战\",\"link\":\"/db/chapter-migration\"}]},{\"text\":\"🚀 DevOps 实战\",\"items\":[{\"text\":\"📚 学习路线\",\"link\":\"/devops/\"},{\"text\":\"🌱 基础入门\",\"link\":\"/devops/chapter-01\"},{\"text\":\"🐳 容器化编排\",\"link\":\"/devops/chapter-05\"},{\"text\":\"⚙️ CI/CD自动化\",\"link\":\"/devops/chapter-08\"},{\"text\":\"📊 监控运维\",\"link\":\"/devops/chapter-11\"},{\"text\":\"🏗️ 基础设施即代码\",\"link\":\"/devops/chapter-13\"},{\"text\":\"🔄 GitOps实践\",\"link\":\"/devops/chapter-14\"},{\"text\":\"🔒 安全实践\",\"link\":\"/devops/chapter-15\"},{\"text\":\"💼 综合实战项目\",\"link\":\"/devops/appendix-project\"},{\"text\":\"📖 工具速查\",\"link\":\"/devops/appendix-tools\"}]}],\"sidebar\":{\"/interview/\":[{\"text\":\"学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/interview/\"}]},{\"text\":\"前端开发面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/interview/frontend/\"},{\"text\":\"📘 Vue3 技术栈专项\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"📗 中级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Vue3核心面试题\",\"link\":\"/interview/frontend/vue3/intermediate/vue3-core\"},{\"text\":\"组件开发面试题\",\"link\":\"/interview/frontend/vue3/intermediate/component-development\"},{\"text\":\"路由与状态管理面试题\",\"link\":\"/interview/frontend/vue3/intermediate/routing-state\"}]},{\"text\":\"📕 高级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Vue3高级进阶面试题\",\"link\":\"/interview/frontend/vue3/advanced/vue3-advanced\"}]}]},{\"text\":\"⚛️ React 技术栈专项\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"📗 中级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"React核心面试题\",\"link\":\"/interview/frontend/react/intermediate/react-basics\"}]},{\"text\":\"📕 高级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"React 18+与Next.js 14+面试题\",\"link\":\"/interview/frontend/react/advanced/react-nextjs\"}]}]},{\"text\":\"▲ Next.js 技术栈专项\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"📗 中级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Next.js基础面试题\",\"link\":\"/interview/frontend/nextjs/intermediate/nextjs-basics\"}]},{\"text\":\"📕 高级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Next.js高级进阶面试题\",\"link\":\"/interview/frontend/nextjs/advanced/nextjs-advanced\"}]}]},{\"text\":\"🌟 Nuxt 技术栈专项\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"📗 中级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Nuxt基础面试题\",\"link\":\"/interview/frontend/nuxt/intermediate/nuxt-basics\"}]},{\"text\":\"📕 高级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Nuxt高级进阶面试题\",\"link\":\"/interview/frontend/nuxt/advanced/nuxt-advanced\"}]}]}]},{\"text\":\"Java面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/interview/java/\"},{\"text\":\"📗 中级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"Java基础与并发编程\",\"link\":\"/interview/java/intermediate/java-basics\"},{\"text\":\"Spring框架\",\"link\":\"/interview/java/intermediate/spring-framework\"},{\"text\":\"数据库与Redis\",\"link\":\"/interview/java/intermediate/database-redis\"},{\"text\":\"消息队列\",\"link\":\"/interview/java/intermediate/message-queue\"}]},{\"text\":\"📕 高级面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"微服务架构\",\"link\":\"/interview/java/advanced/microservices\"},{\"text\":\"分布式系统\",\"link\":\"/interview/java/advanced/distributed-system\"},{\"text\":\"性能调优\",\"link\":\"/interview/java/advanced/performance-tuning\"}]},{\"text\":\"🚀 实战项目面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"电商微服务平台\",\"link\":\"/interview/java/advanced/project-interview\"}]}]},{\"text\":\"🗄️ 数据库面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/interview/database/\"},{\"text\":\"中级面试题\",\"items\":[{\"text\":\"MySQL基础与优化\",\"link\":\"/interview/database/intermediate/mysql-basics\"},{\"text\":\"PostgreSQL 16+面试题\",\"link\":\"/interview/database/intermediate/postgresql\"},{\"text\":\"Oracle数据库面试题\",\"link\":\"/interview/database/intermediate/oracle\"},{\"text\":\"Redis缓存\",\"link\":\"/interview/database/intermediate/redis-cache\"},{\"text\":\"事务与锁机制\",\"link\":\"/interview/database/intermediate/transaction-lock\"},{\"text\":\"主从复制与高可用\",\"link\":\"/interview/database/intermediate/replication\"}]},{\"text\":\"高级面试题\",\"items\":[{\"text\":\"分库分表架构设计\",\"link\":\"/interview/database/advanced/sharding-distributed\"},{\"text\":\"分布式事务解决方案\",\"link\":\"/interview/database/advanced/distributed-transactions\"},{\"text\":\"国产分布式数据库\",\"link\":\"/interview/database/advanced/domestic-databases\"},{\"text\":\"NoSQL与向量数据库\",\"link\":\"/interview/database/advanced/nosql-vector\"},{\"text\":\"数据库迁移与备份\",\"link\":\"/interview/database/advanced/migration-backup\"}]}]},{\"text\":\"AI面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/interview/ai/\"},{\"text\":\"中级面试题\",\"items\":[{\"text\":\"第1章：Prompt工程基础\",\"link\":\"/interview/ai/intermediate/chapter-01\"},{\"text\":\"第2章：LangChain框架\",\"link\":\"/interview/ai/intermediate/chapter-02\"},{\"text\":\"第3章：RAG检索增强\",\"link\":\"/interview/ai/intermediate/chapter-03\"}]},{\"text\":\"高级面试题\",\"items\":[{\"text\":\"第4章：Agent架构设计\",\"link\":\"/interview/ai/advanced/chapter-04\"},{\"text\":\"第5章：模型调优与部署\",\"link\":\"/interview/ai/advanced/chapter-05\"},{\"text\":\"第6章：AI应用实战\",\"link\":\"/interview/ai/advanced/chapter-06\"},{\"text\":\"第7章：AI大型项目实战面试题\",\"link\":\"/interview/ai/advanced/chapter-07\"}]}]},{\"text\":\"Git面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/interview/git/\"},{\"text\":\"中级面试题\",\"items\":[{\"text\":\"第1章：Git基础命令\",\"link\":\"/interview/git/intermediate/chapter-01\"},{\"text\":\"第2章：分支管理\",\"link\":\"/interview/git/intermediate/chapter-02\"},{\"text\":\"第3章：工作流程\",\"link\":\"/interview/git/intermediate/chapter-03\"}]},{\"text\":\"高级面试题\",\"items\":[{\"text\":\"第4章：Git高级技巧\",\"link\":\"/interview/git/advanced/chapter-04\"},{\"text\":\"第5章：团队协作最佳实践\",\"link\":\"/interview/git/advanced/chapter-05\"},{\"text\":\"第6章：Git性能优化\",\"link\":\"/interview/git/advanced/chapter-06\"}]}]},{\"text\":\"DevOps面试题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/interview/devops/\"},{\"text\":\"中级面试题\",\"items\":[{\"text\":\"第1章：容器化与编排\",\"link\":\"/interview/devops/intermediate/chapter-01\"},{\"text\":\"第2章：CI/CD基础\",\"link\":\"/interview/devops/intermediate/chapter-02\"},{\"text\":\"第3章：监控与日志\",\"link\":\"/interview/devops/intermediate/chapter-03\"}]},{\"text\":\"高级面试题\",\"items\":[{\"text\":\"第4章：云原生架构\",\"link\":\"/interview/devops/advanced/chapter-04\"},{\"text\":\"第5章：DevSecOps与安全\",\"link\":\"/interview/devops/advanced/chapter-05\"},{\"text\":\"第6章：服务网格与GitOps\",\"link\":\"/interview/devops/advanced/chapter-06\"},{\"text\":\"第7章：DevOps企业级项目实战面试题\",\"link\":\"/interview/devops/advanced/chapter-07\"}]}]}],\"/git/\":[{\"text\":\"学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/git/\"}]},{\"text\":\"基础入门\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：Git基础入门\",\"link\":\"/git/chapter-01\"},{\"text\":\"第2章：Git常用命令\",\"link\":\"/git/chapter-02\"},{\"text\":\"第3章：Git分支管理\",\"link\":\"/git/chapter-03\"}]},{\"text\":\"进阶\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第4章：Git工作流程\",\"link\":\"/git/workflow\"},{\"text\":\"第5章：Git实战技巧\",\"link\":\"/git/chapter-05\"}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"附录：Git命令速查手册\",\"link\":\"/git/appendix\"}]}],\"/ai/\":[{\"text\":\"学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/ai/\"}]},{\"text\":\"基础入门\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：AI辅助开发\",\"link\":\"/ai/chapter-00\"},{\"text\":\"第2章：工具配置指南\",\"link\":\"/ai/tools-setup\"},{\"text\":\"第3章：AI应用基础\",\"link\":\"/ai/chapter-01\"},{\"text\":\"第4章：LangChain框架\",\"link\":\"/ai/chapter-02\"}]},{\"text\":\"进阶\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第5章：Prompt工程\",\"link\":\"/ai/chapter-03\",\"items\":[{\"text\":\"核心原则\",\"link\":\"/ai/chapter-03#核心原则\"},{\"text\":\"常用提示词模式\",\"link\":\"/ai/chapter-03#常用提示词模式\"},{\"text\":\"高级技巧\",\"link\":\"/ai/chapter-03#高级技巧\"}]},{\"text\":\"第6章：RAG检索增强\",\"link\":\"/ai/chapter-04\"},{\"text\":\"第7章：AI Agent\",\"link\":\"/ai/chapter-05\"}]},{\"text\":\"🤖 Agent Skills\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第8章：2026 Agent Skills 完全指南\",\"link\":\"/ai/chapter-08-agent-skills\"}]},{\"text\":\"🚀 企业级实战项目\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第9章：AI 完全实战项目 - 企业级智能客服系统\",\"link\":\"/ai/chapter-08\"},{\"text\":\"第10章：AI 完全实战项目 - 企业级数据分析与商业智能平台\",\"link\":\"/ai/chapter-09\"},{\"text\":\"第11章：AI 完全实战项目 - 多模态内容生成与管理平台\",\"link\":\"/ai/chapter-10\"}]},{\"text\":\"拓展\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第13章：应用进阶\",\"link\":\"/ai/chapter-07\",\"items\":[{\"text\":\"主流LLM模型\",\"link\":\"/ai/chapter-07#主流llm模型对比\"},{\"text\":\"Claude API\",\"link\":\"/ai/chapter-07#claude-api使用\"},{\"text\":\"本地模型部署\",\"link\":\"/ai/chapter-07#开源模型和本地部署\"},{\"text\":\"Moltbot框架\",\"link\":\"/ai/chapter-07#moltbot框架\"},{\"text\":\"LangGraph框架\",\"link\":\"/ai/chapter-07#langgraph复杂agent框架\"},{\"text\":\"LangGraph常见模式\",\"link\":\"/ai/chapter-07#langgraph-常见模式\"},{\"text\":\"LangGraph实战项目\",\"link\":\"/ai/chapter-07#实战项目智能内容生成系统\"},{\"text\":\"应用评估\",\"link\":\"/ai/chapter-07#ai应用评估和测试\"}]}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"附录：AI工具速查手册\",\"link\":\"/ai/appendix-tools\"}]}],\"/guide/\":[{\"text\":\"学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/guide/\"}]},{\"text\":\"📘 Vue3 技术栈\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"基础入门\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：AI辅助前端开发\",\"link\":\"/guide/chapter-00\",\"items\":[{\"text\":\"为什么学习 Vue3\",\"link\":\"/guide/chapter-00#为什么学习-vue3\"},{\"text\":\"学习路径图\",\"link\":\"/guide/chapter-00#学习路径图\"},{\"text\":\"AI 辅助开发\",\"link\":\"/guide/chapter-00#为什么需要-ai-辅助开发\"}]},{\"text\":\"第2章：JavaScript核心基础\",\"link\":\"/guide/chapter-01\",\"items\":[{\"text\":\"数组方法完全指南\",\"link\":\"/guide/chapter-01#数组方法完全指南\"},{\"text\":\"遍历方法\",\"link\":\"/guide/chapter-01#遍历方法\"},{\"text\":\"查找方法\",\"link\":\"/guide/chapter-01#查找方法\"}]},{\"text\":\"第3章：Vue3简介与环境搭建\",\"link\":\"/guide/chapter-02\",\"items\":[{\"text\":\"什么是Vue3\",\"link\":\"/guide/chapter-02#什么是vue3\"},{\"text\":\"开发环境搭建\",\"link\":\"/guide/chapter-02#开发环境搭建\"},{\"text\":\"SFC单文件组件\",\"link\":\"/guide/chapter-02#sfc单文件组件\"}]},{\"text\":\"第4章：ESLint代码检查\",\"link\":\"/guide/chapter-03\"},{\"text\":\"第5章：CSS基础语法\",\"link\":\"/guide/chapter-04\",\"items\":[{\"text\":\"什么是CSS\",\"link\":\"/guide/chapter-04#什么是css\"},{\"text\":\"CSS选择器详解\",\"link\":\"/guide/chapter-04#css选择器详解\"},{\"text\":\"DIV盒子模型\",\"link\":\"/guide/chapter-04#div盒子模型完全指南\"}]},{\"text\":\"第6章：CSS预处理器 - Less\",\"link\":\"/guide/chapter-05\",\"items\":[{\"text\":\"什么是Less\",\"link\":\"/guide/chapter-05#什么是less\"},{\"text\":\"Less核心特性\",\"link\":\"/guide/chapter-05#less核心特性\"}]},{\"text\":\"第7章：CSS预处理器 - SCSS\",\"link\":\"/guide/chapter-06\",\"items\":[{\"text\":\"什么是SCSS\",\"link\":\"/guide/chapter-06#什么是scss\"},{\"text\":\"SCSS核心特性\",\"link\":\"/guide/chapter-06#scss核心特性\"}]},{\"text\":\"第8章：代码规范\",\"link\":\"/guide/chapter-07\"},{\"text\":\"第9章：模板语法与数据绑定\",\"link\":\"/guide/chapter-08\"}]},{\"text\":\"组件开发\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第10章：计算属性与侦听器\",\"link\":\"/guide/chapter-09\"},{\"text\":\"第11章：条件渲染与列表渲染\",\"link\":\"/guide/chapter-10\"},{\"text\":\"第12章：事件处理与表单绑定\",\"link\":\"/guide/chapter-11\"},{\"text\":\"第13章：组件基础与组件名称定义\",\"link\":\"/guide/chapter-12\"},{\"text\":\"第14章：组件通信（完整版）\",\"link\":\"/guide/chapter-13\",\"items\":[{\"text\":\"Props 父传子\",\"link\":\"/guide/chapter-13#props-父传子详解\"},{\"text\":\"Emit 子传父\",\"link\":\"/guide/chapter-13#emit-子传父详解\"},{\"text\":\"Provide/Inject\",\"link\":\"/guide/chapter-13#provide--inject-跨层级通信\"},{\"text\":\"插槽 Slots\",\"link\":\"/guide/chapter-13#插槽-slots\"},{\"text\":\"作用域插槽\",\"link\":\"/guide/chapter-13#作用域插槽\"}]},{\"text\":\"第15章：组合式API深入\",\"link\":\"/guide/chapter-14\",\"items\":[{\"text\":\"ref 和 reactive\",\"link\":\"/guide/chapter-14#ref-和-reactive\"},{\"text\":\"computed 和 watch\",\"link\":\"/guide/chapter-14#computed-和-watch\"},{\"text\":\"组合式函数\",\"link\":\"/guide/chapter-14#组合式函数composables\"},{\"text\":\"⭐ 高级特性\",\"link\":\"/guide/chapter-14-advanced\"}]},{\"text\":\"第16章：生命周期与钩子函数\",\"link\":\"/guide/chapter-15\",\"items\":[{\"text\":\"生命周期钩子使用\",\"link\":\"/guide/chapter-15#生命周期钩子使用\"},{\"text\":\"生命周期实战应用\",\"link\":\"/guide/chapter-15#生命周期实战应用场景\"}]}]},{\"text\":\"企业级开发\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第17章：Vue Router 路由完全指南\",\"link\":\"/guide/chapter-16\",\"items\":[{\"text\":\"安装和配置\",\"link\":\"/guide/chapter-16#安装和配置\"},{\"text\":\"路由使用\",\"link\":\"/guide/chapter-16#路由使用\"},{\"text\":\"编程式导航\",\"link\":\"/guide/chapter-16#编程式导航\"},{\"text\":\"路由守卫与权限控制\",\"link\":\"/guide/chapter-16#路由守卫与权限控制\"},{\"text\":\"⭐ 高级特性\",\"link\":\"/guide/chapter-16-advanced\"}]},{\"text\":\"第18章：VueUse组合式函数库完全指南\",\"link\":\"/guide/chapter-17\",\"items\":[{\"text\":\"VueUse简介与安装\",\"link\":\"/guide/chapter-17#vueuse简介与安装\"},{\"text\":\"核心函数详解\",\"link\":\"/guide/chapter-17#核心函数详解\"},{\"text\":\"动画相关函数\",\"link\":\"/guide/chapter-17#动画相关函数\"}]},{\"text\":\"第19章：Pinia 状态管理\",\"link\":\"/guide/chapter-18\",\"items\":[{\"text\":\"⭐ 高级特性\",\"link\":\"/guide/chapter-18-advanced\"}]},{\"text\":\"第20章：TypeScript + Vue3\",\"link\":\"/guide/chapter-19\"},{\"text\":\"第21章：高级特性\",\"link\":\"/guide/chapter-20\"},{\"text\":\"第22章：ElementPlus组件库完全指南\",\"link\":\"/guide/chapter-21\"},{\"text\":\"第23章：企业级配置\",\"link\":\"/guide/chapter-22\"},{\"text\":\"第24章：性能优化\",\"link\":\"/guide/chapter-23\"},{\"text\":\"第25章：Git版本控制与团队协作\",\"link\":\"/guide/chapter-24\"}]},{\"text\":\"进阶部分\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第26章：全局异常捕获\",\"link\":\"/guide/chapter-25\"},{\"text\":\"第27章：API请求拦截\",\"link\":\"/guide/chapter-26\"},{\"text\":\"第28章：内存管理与溢出处理\",\"link\":\"/guide/chapter-27\"},{\"text\":\"第29章：调试技巧与工具\",\"link\":\"/guide/chapter-28\"},{\"text\":\"第30章：微前端架构（qiankun 集成）\",\"link\":\"/guide/chapter-29\"},{\"text\":\"第31章：前端安全防护\",\"link\":\"/guide/chapter-30\"},{\"text\":\"第32章：前端测试\",\"link\":\"/guide/chapter-31\"},{\"text\":\"第33章：表单验证与数据校验\",\"link\":\"/guide/chapter-32\"},{\"text\":\"第34章：Electron桌面应用开发\",\"link\":\"/guide/chapter-33\"},{\"text\":\"第35章：国际化（I18n）\",\"link\":\"/guide/chapter-34\"},{\"text\":\"第36章：前端可视化\",\"link\":\"/guide/chapter-35\"},{\"text\":\"第37章：前端监控与埋点\",\"link\":\"/guide/chapter-36\"},{\"text\":\"第38章：前端部署\",\"link\":\"/guide/chapter-37\"},{\"text\":\"第39章：Vite 插件开发\",\"link\":\"/guide/chapter-38\"},{\"text\":\"第40章：前端工程化进阶\",\"link\":\"/guide/chapter-39\"}]},{\"text\":\"高级拓展\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第41章：Vue3.4+最新特性详解\",\"link\":\"/guide/chapter-40\"},{\"text\":\"第42章：常见踩坑指南与FAQ\",\"link\":\"/guide/chapter-41\"},{\"text\":\"第43章：使用 Mock.js 进行数据模拟\",\"link\":\"/guide/chapter-42\"},{\"text\":\"第44章：服务端渲染(SSR)与Nuxt.js完全指南\",\"link\":\"/guide/chapter-43\"},{\"text\":\"第45章：移动端开发与响应式设计完全指南\",\"link\":\"/guide/chapter-44\"},{\"text\":\"第46章：Vue3组件库开发完全指南\",\"link\":\"/guide/chapter-45\"},{\"text\":\"第47章：性能分析与优化工具深度使用\",\"link\":\"/guide/chapter-46\"},{\"text\":\"第48章：uni-app跨端应用开发完全指南\",\"link\":\"/guide/chapter-47\"},{\"text\":\"第49章：Vite 5.x构建工具完全指南\",\"link\":\"/guide/chapter-48\"},{\"text\":\"第50章：Bun包管理器完全指南\",\"link\":\"/guide/chapter-49\"}]},{\"text\":\"🚀 企业级实战项目\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第51章：Vue3 完全实战项目 - 企业级后台管理系统\",\"link\":\"/guide/chapter-50-project\"},{\"text\":\"第52章：Vue3 完全实战项目 - 企业级SaaS平台\",\"link\":\"/guide/chapter-51-project\"},{\"text\":\"第53章：Vue3 完全实战项目 - 移动端+管理后台全栈应用\",\"link\":\"/guide/chapter-52-project\"},{\"text\":\"第54章：Vue3 完全实战项目 - 微前端企业级应用平台 (qiankun)\",\"link\":\"/guide/chapter-53-project\"},{\"text\":\"第55章：Vue3 完全实战项目 - 基于MicroApp的企业级微电商平台 (京东)\",\"link\":\"/guide/chapter-54-project\"}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"附录：Vue3开发工具速查手册\",\"link\":\"/guide/vue3/appendix-tools\"}]}]},{\"text\":\"⚛️ React 18+ 技术栈\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"📚 学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/guide/react/\"}]},{\"text\":\"基础入门\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：React 18+环境搭建与基础\",\"link\":\"/guide/react/chapter-51\"},{\"text\":\"第2章：JSX语法与组件基础\",\"link\":\"/guide/react/chapter-52\"},{\"text\":\"第3章：Props与State详解\",\"link\":\"/guide/react/chapter-53\"},{\"text\":\"第4章：事件处理与条件渲染\",\"link\":\"/guide/react/chapter-54\"},{\"text\":\"第5章：列表渲染与Keys\",\"link\":\"/guide/react/chapter-55\"},{\"text\":\"第6章：表单处理（受控/非受控）\",\"link\":\"/guide/react/chapter-56\"}]},{\"text\":\"React Hooks 完全指南\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第7章：useState与useEffect基础\",\"link\":\"/guide/react/chapter-57\"},{\"text\":\"第8章：useContext与useReducer\",\"link\":\"/guide/react/chapter-58\"},{\"text\":\"第9章：useRef与useMemo\",\"link\":\"/guide/react/chapter-59\"},{\"text\":\"第10章：useCallback与性能优化\",\"link\":\"/guide/react/chapter-60\"},{\"text\":\"第11章：自定义Hooks开发\",\"link\":\"/guide/react/chapter-61\"},{\"text\":\"第12章：Hooks最佳实践与常见陷阱\",\"link\":\"/guide/react/chapter-62\"}]},{\"text\":\"React生态与进阶\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第13章：React Router 6+完全指南\",\"link\":\"/guide/react/chapter-63\"},{\"text\":\"第14章：状态管理：Zustand完全指南\",\"link\":\"/guide/react/chapter-64\"},{\"text\":\"第15章：状态管理：Jotai与Recoil\",\"link\":\"/guide/react/chapter-65\"},{\"text\":\"第16章：TanStack Query（React Query）\",\"link\":\"/guide/react/chapter-66\"},{\"text\":\"第17章：React Hook Form表单管理\",\"link\":\"/guide/react/chapter-67\"}]},{\"text\":\"React 18+ 并发特性\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第18章：自动批处理（Automatic Batching）\",\"link\":\"/guide/react/chapter-68\"},{\"text\":\"第19章：Suspense与数据获取\",\"link\":\"/guide/react/chapter-69\"},{\"text\":\"第20章：useTransition与useDeferredValue\",\"link\":\"/guide/react/chapter-70\"},{\"text\":\"第21章：useId与并发渲染\",\"link\":\"/guide/react/chapter-71\"},{\"text\":\"第22章：React Server Components\",\"link\":\"/guide/react/chapter-72\"}]},{\"text\":\"React 19 新特性\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第23章：React 19新特性概览\",\"link\":\"/guide/react/chapter-73\"},{\"text\":\"第24章：Actions与useActionState\",\"link\":\"/guide/react/chapter-74\"},{\"text\":\"第25章：useOptimistic与新的use() hook\",\"link\":\"/guide/react/chapter-75\"},{\"text\":\"第26章：React 19性能优化\",\"link\":\"/guide/react/chapter-76\"}]},{\"text\":\"高级主题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第27章：React性能优化完全指南\",\"link\":\"/guide/react/chapter-77\"},{\"text\":\"第28章：React组件设计模式\",\"link\":\"/guide/react/chapter-78\"},{\"text\":\"第29章：React测试（Vitest + Testing Library）\",\"link\":\"/guide/react/chapter-79\"},{\"text\":\"第30章：React项目架构与最佳实践\",\"link\":\"/guide/react/chapter-80\"}]},{\"text\":\"🚀 企业级实战项目\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第31章：React 19 完全实战项目 - 企业级任务管理系统\",\"link\":\"/guide/react/chapter-80-project\"},{\"text\":\"第32章：React 19 + Next.js 15 完全实战项目 - 现代化电商平台\",\"link\":\"/guide/react/chapter-81\"},{\"text\":\"第33章：React 19 完全实战项目 - 实时数据可视化大屏系统\",\"link\":\"/guide/react/chapter-82\"}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"附录：React开发工具速查手册\",\"link\":\"/guide/react/appendix-tools\"}]}]},{\"text\":\"▲ Next.js 14+ 技术栈\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"📚 学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/guide/nextjs/\"}]},{\"text\":\"基础入门\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：Next.js 14+简介与环境搭建\",\"link\":\"/guide/nextjs/chapter-81\"},{\"text\":\"第2章：App Router核心概念\",\"link\":\"/guide/nextjs/chapter-82\"},{\"text\":\"第3章：Pages Router与App Router对比\",\"link\":\"/guide/nextjs/chapter-83\"},{\"text\":\"第4章：路由系统完全指南\",\"link\":\"/guide/nextjs/chapter-84\"},{\"text\":\"第5章：布局与模板系统\",\"link\":\"/guide/nextjs/chapter-85\"},{\"text\":\"第6章：链接与导航\",\"link\":\"/guide/nextjs/chapter-86\"}]},{\"text\":\"服务端组件与渲染\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第7章：Server Components完全指南\",\"link\":\"/guide/nextjs/chapter-87\"},{\"text\":\"第8章：Client Components使用\",\"link\":\"/guide/nextjs/chapter-88\"},{\"text\":\"第9章：静态生成（SSG）\",\"link\":\"/guide/nextjs/chapter-89\"},{\"text\":\"第10章：服务端渲染（SSR）\",\"link\":\"/guide/nextjs/chapter-90\"},{\"text\":\"第11章：增量静态再生（ISR）\",\"link\":\"/guide/nextjs/chapter-91\"}]},{\"text\":\"数据获取与Server Actions\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第12章：数据获取完全指南\",\"link\":\"/guide/nextjs/chapter-92\"},{\"text\":\"第13章：Server Actions详解\",\"link\":\"/guide/nextjs/chapter-93\"},{\"text\":\"第14章：表单处理与验证\",\"link\":\"/guide/nextjs/chapter-94\"},{\"text\":\"第15章：错误处理与加载状态\",\"link\":\"/guide/nextjs/chapter-95\"},{\"text\":\"第16章：缓存策略与Revalidation\",\"link\":\"/guide/nextjs/chapter-96\"}]},{\"text\":\"路由高级特性\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第17章：动态路由与路由参数\",\"link\":\"/guide/nextjs/chapter-97\"},{\"text\":\"第18章：路由组与并行路由\",\"link\":\"/guide/nextjs/chapter-98\"},{\"text\":\"第19章：拦截路由与Modals\",\"link\":\"/guide/nextjs/chapter-99\"},{\"text\":\"第20章：中间件（Middleware）\",\"link\":\"/guide/nextjs/chapter-100\"},{\"text\":\"第21章：路由Handler与API\",\"link\":\"/guide/nextjs/chapter-101\"}]},{\"text\":\"样式与优化\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第22章：Tailwind CSS集成\",\"link\":\"/guide/nextjs/chapter-102\"},{\"text\":\"第23章：CSS Modules与Styled JSX\",\"link\":\"/guide/nextjs/chapter-103\"},{\"text\":\"第24章：图片优化与字体优化\",\"link\":\"/guide/nextjs/chapter-104\"},{\"text\":\"第25章：Script优化与资源加载\",\"link\":\"/guide/nextjs/chapter-105\"},{\"text\":\"第26章：性能优化完全指南\",\"link\":\"/guide/nextjs/chapter-106\"}]},{\"text\":\"Next.js 15+ 高级主题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第27章：Next.js 15新特性\",\"link\":\"/guide/nextjs/chapter-107\"},{\"text\":\"第28章：全栈开发实战\",\"link\":\"/guide/nextjs/chapter-108\"},{\"text\":\"第29章：部署与运维\",\"link\":\"/guide/nextjs/chapter-109\"},{\"text\":\"第30章：Next.js最佳实践\",\"link\":\"/guide/nextjs/chapter-110\"}]},{\"text\":\"🚀 企业级实战项目\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第31章：Next.js 15 完全实战项目 - AI内容生成平台\",\"link\":\"/guide/nextjs/chapter-111\"},{\"text\":\"第32章：Next.js 15 完全实战项目 - 企业级CMS系统\",\"link\":\"/guide/nextjs/chapter-112\"},{\"text\":\"第33章：Next.js 15 完全实战项目 - 微服务架构电商平台\",\"link\":\"/guide/nextjs/chapter-113\"}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"附录：Next.js开发工具速查手册\",\"link\":\"/guide/nextjs/appendix-tools\"}]}]},{\"text\":\"🌟 Nuxt 3+ 技术栈\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"📚 学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/guide/nuxt/\"}]},{\"text\":\"基础入门\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：Nuxt 3+简介与环境搭建\",\"link\":\"/guide/nuxt/chapter-111\"},{\"text\":\"第2章：Nuxt目录结构与约定\",\"link\":\"/guide/nuxt/chapter-112\"},{\"text\":\"第3章：路由系统自动生成\",\"link\":\"/guide/nuxt/chapter-113\"},{\"text\":\"第4章：页面与布局系统\",\"link\":\"/guide/nuxt/chapter-114\"},{\"text\":\"第5章：组件与自动化导入\",\"link\":\"/guide/nuxt/chapter-115\"},{\"text\":\"第6章：Nuxt 3+配置文件\",\"link\":\"/guide/nuxt/chapter-116\"}]},{\"text\":\"组合式函数与状态管理\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第7章：useAsyncData与useFetch\",\"link\":\"/guide/nuxt/chapter-117\"},{\"text\":\"第8章：useRoute与useRouter\",\"link\":\"/guide/nuxt/chapter-118\"},{\"text\":\"第9章：useState与useState\",\"link\":\"/guide/nuxt/chapter-119\"},{\"text\":\"第10章：useCookie与useHead\",\"link\":\"/guide/nuxt/chapter-120\"},{\"text\":\"第11章：Pinia状态管理集成\",\"link\":\"/guide/nuxt/chapter-121\"}]},{\"text\":\"服务端渲染与路由\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第12章：SSR渲染原理与实践\",\"link\":\"/guide/nuxt/chapter-122\"},{\"text\":\"第13章：SSG静态站点生成\",\"link\":\"/guide/nuxt/chapter-123\"},{\"text\":\"第14章：ISR增量静态再生\",\"link\":\"/guide/nuxt/chapter-124\"},{\"text\":\"第15章：动态路由与路由参数\",\"link\":\"/guide/nuxt/chapter-125\"},{\"text\":\"第16章：路由中间件与守卫\",\"link\":\"/guide/nuxt/chapter-126\"}]},{\"text\":\"服务端API与数据库\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第17章：Server Routes与API\",\"link\":\"/guide/nuxt/chapter-127\"},{\"text\":\"第18章：Nitro服务端引擎\",\"link\":\"/guide/nuxt/chapter-128\"},{\"text\":\"第19章：数据库集成（Prisma）\",\"link\":\"/guide/nuxt/chapter-129\"},{\"text\":\"第20章：认证与会话管理\",\"link\":\"/guide/nuxt/chapter-130\"},{\"text\":\"第21章：文件上传与处理\",\"link\":\"/guide/nuxt/chapter-131\"}]},{\"text\":\"模块系统与插件\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第22章：Nuxt Modules模块开发\",\"link\":\"/guide/nuxt/chapter-132\"},{\"text\":\"第23章：常用Nuxt模块\",\"link\":\"/guide/nuxt/chapter-133\"},{\"text\":\"第24章：Nuxt Plugins插件开发\",\"link\":\"/guide/nuxt/chapter-134\"},{\"text\":\"第25章： composables组合式函数\",\"link\":\"/guide/nuxt/chapter-135\"}]},{\"text\":\"Nuxt 4+ 高级主题\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第26章：Nuxt 4新特性与迁移\",\"link\":\"/guide/nuxt/chapter-136\"},{\"text\":\"第27章：性能优化完全指南\",\"link\":\"/guide/nuxt/chapter-137\"},{\"text\":\"第28章：部署（Vercel/Cloudflare）\",\"link\":\"/guide/nuxt/chapter-138\"},{\"text\":\"第29章：Nuxt最佳实践与架构\",\"link\":\"/guide/nuxt/chapter-139\"}]},{\"text\":\"🚀 企业级实战项目\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第30章：全栈实战项目 - 电商后台管理系统\",\"link\":\"/guide/nuxt/chapter-140\"},{\"text\":\"第31章：Nuxt 4 完全实战项目 - 实时协作平台\",\"link\":\"/guide/nuxt/chapter-141\"},{\"text\":\"第32章：Nuxt 4 完全实战项目 - 社交网络与内容社区平台\",\"link\":\"/guide/nuxt/chapter-142\"}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"附录：Nuxt开发工具速查手册\",\"link\":\"/guide/nuxt/appendix-tools\"}]}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"附录A：学习资源推荐\",\"link\":\"/guide/appendix-resources\"},{\"text\":\"附录B：VSCode配置推荐\",\"link\":\"/guide/appendix-vscode\"},{\"text\":\"附录C：代码模板与脚手架\",\"link\":\"/guide/appendix-templates\"},{\"text\":\"附录D：快速开始检查清单\",\"link\":\"/guide/appendix-checklist\"},{\"text\":\"附录E：Git命令速查手册\",\"link\":\"/guide/appendix-git\"}]}],\"/java/\":[{\"text\":\"学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/java/\"}]},{\"text\":\"基础入门\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：Java简介与环境搭建\",\"link\":\"/java/chapter-114\"},{\"text\":\"第2章：Java基础语法\",\"link\":\"/java/chapter-115\"},{\"text\":\"第3章：面向对象编程\",\"link\":\"/java/chapter-116\"},{\"text\":\"第4章：数组与集合框架\",\"link\":\"/java/chapter-117\"},{\"text\":\"第5章：异常处理与调试\",\"link\":\"/java/chapter-118\"},{\"text\":\"第6章：IO流与文件操作\",\"link\":\"/java/chapter-119\"},{\"text\":\"第7章：多线程基础\",\"link\":\"/java/chapter-120\"},{\"text\":\"第8章：泛型与注解\",\"link\":\"/java/chapter-121\"},{\"text\":\"第9章：Lambda表达式与Stream API\",\"link\":\"/java/chapter-122\"},{\"text\":\"第10章：Java新特性（Java 17-21）\",\"link\":\"/java/chapter-123\"}]},{\"text\":\"Web开发\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第11章：Spring Boot 3.x快速入门\",\"link\":\"/java/chapter-124\"},{\"text\":\"第12章：Spring MVC开发\",\"link\":\"/java/chapter-125\"},{\"text\":\"第13章：API设计与调用\",\"link\":\"/java/chapter-125-api\"},{\"text\":\"第14章：Spring Data JPA数据访问\",\"link\":\"/java/chapter-126\"},{\"text\":\"第15章：Spring Security + JWT认证\",\"link\":\"/java/chapter-127\"},{\"text\":\"第16章：Redis缓存与分布式锁\",\"link\":\"/java/chapter-128\"},{\"text\":\"第17章：主流数据库与企业级应用\",\"link\":\"/java/chapter-128-database\"},{\"text\":\"第18章：RabbitMQ/Kafka消息队列\",\"link\":\"/java/chapter-129\"},{\"text\":\"第19章：响应式编程（WebFlux）\",\"link\":\"/java/chapter-130\"},{\"text\":\"第20章：实战项目1：个人博客系统\",\"link\":\"/java/chapter-131\"}]},{\"text\":\"微服务全家桶\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第21章：Nacos注册中心与配置中心\",\"link\":\"/java/chapter-132\"},{\"text\":\"第22章：Sentinel熔断限流降级\",\"link\":\"/java/chapter-133\"},{\"text\":\"第23章：Seata分布式事务\",\"link\":\"/java/chapter-134\"},{\"text\":\"第24章：Spring Cloud Gateway网关\",\"link\":\"/java/chapter-135\"},{\"text\":\"第25章：Skywalking链路追踪\",\"link\":\"/java/chapter-136\"},{\"text\":\"第26章：定时任务与异步处理\",\"link\":\"/java/chapter-137\"},{\"text\":\"第27章：日志管理与监控（ELK）\",\"link\":\"/java/chapter-138\"},{\"text\":\"第28章：实战项目2：电商平台微服务版\",\"link\":\"/java/chapter-139\"},{\"text\":\"第29章：实战项目3：在线教育平台（AI集成）\",\"link\":\"/java/chapter-140\"},{\"text\":\"第30章：实战项目4：微服务架构完整系统\",\"link\":\"/java/chapter-141\"}]},{\"text\":\"高级进阶\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第31章：虚拟线程实战（Java 21）\",\"link\":\"/java/chapter-142\"},{\"text\":\"第32章：GraalVM原生镜像\",\"link\":\"/java/chapter-143\"},{\"text\":\"第33章：Spring AI完全指南\",\"link\":\"/java/chapter-144\"},{\"text\":\"第34章：Quarkus云原生框架\",\"link\":\"/java/chapter-145\"},{\"text\":\"第35章：事件驱动架构\",\"link\":\"/java/chapter-146\"},{\"text\":\"第36章：JVM性能调优\",\"link\":\"/java/chapter-147\"},{\"text\":\"第37章：企业级架构设计\",\"link\":\"/java/chapter-148\"}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"📖 附录：Java开发工具速查手册\",\"link\":\"/java/appendix-tools\"}]}],\"/devops/\":[{\"text\":\"学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/devops/\"}]},{\"text\":\"基础入门\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：DevOps概述\",\"link\":\"/devops/chapter-01\"},{\"text\":\"第2章：Linux基础\",\"link\":\"/devops/chapter-02\"},{\"text\":\"第3章：Shell脚本编程\",\"link\":\"/devops/chapter-03\"},{\"text\":\"第4章：Git版本控制\",\"link\":\"/devops/chapter-04\"}]},{\"text\":\"容器化与编排\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第5章：Docker容器化\",\"link\":\"/devops/chapter-05\"},{\"text\":\"第6章：Docker Compose编排\",\"link\":\"/devops/chapter-06\"},{\"text\":\"第7章：Kubernetes容器编排\",\"link\":\"/devops/chapter-07\"}]},{\"text\":\"CI/CD与自动化\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第8章：CI/CD基础概念\",\"link\":\"/devops/chapter-08\"},{\"text\":\"第9章：Jenkins持续集成\",\"link\":\"/devops/chapter-09\"},{\"text\":\"第10章：GitLab CI与GitHub Actions\",\"link\":\"/devops/chapter-10\"}]},{\"text\":\"监控与运维\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第11章：系统监控与日志\",\"link\":\"/devops/chapter-11\"},{\"text\":\"第12章：自动化运维实战\",\"link\":\"/devops/chapter-12\"}]},{\"text\":\"基础设施即代码\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第13章：Terraform基础设施即代码\",\"link\":\"/devops/chapter-13\"}]},{\"text\":\"GitOps实践\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第14章：Argo CD与GitOps\",\"link\":\"/devops/chapter-14\"}]},{\"text\":\"安全实践\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第15章：DevSecOps安全实践\",\"link\":\"/devops/chapter-15\"}]},{\"text\":\"🚀 企业级实战项目\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第16章：DevOps 完全实战项目 - Kubernetes多集群管理系统\",\"link\":\"/devops/chapter-16-project\"},{\"text\":\"第17章：DevOps 完全实战项目 - Platform Engineering 企业级内部开发者平台\",\"link\":\"/devops/chapter-17-project\"},{\"text\":\"第18章：DevOps 完全实战项目 - AIOps AI驱动的智能运维系统\",\"link\":\"/devops/chapter-18-project\"}]},{\"text\":\"附录\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"附录：DevOps工具速查手册\",\"link\":\"/devops/appendix-tools\"}]}],\"/db/\":[{\"text\":\"学习路线\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"学习路线\",\"link\":\"/db/\"}]},{\"text\":\"基础入门（第1-7章）\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第1章：数据库简介与环境搭建\",\"link\":\"/db/chapter-01\"},{\"text\":\"第2章：SQL 核心基础\",\"link\":\"/db/chapter-02\"},{\"text\":\"第3章：MySQL 8.0 快速入门\",\"link\":\"/db/chapter-03\"},{\"text\":\"第4章：PostgreSQL 16 快速入门\",\"link\":\"/db/chapter-04\"},{\"text\":\"第5章：Oracle 快速入门\",\"link\":\"/db/chapter-05\"},{\"text\":\"第6章：Redis 7.x 快速入门\",\"link\":\"/db/chapter-06\"},{\"text\":\"第7章：实战项目1 - 个人博客数据库设计\",\"link\":\"/db/chapter-07\"}]},{\"text\":\"关系型数据库进阶（第8-14章）\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第8章：MySQL 8.0+ 新特性深度解析\",\"link\":\"/db/chapter-08\"},{\"text\":\"第9章：PostgreSQL 16+ 高级特性\",\"link\":\"/db/chapter-09\"},{\"text\":\"第10章：索引优化与性能调优\",\"link\":\"/db/chapter-10\"},{\"text\":\"第11章：事务与锁机制\",\"link\":\"/db/chapter-11\"},{\"text\":\"第12章：主从复制与高可用\",\"link\":\"/db/chapter-12\"},{\"text\":\"第13章：实战项目2 - 电商数据库设计\",\"link\":\"/db/chapter-13\"},{\"text\":\"第14章：数据库性能调优完全指南\",\"link\":\"/db/chapter-14\"}]},{\"text\":\"国产分布式数据库（第15-21章）\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第15章：OceanBase 架构与实践\",\"link\":\"/db/chapter-15\"},{\"text\":\"第16章：TiDB HTAP 架构\",\"link\":\"/db/chapter-16\"},{\"text\":\"第17章：达梦 DM8 迁移实战\",\"link\":\"/db/chapter-17\"},{\"text\":\"第18章：人大金仓 KingbaseES 实战\",\"link\":\"/db/chapter-18\"},{\"text\":\"第19章：openGauss 与 GaussDB\",\"link\":\"/db/chapter-19\"},{\"text\":\"第20章：TDSQL 腾讯云实践\",\"link\":\"/db/chapter-20\"},{\"text\":\"第21章：GBase 南大通用数据库\",\"link\":\"/db/chapter-21\"}]},{\"text\":\"NoSQL 与 NewSQL（第22-26章）\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第22章：MongoDB 文档数据库\",\"link\":\"/db/chapter-22\"},{\"text\":\"第23章：Redis 高级应用\",\"link\":\"/db/chapter-23\"},{\"text\":\"第24章：Elasticsearch 搜索引擎\",\"link\":\"/db/chapter-24\"},{\"text\":\"第25章：分库分表架构设计\",\"link\":\"/db/chapter-25\"},{\"text\":\"第26章：分布式事务解决方案\",\"link\":\"/db/chapter-26\"}]},{\"text\":\"时序与向量数据库（第27-30章）\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"第27章：InfluxDB 时序数据库\",\"link\":\"/db/chapter-27\"},{\"text\":\"第28章：TDengine IoT 数据库\",\"link\":\"/db/chapter-28\"},{\"text\":\"第29章：Milvus 向量数据库\",\"link\":\"/db/chapter-29\"},{\"text\":\"第30章：AI 应用数据库架构\",\"link\":\"/db/chapter-30\"}]},{\"text\":\"🔄 实战案例\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"数据库迁移与备份实战案例\",\"link\":\"/db/chapter-migration\"}]}]},\"socialLinks\":[],\"footer\":{\"message\":\"基于 MIT 许可发布\",\"copyright\":\"© Simon 小徐 2026 | 邮箱: esimonx@163.com\"},\"lastUpdated\":{\"text\":\"最后更新\",\"formatOptions\":{\"dateStyle\":\"short\",\"timeStyle\":\"short\"}},\"outline\":{\"level\":[2,3],\"label\":\"本页目录\"},\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"菜单\",\"docFooter\":{\"prev\":\"上一章\",\"next\":\"下一章\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>