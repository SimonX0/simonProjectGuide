import{_ as a,o as i,c as n,ag as l}from"./chunks/framework.C63nTIu3.js";const g=JSON.parse('{"title":"Javaé«˜çº§é¢è¯•é¢˜ - å¾®æœåŠ¡æ¶æ„","description":"","frontmatter":{"title":"Javaé«˜çº§é¢è¯•é¢˜ - å¾®æœåŠ¡æ¶æ„"},"headers":[],"relativePath":"interview/java/advanced/microservices.md","filePath":"interview/java/advanced/microservices.md","lastUpdated":1770654977000}'),e={name:"interview/java/advanced/microservices.md"};function p(t,s,h,r,k,E){return i(),n("div",null,[...s[0]||(s[0]=[l(`<h1 id="javaé«˜çº§é¢è¯•é¢˜-å¾®æœåŠ¡æ¶æ„" tabindex="-1">Javaé«˜çº§é¢è¯•é¢˜ - å¾®æœåŠ¡æ¶æ„ <a class="header-anchor" href="#javaé«˜çº§é¢è¯•é¢˜-å¾®æœåŠ¡æ¶æ„" aria-label="Permalink to &quot;Javaé«˜çº§é¢è¯•é¢˜ - å¾®æœåŠ¡æ¶æ„&quot;">â€‹</a></h1><blockquote><p><strong>éš¾åº¦ç­‰çº§</strong>ï¼šâ­â­â­â­ | <strong>å‡ºç°é¢‘ç‡</strong>ï¼š88% | <strong>å»ºè®®æŒæ¡æ—¶é—´</strong>ï¼š3å‘¨</p></blockquote><h2 id="ğŸ“š-æœ¬ç« ç›®å½•" tabindex="-1">ğŸ“š æœ¬ç« ç›®å½• <a class="header-anchor" href="#ğŸ“š-æœ¬ç« ç›®å½•" aria-label="Permalink to &quot;ğŸ“š æœ¬ç« ç›®å½•&quot;">â€‹</a></h2><ul><li><a href="#ä¸€nacosæ³¨å†Œä¸­å¿ƒ">ä¸€ã€Nacosæ³¨å†Œä¸­å¿ƒ</a></li><li><a href="##äºŒsentinelæµæ§">äºŒã€Sentinelæµæ§</a></li><li><a href="#ä¸‰seataåˆ†å¸ƒå¼äº‹åŠ¡">ä¸‰ã€Seataåˆ†å¸ƒå¼äº‹åŠ¡</a></li><li><a href="#å››gatewayç½‘å…³">å››ã€Gatewayç½‘å…³</a></li></ul><hr><h2 id="ä¸€ã€nacosæ³¨å†Œä¸­å¿ƒ" tabindex="-1">ä¸€ã€Nacosæ³¨å†Œä¸­å¿ƒ <a class="header-anchor" href="#ä¸€ã€nacosæ³¨å†Œä¸­å¿ƒ" aria-label="Permalink to &quot;ä¸€ã€Nacosæ³¨å†Œä¸­å¿ƒ&quot;">â€‹</a></h2><h3 id="q23-nacosçš„æœåŠ¡æ³¨å†Œä¸å‘ç°æµç¨‹" tabindex="-1">Q23: Nacosçš„æœåŠ¡æ³¨å†Œä¸å‘ç°æµç¨‹ï¼Ÿ <a class="header-anchor" href="#q23-nacosçš„æœåŠ¡æ³¨å†Œä¸å‘ç°æµç¨‹" aria-label="Permalink to &quot;Q23: Nacosçš„æœåŠ¡æ³¨å†Œä¸å‘ç°æµç¨‹ï¼Ÿ&quot;">â€‹</a></h3><p><strong>å‚è€ƒç­”æ¡ˆ</strong>ï¼š</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Provider</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Nacos</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Consumer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Provider-&gt;&gt;Nacos: 1. å‘èµ·æ³¨å†Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Nacos-&gt;&gt;Nacos: 2. å­˜å‚¨æœåŠ¡å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Provider-&gt;&gt;Nacos: 3. å®šæœŸå‘é€å¿ƒè·³</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Consumer-&gt;&gt;Nacos: 4. è®¢é˜…æœåŠ¡åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Nacos-&gt;&gt;Consumer: 5. è¿”å›æœåŠ¡å®ä¾‹åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Consumer-&gt;&gt;Nacos: 6. UDPæ¨é€å˜æ›´</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Consumer-&gt;&gt;Provider: 7. å‘èµ·è°ƒç”¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼š</p><ul><li><strong>APæ¨¡å¼</strong>ï¼šä¼˜å…ˆå¯ç”¨æ€§ï¼ˆé»˜è®¤ï¼‰</li><li><strong>CPæ¨¡å¼</strong>ï¼šä¼˜å…ˆä¸€è‡´æ€§ï¼ˆRaftåè®®ï¼‰</li><li><strong>å¿ƒè·³æ£€æµ‹</strong>ï¼š5ç§’å¿ƒè·³ï¼Œ15ç§’è¶…æ—¶å‰”é™¤</li><li><strong>å¥åº·æ£€æŸ¥</strong>ï¼šTCP/HTTP</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šæƒé‡ã€åŒé›†ç¾¤ä¼˜å…ˆ</li></ul><h3 id="q24-nacosé…ç½®ä¸­å¿ƒçš„å·¥ä½œåŸç†" tabindex="-1">Q24: Nacosé…ç½®ä¸­å¿ƒçš„å·¥ä½œåŸç†ï¼Ÿ <a class="header-anchor" href="#q24-nacosé…ç½®ä¸­å¿ƒçš„å·¥ä½œåŸç†" aria-label="Permalink to &quot;Q24: Nacosé…ç½®ä¸­å¿ƒçš„å·¥ä½œåŸç†ï¼Ÿ&quot;">â€‹</a></h3><p><strong>å‚è€ƒç­”æ¡ˆ</strong>ï¼š</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    A[å®¢æˆ·ç«¯] --&gt; B[é•¿è½®è¯¢]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    B --&gt; C[NacosæœåŠ¡ç«¯]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C --&gt; D[é…ç½®å­˜å‚¨]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D --&gt; E[MySQL/Derby]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C --&gt; F[é…ç½®å˜æ›´]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    F --&gt; G[æ¨é€å®¢æˆ·ç«¯]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>é…ç½®è¯»å–ä¼˜å…ˆçº§</strong>ï¼š</p><ol><li>JVMå¯åŠ¨å‚æ•°ï¼ˆ-Dï¼‰</li><li>Nacosé…ç½®ä¸­å¿ƒï¼ˆåŠ¨æ€ï¼‰</li><li>æœ¬åœ°é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</li></ol><hr><h2 id="äºŒã€sentinelæµæ§" tabindex="-1">äºŒã€Sentinelæµæ§ <a class="header-anchor" href="#äºŒã€sentinelæµæ§" aria-label="Permalink to &quot;äºŒã€Sentinelæµæ§&quot;">â€‹</a></h2><h3 id="q25-sentinelçš„æµæ§è§„åˆ™å’Œç†”æ–­é™çº§åŸç†" tabindex="-1">Q25: Sentinelçš„æµæ§è§„åˆ™å’Œç†”æ–­é™çº§åŸç†ï¼Ÿ <a class="header-anchor" href="#q25-sentinelçš„æµæ§è§„åˆ™å’Œç†”æ–­é™çº§åŸç†" aria-label="Permalink to &quot;Q25: Sentinelçš„æµæ§è§„åˆ™å’Œç†”æ–­é™çº§åŸç†ï¼Ÿ&quot;">â€‹</a></h3><p><strong>å‚è€ƒç­”æ¡ˆ</strong>ï¼š</p><p><strong>æµæ§è§„åˆ™</strong>ï¼š</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// QPSé™æµï¼šè¶…è¿‡100åˆ™ç›´æ¥æ‹’ç»</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FlowRule rule </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FlowRule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setResource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;orderService&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setGrade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RuleConstant.FLOW_GRADE_QPS)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setLimitApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>æµæ§ç­–ç•¥</strong>ï¼š</p><ul><li><strong>ç›´æ¥æ‹’ç»</strong>ï¼šæŠ›å‡ºFlowException</li><li><strong>Warm Up</strong>ï¼šé¢„çƒ­ï¼ˆé»˜è®¤å†·å¯åŠ¨å› å­3ï¼‰</li><li><strong>åŒ€é€Ÿæ’é˜Ÿ</strong>ï¼šæ¼æ¡¶ç®—æ³•</li></ul><p><strong>ç†”æ–­é™çº§</strong>ï¼š</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DegradeRule rule </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DegradeRule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setResource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;orderService&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setGrade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RuleConstant.DEGRADE_GRADE_RT)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¹³å‡å“åº”æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¶…è¿‡100ms</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeWindow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç†”æ–­10ç§’</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h2 id="ä¸‰ã€seataåˆ†å¸ƒå¼äº‹åŠ¡" tabindex="-1">ä¸‰ã€Seataåˆ†å¸ƒå¼äº‹åŠ¡ <a class="header-anchor" href="#ä¸‰ã€seataåˆ†å¸ƒå¼äº‹åŠ¡" aria-label="Permalink to &quot;ä¸‰ã€Seataåˆ†å¸ƒå¼äº‹åŠ¡&quot;">â€‹</a></h2><h3 id="q26-seataçš„atæ¨¡å¼åŸç†" tabindex="-1">Q26: Seataçš„ATæ¨¡å¼åŸç†ï¼Ÿ <a class="header-anchor" href="#q26-seataçš„atæ¨¡å¼åŸç†" aria-label="Permalink to &quot;Q26: Seataçš„ATæ¨¡å¼åŸç†ï¼Ÿ&quot;">â€‹</a></h3><p><strong>å‚è€ƒç­”æ¡ˆ</strong>ï¼š</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant TM as äº‹åŠ¡ç®¡ç†å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant RM1 as åº“å­˜æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant RM2 as è®¢å•æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant TC as äº‹åŠ¡åè°ƒå™¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TM-&gt;&gt;TC: 1. å¼€å§‹å…¨å±€äº‹åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TC-&gt;&gt;TM: 2. è¿”å›XID</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TM-&gt;&gt;RM1: 3. åˆ†æ”¯äº‹åŠ¡ï¼ˆATæ¨¡å¼ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RM1-&gt;&gt;RM1: 4-8. è§£æSQLã€å‰åé•œåƒã€undo log</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RM1-&gt;&gt;TC: 9. æ³¨å†Œåˆ†æ”¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RM1-&gt;&gt;TC: 10. æäº¤åˆ†æ”¯</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TM-&gt;&gt;RM2: 11. åˆ†æ”¯äº‹åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RM2-&gt;&gt;TC: 12. æ³¨å†Œåˆ†æ”¯</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TM-&gt;&gt;TC: 13. æäº¤/å›æ»šå…¨å±€äº‹åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TC-&gt;&gt;RM1: 14. é‡Šæ”¾é”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TC-&gt;&gt;RM2: 15. é‡Šæ”¾é”</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>ä¸¤é˜¶æ®µæäº¤</strong>ï¼š</p><ol><li><p><strong>ç¬¬ä¸€é˜¶æ®µ</strong>ï¼š</p><ul><li>è§£æSQLè¯­ä¹‰</li><li>æŸ¥è¯¢å‰é•œåƒï¼ˆbefore imageï¼‰</li><li>æ‰§è¡Œä¸šåŠ¡SQL</li><li>æŸ¥è¯¢åé•œåƒï¼ˆafter imageï¼‰</li><li>ç”Ÿæˆundo log</li><li>æäº¤æœ¬åœ°äº‹åŠ¡</li></ul></li><li><p><strong>ç¬¬äºŒé˜¶æ®µ</strong>ï¼š</p><ul><li><strong>æäº¤</strong>ï¼šå¼‚æ­¥åˆ é™¤undo log</li><li><strong>å›æ»š</strong>ï¼šæ ¹æ®undo logåå‘è¡¥å¿</li></ul></li></ol><h3 id="q27-seataçš„tccã€sagaæ¨¡å¼åŒºåˆ«" tabindex="-1">Q27: Seataçš„TCCã€SAGAæ¨¡å¼åŒºåˆ«ï¼Ÿ <a class="header-anchor" href="#q27-seataçš„tccã€sagaæ¨¡å¼åŒºåˆ«" aria-label="Permalink to &quot;Q27: Seataçš„TCCã€SAGAæ¨¡å¼åŒºåˆ«ï¼Ÿ&quot;">â€‹</a></h3><p><strong>å‚è€ƒç­”æ¡ˆ</strong>ï¼š</p><table tabindex="0"><thead><tr><th>æ¨¡å¼</th><th>ä¸€é˜¶æ®µ</th><th>äºŒé˜¶æ®µæäº¤</th><th>äºŒé˜¶æ®µå›æ»š</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>AT</strong></td><td>è‡ªåŠ¨</td><td>è‡ªåŠ¨åˆ é™¤undo log</td><td>è‡ªåŠ¨è¡¥å¿</td><td>ç®€å•CRUD</td></tr><tr><td><strong>TCC</strong></td><td>æ‰‹åŠ¨ï¼ˆTryï¼‰</td><td>æ‰‹åŠ¨ï¼ˆConfirmï¼‰</td><td>æ‰‹åŠ¨ï¼ˆCancelï¼‰</td><td>æ ¸å¿ƒä¸šåŠ¡ã€å¼ºä¸€è‡´</td></tr><tr><td><strong>SAGA</strong></td><td>æ‰‹åŠ¨</td><td>-</td><td>è‡ªåŠ¨è¡¥å¿</td><td>é•¿äº‹åŠ¡ã€å¤šæœåŠ¡</td></tr></tbody></table><hr><h2 id="å››ã€gatewayç½‘å…³" tabindex="-1">å››ã€Gatewayç½‘å…³ <a class="header-anchor" href="#å››ã€gatewayç½‘å…³" aria-label="Permalink to &quot;å››ã€Gatewayç½‘å…³&quot;">â€‹</a></h2><h3 id="q28-spring-cloud-gatewayçš„å·¥ä½œåŸç†" tabindex="-1">Q28: Spring Cloud Gatewayçš„å·¥ä½œåŸç†ï¼Ÿ <a class="header-anchor" href="#q28-spring-cloud-gatewayçš„å·¥ä½œåŸç†" aria-label="Permalink to &quot;Q28: Spring Cloud Gatewayçš„å·¥ä½œåŸç†ï¼Ÿ&quot;">â€‹</a></h3><p><strong>å‚è€ƒç­”æ¡ˆ</strong>ï¼š</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    A[å®¢æˆ·ç«¯è¯·æ±‚] --&gt; B[DispatcherHandler]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    B --&gt; C[RoutePredicateHandlerMapping]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C --&gt; D[åŒ¹é…è·¯ç”±]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D --&gt; E[WebHandler]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    E --&gt; F[FilteringWebHandler]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    F --&gt; G[æ‰§è¡Œè¿‡æ»¤å™¨é“¾]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    G --&gt; H[åç«¯æœåŠ¡]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>ä¸‰å¤§æ ¸å¿ƒ</strong>ï¼š</p><ol><li><strong>Routeï¼ˆè·¯ç”±ï¼‰</strong>ï¼šIDã€ç›®æ ‡URIã€æ–­è¨€ã€è¿‡æ»¤å™¨</li><li><strong>Predicateï¼ˆæ–­è¨€ï¼‰</strong>ï¼šåŒ¹é…è¯·æ±‚æ¡ä»¶</li><li><strong>Filterï¼ˆè¿‡æ»¤å™¨ï¼‰</strong>ï¼šå‰ç½®/åç½®å¤„ç†</li></ol><p><strong>å†…ç½®æ–­è¨€å·¥å‚</strong>ï¼š</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cloud</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    gateway</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      routes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">order-service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          uri</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lb://order-service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          predicates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Path=/api/orders/**</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Method=GET,POST</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="q29-gatewayå¦‚ä½•å®ç°å…¨å±€é‰´æƒ" tabindex="-1">Q29: Gatewayå¦‚ä½•å®ç°å…¨å±€é‰´æƒï¼Ÿ <a class="header-anchor" href="#q29-gatewayå¦‚ä½•å®ç°å…¨å±€é‰´æƒ" aria-label="Permalink to &quot;Q29: Gatewayå¦‚ä½•å®ç°å…¨å±€é‰´æƒï¼Ÿ&quot;">â€‹</a></h3><p><strong>å‚è€ƒç­”æ¡ˆ</strong>ï¼š</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthFilter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GlobalFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ordered</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Mono&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ServerWebExchange </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exchange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, GatewayFilterChain </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exchange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getFirst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StringUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            exchange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatusCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatus.UNAUTHORIZED);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exchange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setComplete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // éªŒè¯token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Claims claims </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JwtUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (claims </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            exchange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatusCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatus.UNAUTHORIZED);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exchange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setComplete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä¼ é€’ç”¨æˆ·ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ServerHttpRequest request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exchange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-User-Id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSubject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chain.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(exchange.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¼˜å…ˆçº§æœ€é«˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><hr><h2 id="ğŸ“š-å»¶ä¼¸é˜…è¯»" tabindex="-1">ğŸ“š å»¶ä¼¸é˜…è¯» <a class="header-anchor" href="#ğŸ“š-å»¶ä¼¸é˜…è¯»" aria-label="Permalink to &quot;ğŸ“š å»¶ä¼¸é˜…è¯»&quot;">â€‹</a></h2><ul><li><a href="./distributed-system.html">é«˜çº§é¢è¯•é¢˜ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿ â†’</a></li><li><a href="./project-interview.html">å®æˆ˜é¡¹ç›®é¢è¯•é¢˜ â†’</a></li></ul><hr><p><strong>æ›´æ–°æ—¶é—´</strong>ï¼š2026å¹´2æœˆ | <strong>ç‰ˆæœ¬</strong>ï¼šv2.0</p>`,53)])])}const c=a(e,[["render",p]]);export{g as __pageData,c as default};
