---
title: Javaé«˜çº§é¢è¯•é¢˜ - å®æˆ˜é¡¹ç›®é¢è¯•é¢˜
---

# Javaé«˜çº§é¢è¯•é¢˜ - å®æˆ˜é¡¹ç›®é¢è¯•é¢˜

> **éš¾åº¦ç­‰çº§**ï¼šâ­â­â­â­â­ | **å‡ºç°é¢‘ç‡**ï¼š80% | **å»ºè®®æŒæ¡æ—¶é—´**ï¼š4å‘¨

## ğŸ“š æœ¬ç« ç›®å½•

- [é¡¹ç›®ä¸€ï¼šç”µå•†å¹³å°å¾®æœåŠ¡ç‰ˆ](#é¡¹ç›®ä¸€ç”µå•†å¹³å°å¾®æœåŠ¡ç‰ˆ)
- [é¡¹ç›®äºŒï¼šç§’æ€ç³»ç»Ÿè®¾è®¡](#é¡¹ç›®äºŒç§’æ€ç³»ç»Ÿè®¾è®¡)
- [é¡¹ç›®ä¸‰ï¼šé«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡](#é¡¹ç›®ä¸‰é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡)
- [é¡¹ç›®å››ï¼šå¾®æœåŠ¡æ¶æ„å®Œæ•´ç³»ç»Ÿ](#é¡¹ç›®å››å¾®æœåŠ¡æ¶æ„å®Œæ•´ç³»ç»Ÿ)

---

## é¡¹ç›®ä¸€ï¼šç”µå•†å¹³å°å¾®æœåŠ¡ç‰ˆ

### æŠ€æœ¯æ ˆ

**åç«¯**ï¼šSpring Cloud Alibaba + Nacos + Gateway + Sentinel + Seata
**æ•°æ®åº“**ï¼šMySQL 8.0 + Redis 7.x + RabbitMQ
**éƒ¨ç½²**ï¼šDocker + Kubernetes

### æ ¸å¿ƒé—®é¢˜

#### Q30: å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿä½ çš„æ‹†åˆ†åŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”µå•†å¹³å°å¾®æœåŠ¡æ¶æ„             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æœåŠ¡ï¼ˆUser Serviceï¼‰             â”‚  ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯
â”‚  å•†å“æœåŠ¡ï¼ˆProduct Serviceï¼‰          â”‚  å•†å“ç®¡ç†ã€åº“å­˜ç®¡ç†
â”‚  è®¢å•æœåŠ¡ï¼ˆOrder Serviceï¼‰            â”‚  è®¢å•åˆ›å»ºã€è®¢å•æŸ¥è¯¢
â”‚  æ”¯ä»˜æœåŠ¡ï¼ˆPayment Serviceï¼‰          â”‚  æ”¯ä»˜å¯¹æ¥ã€æ”¯ä»˜å›è°ƒ
â”‚  è¥é”€æœåŠ¡ï¼ˆMarketing Serviceï¼‰        â”‚  ä¼˜æƒ åˆ¸ã€ç§’æ€æ´»åŠ¨
â”‚  æœç´¢æœåŠ¡ï¼ˆSearch Serviceï¼‰           â”‚  å•†å“æœç´¢ã€Elasticsearch
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‹†åˆ†åŸåˆ™**ï¼š
1. **ä¸šåŠ¡è¾¹ç•Œ**ï¼šæŒ‰ä¸šåŠ¡é¢†åŸŸï¼ˆDDDï¼‰åˆ’åˆ†
2. **æ•°æ®ç‹¬ç«‹**ï¼šæ¯ä¸ªæœåŠ¡ç‹¬å æ•°æ®åº“
3. **èŒè´£å•ä¸€**ï¼šä¸€ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹
4. **é€šä¿¡æ–¹å¼**ï¼šå†…éƒ¨åŒæ­¥ï¼ˆFeignï¼‰ï¼Œå¤–éƒ¨å¼‚æ­¥ï¼ˆMQï¼‰

#### Q31: å¦‚ä½•ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§ï¼ˆä¸‹å•+æ‰£åº“å­˜+æ‰£ä½™é¢ï¼‰ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

```mermaid
sequenceDiagram
    participant è®¢å•æœåŠ¡
    participant åº“å­˜æœåŠ¡
    participant ä½™é¢æœåŠ¡
    participant Seata TC

    è®¢å•æœåŠ¡->>Seata TC: 1. å¼€å¯å…¨å±€äº‹åŠ¡
    Seata TC->>è®¢å•æœåŠ¡: 2. è¿”å›XID

    è®¢å•æœåŠ¡->>è®¢å•æœåŠ¡: 3. åˆ›å»ºè®¢å•ï¼ˆå¾…æ”¯ä»˜ï¼‰
    è®¢å•æœåŠ¡->>åº“å­˜æœåŠ¡: 4. æ‰£å‡åº“å­˜ï¼ˆATæ¨¡å¼ï¼‰
    åº“å­˜æœåŠ¡->>Seata TC: 5. æ³¨å†Œåˆ†æ”¯
    è®¢å•æœåŠ¡->>ä½™é¢æœåŠ¡: 6. æ‰£å‡ä½™é¢ï¼ˆATæ¨¡å¼ï¼‰
    ä½™é¢æœåŠ¡->>Seata TC: 7. æ³¨å†Œåˆ†æ”¯

    è®¢å•æœåŠ¡->>Seata TC: 8. æäº¤å…¨å±€äº‹åŠ¡
    Seata TC->>åº“å­˜æœåŠ¡: 9. é‡Šæ”¾é”ã€åˆ é™¤undo log
    Seata TC->>ä½™é¢æœåŠ¡: 10. é‡Šæ”¾é”ã€åˆ é™¤undo log
```

**Seata ATæ¨¡å¼å®ç°**ï¼š
```java
@GlobalTransactional(name = "create-order")
public void createOrder(OrderDTO orderDTO) {
    // 1. åˆ›å»ºè®¢å•
    Order order = new Order();
    order.setUserId(orderDTO.getUserId());
    order.setProductId(orderDTO.getProductId());
    order.setCount(orderDTO.getCount());
    orderMapper.insert(order);

    // 2. æ‰£å‡åº“å­˜
    productClient.deductStock(orderDTO.getProductId(), orderDTO.getCount());

    // 3. æ‰£å‡ä½™é¢
    accountClient.deductBalance(orderDTO.getUserId(), orderDTO.getTotalAmount());
}
```

#### Q32: å¦‚ä½•é˜²æ­¢å•†å“è¶…å–ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**æ–¹æ¡ˆ1ï¼šRedis + Luaè„šæœ¬ï¼ˆæ¨èï¼‰**
```lua
-- seckill.lua
local stock = redis.call('get', KEYS[1])
if tonumber(stock) <= 0 then
    return 0  -- åº“å­˜ä¸è¶³
end

redis.call('decr', KEYS[1])
redis.call('sadd', KEYS[2], ARGV[1])  -- è®°å½•å·²æŠ¢è´­ç”¨æˆ·
return 1  -- æŠ¢è´­æˆåŠŸ
```

```java
public boolean seckill(Long userId, Long productId) {
    String lua = "seckill.lua";
    DefaultRedisScript<Long> script = new DefaultRedisScript<>(lua, Long.class);

    Long result = redisTemplate.execute(
        script,
        Arrays.asList("stock:" + productId, "user:" + productId + ":" + userId),
        String.valueOf(userId)
    );

    if (result == 1) {
        // å‘é€MQæ¶ˆæ¯ï¼Œå¼‚æ­¥åˆ›å»ºè®¢å•
        mqProducer.send(new SeckillMessage(userId, productId));
        return true;
    }
    return false;
}
```

**æ–¹æ¡ˆ2ï¼šæ•°æ®åº“ä¹è§‚é”**
```sql
-- åº“å­˜è¡¨å¢åŠ versionå­—æ®µ
UPDATE product
SET stock = stock - 1,
    version = version + 1
WHERE id = 123
  AND stock > 0
  AND version = 5;  -- å½“å‰ç‰ˆæœ¬
```

#### Q33: æœåŠ¡ç†”æ–­é™çº§å¦‚ä½•é…ç½®ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

```yaml
# Sentinelæµæ§è§„åˆ™
spring:
  cloud:
    sentinel:
      datasource:
        flow:
          nacos:
            server-addr: localhost:8848
            data-id: ${spring.application.name}-flow-rules
            group-id: SENTINEL_GROUP
            rule-type: flow

# æµæ§è§„åˆ™ç¤ºä¾‹
[
  {
    "resource": "orderService",
    "limitApp": "default",
    "grade": 1,
    "count": 100,
    "strategy": 0,
    "controlBehavior": 0,
    "clusterMode": false
  }
]
```

```java
// ä»£ç æ–¹å¼é…ç½®
@SentinelResource(
    value = "orderService",
    blockHandler = "handleBlock",
    fallback = "handleFallback"
)
public Order createOrder(Order order) {
    return orderService.save(order);
}

// é™æµå¤„ç†
public Order handleBlock(Order order, BlockException e) {
    log.warn("é™æµäº†ï¼š{}", e.getClass().getSimpleName());
    throw new BusinessException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
}

// é™çº§å¤„ç†
public Order handleFallback(Order order, Throwable e) {
    log.error("å¼‚å¸¸äº†ï¼š{}", e.getMessage());
    return Order.getDefault();  // è¿”å›é»˜è®¤å€¼
}
```

#### Q34: å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**Redisåˆ†å¸ƒå¼é”ï¼ˆRedissonï¼‰**ï¼š
```java
@Autowired
private RedissonClient redissonClient;

public void deductStock(Long productId) {
    RLock lock = redissonClient.getLock("lock:product:" + productId);
    try {
        // å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾…10ç§’ï¼Œé”30ç§’åè‡ªåŠ¨é‡Šæ”¾
        boolean locked = lock.tryLock(10, 30, TimeUnit.SECONDS);
        if (!locked) {
            throw new BusinessException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
        }

        // æ‰£å‡åº“å­˜
        int rows = productMapper.deductStock(productId, 1);
        if (rows == 0) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
    } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
        throw new BusinessException("ç³»ç»Ÿå¼‚å¸¸");
    } finally {
        lock.unlock();
    }
}
```

**Zookeeperåˆ†å¸ƒå¼é”**ï¼š
```java
@Autowired
private CuratorFramework curatorFramework;

public void deductStock(Long productId) {
    InterProcessMutex lock = new InterProcessMutex(
        curatorFramework,
        "/locks/product/" + productId
    );
    try {
        // è·å–é”
        lock.acquire(10, TimeUnit.SECONDS);

        // æ‰£å‡åº“å­˜
        int rows = productMapper.deductStock(productId, 1);
        if (rows == 0) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
    } finally {
        lock.release();
    }
}
```

---

## é¡¹ç›®äºŒï¼šç§’æ€ç³»ç»Ÿè®¾è®¡

### æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CDN                        â”‚  é™æ€èµ„æº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è´Ÿè½½å‡è¡¡ï¼ˆLVS/Nginxï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            APIç½‘å…³ï¼ˆé™æµã€ç†”æ–­ã€é‰´æƒï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç§’æ€æœåŠ¡ï¼ˆRedisåº“å­˜æ‰£å‡ï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQ/Kafkaï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è®¢å•æœåŠ¡ï¼ˆå¼‚æ­¥åˆ›å»ºè®¢å•ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒé—®é¢˜

#### Q35: å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç§’æ€ç³»ç»Ÿï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**1. é¡µé¢é™æ€åŒ–**
```html
<!-- ç§’æ€é¡µé¢æå‰ç”Ÿæˆï¼Œéƒ¨ç½²åˆ°CDN -->
<!DOCTYPE html>
<html>
<head>
    <title>ç§’æ€æ´»åŠ¨</title>
</head>
<body>
    <h1>iPhone 15 Pro ç§’æ€</h1>
    <p>ä»·æ ¼ï¼šÂ¥7999</p>
    <p>åº“å­˜ï¼š<span id="stock">1000</span></p>
    <button onclick="seckill()">ç«‹å³æŠ¢è´­</button>
</body>
</html>
```

**2. ç½‘å…³é™æµ**
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: seckill
          uri: lb://seckill-service
          predicates:
            - Path=/api/seckill/**
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 100  # æ¯ç§’è¡¥å……100ä¸ªä»¤ç‰Œ
                redis-rate-limiter.burstCapacity: 200  # æ¡¶å®¹é‡200
```

**3. Redisåº“å­˜æ‰£å‡ï¼ˆLuaä¿è¯åŸå­æ€§ï¼‰**
```lua
local stock = redis.call('get', KEYS[1])
if tonumber(stock) <= 0 then
    return 0
end
redis.call('decr', KEYS[1])
redis.call('sadd', KEYS[2], ARGV[1])
return 1
```

**4. MQå¼‚æ­¥ä¸‹å•**
```java
@RabbitListener(queues = "seckill_order_queue")
public void createOrder(SeckillMessage message) {
    // åˆ›å»ºè®¢å•
    Order order = new Order();
    order.setUserId(message.getUserId());
    order.setProductId(message.getProductId());
    orderMapper.insert(order);

    // æ‰£å‡DBåº“å­˜
    int rows = productMapper.deductStock(message.getProductId());
    if (rows == 0) {
        order.setStatus(OrderStatus.CANCELLED);
        orderMapper.updateById(order);
    }
}
```

**5. é˜²åˆ·ç­–ç•¥**
- éªŒè¯ç ï¼šé˜²æ­¢æœºå™¨åˆ·å•
- é™æµï¼šå•ç”¨æˆ·é™åˆ¶è¯·æ±‚é¢‘ç‡
- é»‘åå•ï¼šIPé™åˆ¶ã€è®¾å¤‡æŒ‡çº¹
- é¢„çƒ­ï¼šæå‰åŠ è½½åº“å­˜åˆ°Redis

---

## é¡¹ç›®ä¸‰ï¼šé«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡

### æ ¸å¿ƒé—®é¢˜

#### Q36: é«˜å¹¶å‘ç³»ç»Ÿå¦‚ä½•è®¾è®¡ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CDN                        â”‚  é™æ€èµ„æº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è´Ÿè½½å‡è¡¡ï¼ˆLVS/Nginxï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            APIç½‘å…³ï¼ˆé™æµã€ç†”æ–­ã€é‰´æƒï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœåŠ¡A       â”‚   æœåŠ¡B       â”‚   æœåŠ¡C       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Redisç¼“å­˜     â”‚ Redisç¼“å­˜     â”‚ Redisç¼“å­˜     â”‚
â”‚ æ¶ˆæ¯é˜Ÿåˆ—      â”‚ æ¶ˆæ¯é˜Ÿåˆ—      â”‚ æ¶ˆæ¯é˜Ÿåˆ—      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ•°æ®åº“ï¼ˆè¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŒ–ç­–ç•¥**ï¼š

**1. æ— çŠ¶æ€æœåŠ¡**
```java
// ç”¨æˆ·çŠ¶æ€å­˜Redisï¼Œä¸å­˜Session
@RestController
public class UserController {
    @GetMapping("/user/info")
    public User getUserInfo(@RequestHeader("Authorization") String token) {
        Long userId = JwtUtil.parseToken(token);
        return redisTemplate.opsForValue().get("user:" + userId);
    }
}
```

**2. å¼‚æ­¥å¤„ç†**
```java
// åŒæ­¥ï¼šä¸²è¡Œæ‰§è¡Œï¼Œè€—æ—¶é•¿
public void register(User user) {
    userService.save(user);          // 100ms
    emailService.send(user);         // 500ms
    smsService.send(user);           // 300ms
}
// æ€»è€—æ—¶ï¼š900ms

// å¼‚æ­¥ï¼šå¹¶è¡Œæ‰§è¡Œï¼Œè€—æ—¶çŸ­
@Async
public void register(User user) {
    userService.save(user);          // 100ms
    emailService.sendAsync(user);    // å¼‚æ­¥
    smsService.sendAsync(user);      // å¼‚æ­¥
}
// æ€»è€—æ—¶ï¼š100ms
```

**3. å¤šçº§ç¼“å­˜**
```java
@Cacheable(value = "user", key = "#id")
public User getUser(Long id) {
    // L1: æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰
    // L2: Redisç¼“å­˜
    // L3: æ•°æ®åº“
    return userMapper.selectById(id);
}
```

**4. æ•°æ®åº“è¯»å†™åˆ†ç¦»**
```java
@DS("master")  // ä¸»åº“
public void createOrder(Order order) {
    orderMapper.insert(order);
}

@DS("slave")   // ä»åº“
public Order getOrder(Long orderId) {
    return orderMapper.selectById(orderId);
}
```

**5. åˆ†åº“åˆ†è¡¨**
```yaml
# ShardingSphereé…ç½®
spring:
  shardingsphere:
    sharding:
      tables:
        t_order:
          actual-data-nodes: ds$->{0..1}.t_order_$->{0..1}
          database-strategy:
            inline:
              sharding-column: user_id
              algorithm-expression: ds$->{user_id % 2}
          table-strategy:
            inline:
              sharding-column: order_id
              algorithm-expression: t_order_$->{order_id % 2}
```

---

## é¡¹ç›®å››ï¼šå¾®æœåŠ¡æ¶æ„å®Œæ•´ç³»ç»Ÿ

### æŠ€æœ¯æ¶æ„

**åç«¯**ï¼šSpring Cloudå…¨å®¶æ¡¶ + Docker + Kubernetes + Skywalking
**ç›‘æ§**ï¼šPrometheus + Grafana + ELK
**éƒ¨ç½²**ï¼šArgoCD GitOps + è“ç»¿éƒ¨ç½² + é‡‘ä¸é›€å‘å¸ƒ

### æ ¸å¿ƒé—®é¢˜

#### Q37: å¾®æœåŠ¡æ¶æ„å¦‚ä½•è®¾è®¡ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            API Gatewayï¼ˆç½‘å…³å±‚ï¼‰              â”‚
â”‚         é‰´æƒã€é™æµã€ç†”æ–­ã€è·¯ç”±ã€æ—¥å¿—            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            æ ¸å¿ƒæœåŠ¡å±‚ï¼ˆCore Servicesï¼‰         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æœåŠ¡    â”‚  å•†å“æœåŠ¡    â”‚   è®¢å•æœåŠ¡       â”‚
â”‚  è®¤è¯æœåŠ¡    â”‚  åº“å­˜æœåŠ¡    â”‚   æ”¯ä»˜æœåŠ¡       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¥é”€æœåŠ¡    â”‚  æœç´¢æœåŠ¡    â”‚   æ¶ˆæ¯æœåŠ¡       â”‚
â”‚  é€šçŸ¥æœåŠ¡    â”‚  æ–‡ä»¶æœåŠ¡    â”‚   å·¥ä½œæµæœåŠ¡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åŸºç¡€æœåŠ¡å±‚ï¼ˆInfrastructureï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nacosï¼ˆæ³¨å†Œ+é…ç½®ï¼‰                          â”‚
â”‚ Sentinelï¼ˆæµæ§ç†”æ–­ï¼‰                         â”‚
â”‚ Seataï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰                          â”‚
â”‚ Skywalkingï¼ˆé“¾è·¯è¿½è¸ªï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ•°æ®å±‚ï¼ˆData Layerï¼‰                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MySQLé›†ç¾¤    â”‚ Redisé›†ç¾¤    â”‚  RabbitMQé›†ç¾¤   â”‚
â”‚ Elasticsearchâ”‚ MinIOå¯¹è±¡    â”‚  MongoDB       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Q38: å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼ˆå¤šçº§å®¹ç¾ï¼‰ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**1. æœåŠ¡é«˜å¯ç”¨**
```yaml
# Deploymentå¤šå‰¯æœ¬
apiVersion: apps/v1
kind: Deployment
metadata:
  name: order-service
spec:
  replicas: 3  # 3ä¸ªå‰¯æœ¬
  selector:
    matchLabels:
      app: order-service
  template:
    metadata:
      labels:
        app: order-service
    spec:
      containers:
      - name: order-service
        image: order-service:1.0.0
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
```

**2. æ•°æ®åº“é«˜å¯ç”¨**
```bash
# MySQLä¸»ä»å¤åˆ¶ + MHAè‡ªåŠ¨æ•…éšœè½¬ç§»
Masterï¼ˆå†™ï¼‰
  â†“
Slave1ï¼ˆè¯»ï¼‰ â† Slave2ï¼ˆè¯»ï¼‰ â† Slave3ï¼ˆè¯»ï¼‰
  â†“
MHA Managerï¼ˆç›‘æ§+è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼‰
```

**3. Redisé«˜å¯ç”¨**
```bash
# Redis Sentinelå“¨å…µæ¨¡å¼
Master
  â†“
Slave1 â† Slave2
  â†“
Sentinel1 â† Sentinel2 â† Sentinel3ï¼ˆç›‘æ§+è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼‰
```

**4. å¤šæœºæˆ¿å®¹ç¾**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœºæˆ¿A    â”‚    â”‚ æœºæˆ¿B    â”‚    â”‚ æœºæˆ¿C    â”‚
â”‚ (ä¸»æœºæˆ¿)  â”‚    â”‚ (å¤‡æœºæˆ¿)  â”‚    â”‚ (ç¾å¤‡)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“              â†“              â†“
  åŒæ­¥å¤åˆ¶        å¼‚æ­¥å¤åˆ¶        å¼‚æ­¥å¤åˆ¶
```

#### Q39: å¦‚ä½•è¿›è¡Œé“¾è·¯è¿½è¸ªä¸é—®é¢˜æ’æŸ¥ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**Skywalkingé›†æˆ**ï¼š
```yaml
# JVMå‚æ•°
-javaagent:/path/to/skywalking-agent.jar=
  agent.service_name=order-service
  agent.collector.backend_service=127.0.0.1:11800
  agent.logging.level=INFO
```

**é“¾è·¯è¿½è¸ªåˆ†æ**ï¼š
1. **è¯·æ±‚é“¾è·¯å›¾**ï¼šå¯è§†åŒ–å±•ç¤ºè¯·æ±‚ç»è¿‡çš„æ‰€æœ‰æœåŠ¡
2. **æ€§èƒ½åˆ†æ**ï¼šæ¯ä¸ªæœåŠ¡çš„å“åº”æ—¶é—´
3. **å¼‚å¸¸å®šä½**ï¼šå¿«é€Ÿå®šä½é”™è¯¯å‘ç”Ÿçš„é“¾è·¯
4. **ä¾èµ–åˆ†æ**ï¼šæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»

#### Q40: å¦‚ä½•è®¾è®¡ç°åº¦å‘å¸ƒï¼ˆé‡‘ä¸é›€å‘å¸ƒï¼‰ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**Gatewayç°åº¦è·¯ç”±**ï¼š
```java
@Component
public class GrayRouteFilter implements GlobalFilter {
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String userId = exchange.getRequest().getHeaders().getFirst("X-User-Id");

        // ç°åº¦ç”¨æˆ·åˆ—è¡¨ï¼ˆä»Redisè·å–ï¼‰
        Set<String> grayUsers = redisTemplate.opsForSet().members("gray:users");

        if (grayUsers != null && grayUsers.contains(userId)) {
            // ç°åº¦ç”¨æˆ·è·¯ç”±åˆ°æ–°ç‰ˆæœ¬
            ServerHttpRequest request = exchange.getRequest().mutate()
                .header("X-Version", "v2")
                .build();
            return chain.filter(exchange.mutate().request(request).build());
        }

        // æ™®é€šç”¨æˆ·è·¯ç”±åˆ°æ—§ç‰ˆæœ¬
        return chain.filter(exchange);
    }
}
```

**Kubernetesé‡‘ä¸é›€å‘å¸ƒ**ï¼š
```yaml
# 10%æµé‡åˆ°æ–°ç‰ˆæœ¬
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: order-service
spec:
  http:
  - match:
    - headers:
        x-user-id:
          regex: "1|2|3|4|5"  # å‰5ä¸ªç”¨æˆ·ï¼ˆç°åº¦ï¼‰
    route:
    - destination:
        host: order-service
        subset: v2  # æ–°ç‰ˆæœ¬
      weight: 100
  - route:
    - destination:
        host: order-service
        subset: v1  # æ—§ç‰ˆæœ¬
      weight: 90
    - destination:
        host: order-service
        subset: v2  # æ–°ç‰ˆæœ¬
      weight: 10
```

---

## ğŸ“š æ¨èå­¦ä¹ èµ„æº

### å¼€æºé¡¹ç›®
- [mall-swarmï¼šå¾®æœåŠ¡ç”µå•†ç³»ç»Ÿ](https://github.com/macrozheng/mall-swarm)
- [mall4cloudï¼šB2B2Cå•†åŸç³»ç»Ÿ](https://github.com/gz-yami/mall4cloud)

### é¢è¯•é¢˜èµ„æº
- [2025å¹´å¤§å‚å®æˆ˜åœºæ™¯é¢è¯•é¢˜ç²¾æ](https://blog.csdn.net/x1ao_fe1/article/details/148543649)
- [Javaåç«¯é¢è¯•å¿…è€ƒåœºæ™¯é¢˜å¤§å…¨](https://blog.csdn.net/2501_91139003/article/details/148095690)

---

**æ›´æ–°æ—¶é—´**ï¼š2026å¹´2æœˆ | **ç‰ˆæœ¬**ï¼šv2.0

**ç¥ä½ é¢è¯•æˆåŠŸï¼** ğŸ‰
