---
title: Javaä¸­çº§é¢è¯•é¢˜ - æ•°æ®åº“ä¸Redis
---

# Javaä¸­çº§é¢è¯•é¢˜ - æ•°æ®åº“ä¸Redis

> **éš¾åº¦ç­‰çº§**ï¼šâ­â­â­ | **å‡ºç°é¢‘ç‡**ï¼š90% | **å»ºè®®æŒæ¡æ—¶é—´**ï¼š2å‘¨

## ğŸ“š æœ¬ç« ç›®å½•

- [ä¸€ã€MySQLç´¢å¼•ä¼˜åŒ–](#ä¸€mysqlç´¢å¼•ä¼˜åŒ–)
- [äºŒã€MySQLäº‹åŠ¡ä¸é”](##äºŒmysqläº‹åŠ¡ä¸é”)
- [ä¸‰ã€Redisæ•°æ®ç±»å‹](#ä¸‰redisæ•°æ®ç±»å‹)
- [å››ã€Redisç¼“å­˜é—®é¢˜](#å››redisç¼“å­˜é—®é¢˜)

---

## ä¸€ã€MySQLç´¢å¼•ä¼˜åŒ–

### Q16: MySQLç´¢å¼•çš„æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©B+æ ‘ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**B+æ ‘ç‰¹ç‚¹**ï¼š
1. **éå¶å­èŠ‚ç‚¹åªå­˜é”®**ï¼šèƒ½å­˜æ›´å¤šç´¢å¼•é¡¹ï¼Œæ ‘æ›´çŸ®èƒ–
2. **å¶å­èŠ‚ç‚¹å­˜æ•°æ®**ï¼šèŒƒå›´æŸ¥è¯¢æ•ˆç‡é«˜
3. **å¶å­èŠ‚ç‚¹é“¾è¡¨**ï¼šæ”¯æŒé¡ºåºæ‰«æ

**B+æ ‘ vs Bæ ‘ vs Hash**ï¼š

| ç‰¹æ€§ | B+æ ‘ | Bæ ‘ | Hash |
|-----|------|-----|------|
| **èŒƒå›´æŸ¥è¯¢** | âœ… å¥½ | âš ï¸ ä¸€èˆ¬ | âŒ ä¸æ”¯æŒ |
| **ç‚¹æŸ¥è¯¢** | âœ… å¥½ | âœ… å¥½ | âœ… æœ€å¥½ |
| **IOæ¬¡æ•°** | å°‘ | è¾ƒå¤š | - |
| **å­˜å‚¨å¼•æ“** | InnoDB | MyISAM | Memory |

### Q17: ä»€ä¹ˆæƒ…å†µä¸‹ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

```sql
-- 1. ä½¿ç”¨å‡½æ•°ï¼Œç´¢å¼•å¤±æ•ˆ
SELECT * FROM user WHERE YEAR(create_time) = 2024;

-- 2. éšå¼ç±»å‹è½¬æ¢ï¼Œç´¢å¼•å¤±æ•ˆ
SELECT * FROM user WHERE phone = 13800138000;  -- phoneæ˜¯VARCHAR

-- 3. LIKEä»¥%å¼€å¤´ï¼Œç´¢å¼•å¤±æ•ˆ
SELECT * FROM user WHERE name LIKE '%å¼ %';

-- 4. ORè¿æ¥æœªç´¢å¼•å­—æ®µ
SELECT * FROM user WHERE age = 20 OR name = 'å¼ ä¸‰';

-- 5. ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™
-- ç´¢å¼•ï¼š(name, age, phone)
SELECT * FROM user WHERE age = 20;  -- ç´¢å¼•å¤±æ•ˆ
```

**æœ€å·¦å‰ç¼€åŸåˆ™**ï¼š
```sql
-- è”åˆç´¢å¼• (name, age, phone)
-- âœ… ä½¿ç”¨ç´¢å¼•
SELECT * FROM user WHERE name = 'å¼ ä¸‰';
SELECT * FROM user WHERE name = 'å¼ ä¸‰' AND age = 20;

-- âŒ ä¸ä½¿ç”¨ç´¢å¼•
SELECT * FROM user WHERE age = 20;
SELECT * FROM user WHERE phone = '13800138000';
```

---

## äºŒã€MySQLäº‹åŠ¡ä¸é”

### Q18: MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«åŠå¯¹åº”çš„é—®é¢˜ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| éš”ç¦»çº§åˆ« | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»è¯» | é”ç±»å‹ |
|---------|------|-----------|------|-------|
| **è¯»æœªæäº¤** | âœ… å¯èƒ½ | âœ… å¯èƒ½ | âœ… å¯èƒ½ | æ— é” |
| **è¯»å·²æäº¤** | âŒ ä¸å¯èƒ½ | âœ… å¯èƒ½ | âœ… å¯èƒ½ | MVCC |
| **å¯é‡å¤è¯»** | âŒ ä¸å¯èƒ½ | âŒ ä¸å¯èƒ½ | âœ… å¯èƒ½ | MVCC + Next-Key Lock |
| **ä¸²è¡ŒåŒ–** | âŒ ä¸å¯èƒ½ | âŒ ä¸å¯èƒ½ | âŒ ä¸å¯èƒ½ | è¡¨é” |

**MySQLé»˜è®¤**ï¼šREPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰

### Q19: MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰åŸç†ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

```mermaid
graph TD
    A[MVCC] --> B[Undo Log]
    A --> C[Read View]
    A --> D[éšè—å­—æ®µ]

    D --> D1[DB_TRX_ID: äº‹åŠ¡ID]
    D --> D2[DB_ROLL_PTR: å›æ»šæŒ‡é’ˆ]
    D --> D3[DB_ROW_ID: éšè—ä¸»é”®]

    C --> C1[m_ids: æ´»è·ƒäº‹åŠ¡åˆ—è¡¨]
    C --> C2[min_trx_id: æœ€å°äº‹åŠ¡ID]
    C --> C3[max_trx_id: æœ€å¤§äº‹åŠ¡ID]
```

**ç‰ˆæœ¬é“¾**ï¼š
```
è®°å½•1ï¼ˆäº‹åŠ¡100ï¼‰ â†’ undo log â†’ è®°å½•2ï¼ˆäº‹åŠ¡90ï¼‰ â†’ undo log â†’ è®°å½•3ï¼ˆäº‹åŠ¡80ï¼‰
```

---

## ä¸‰ã€Redisæ•°æ®ç±»å‹

### Q20: Redisçš„5ç§åŸºæœ¬æ•°æ®ç±»å‹åŠåº”ç”¨åœºæ™¯ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| ç±»å‹ | åº•å±‚å®ç° | åº”ç”¨åœºæ™¯ |
|-----|---------|---------|
| **String** | SDS | ç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é” |
| **Hash** | å“ˆå¸Œè¡¨ + å‹ç¼©åˆ—è¡¨ | å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰ |
| **List** | åŒå‘é“¾è¡¨ + å‹ç¼©åˆ—è¡¨ | æ¶ˆæ¯é˜Ÿåˆ—ã€å…³æ³¨åˆ—è¡¨ |
| **Set** | å“ˆå¸Œè¡¨ + æ•´æ•°é›†åˆ | æ ‡ç­¾ã€å…±åŒå…³æ³¨ |
| **ZSet** | è·³è¡¨ + å“ˆå¸Œè¡¨ | æ’è¡Œæ¦œã€å»¶è¿Ÿé˜Ÿåˆ— |

**ç¤ºä¾‹**ï¼š
```java
// String: è®¡æ•°å™¨
redisTemplate.opsForValue().increment("view_count:article:123");

// Hash: ç”¨æˆ·ä¿¡æ¯
redisTemplate.opsForHash().put("user:123", "name", "å¼ ä¸‰");

// List: æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆLPUSH + BRPOPï¼‰
redisTemplate.opsForList().leftPush("mq:order", orderJson);

// Set: å…±åŒå…³æ³¨
redisTemplate.opsForSet().intersect("user:123:follower", "user:456:follower");

// ZSet: æ’è¡Œæ¦œ
redisTemplate.opsForZSet().add("rank:score", "user:123", 99.5);
```

---

## å››ã€Redisç¼“å­˜é—®é¢˜

### Q21: ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©çš„è§£å†³æ–¹æ¡ˆï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**1. ç¼“å­˜ç©¿é€ï¼ˆæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼‰**

```java
// æ–¹æ¡ˆ1ï¼šå¸ƒéš†è¿‡æ»¤å™¨
BloomFilter<String> filter = BloomFilter.create(
    Funnels.stringFunnel(Charset.defaultCharset()),
    1000000,
    0.01
);
// åˆå§‹åŒ–æ—¶å°†æ‰€æœ‰keyæ”¾å…¥è¿‡æ»¤å™¨

// æ–¹æ¡ˆ2ï¼šç¼“å­˜ç©ºå¯¹è±¡
if (user == null) {
    redisTemplate.opsForValue().set("user:" + id, "", 5, TimeUnit.MINUTES);
}
```

**2. ç¼“å­˜å‡»ç©¿ï¼ˆçƒ­ç‚¹keyè¿‡æœŸï¼‰**

```java
// æ–¹æ¡ˆ1ï¼šäº’æ–¥é”ï¼ˆRedis SET NXï¼‰
Boolean locked = redisTemplate.opsForValue()
    .setIfAbsent(lockKey, "1", 10, TimeUnit.SECONDS);

// æ–¹æ¡ˆ2ï¼šé€»è¾‘è¿‡æœŸï¼ˆä¸è®¾ç½®TTLï¼Œå­—æ®µä¸­å­˜è¿‡æœŸæ—¶é—´ï¼‰
```

**3. ç¼“å­˜é›ªå´©ï¼ˆå¤§é‡keyåŒæ—¶è¿‡æœŸï¼‰**

```java
// æ–¹æ¡ˆ1ï¼šéšæœºè¿‡æœŸæ—¶é—´
int expireTime = 30 + new Random().nextInt(10);  // 30-40åˆ†é’Ÿ

// æ–¹æ¡ˆ2ï¼šç¼“å­˜é¢„çƒ­ï¼ˆç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½çƒ­ç‚¹æ•°æ®ï¼‰
@PostConstruct
public void init() {
    List<User> hotUsers = userMapper.selectHotUsers();
    hotUsers.forEach(user -> {
        redisTemplate.opsForValue().set("user:" + user.getId(), user, 1, TimeUnit.HOURS);
    });
}
```

### Q22: RDBå’ŒAOFçš„åŒºåˆ«ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| ç‰¹æ€§ | RDB | AOF |
|-----|-----|-----|
| **æŒä¹…åŒ–æ–¹å¼** | å®šæ—¶å¿«ç…§ | è®°å½•å†™å‘½ä»¤ |
| **æ–‡ä»¶å¤§å°** | å°ï¼ˆå‹ç¼©ï¼‰ | å¤§ï¼ˆè¿½åŠ ï¼‰ |
| **æ¢å¤é€Ÿåº¦** | å¿« | æ…¢ |
| **æ•°æ®å®Œæ•´æ€§** | å¯èƒ½ä¸¢å¤±æ•°æ® | å®Œæ•´ï¼ˆæ ¹æ®åˆ·ç›˜ç­–ç•¥ï¼‰ |

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [ä¸­çº§é¢è¯•é¢˜ï¼šæ¶ˆæ¯é˜Ÿåˆ— â†’](./message-queue)
- [é«˜çº§é¢è¯•é¢˜ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿ â†’](../advanced/distributed-system)
- [å®æˆ˜é¡¹ç›®é¢è¯•é¢˜ â†’](../advanced/project-interview)

---

**æ›´æ–°æ—¶é—´**ï¼š2026å¹´2æœˆ | **ç‰ˆæœ¬**ï¼šv2.0
