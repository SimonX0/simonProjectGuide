---
title: ç¬¬25ç« ï¼šåˆ†åº“åˆ†è¡¨æ¶æ„è®¾è®¡
---

# ï¼šåˆ†åº“åˆ†è¡¨æ¶æ„è®¾è®¡

> **éš¾åº¦ç­‰çº§**ï¼šâ­â­â­â­ é«˜çº§ | **å­¦ä¹ æ—¶é•¿**ï¼š15å°æ—¶ | **å®æˆ˜é¡¹ç›®**ï¼šäº¿çº§ç”¨æˆ·ç³»ç»Ÿ

## ğŸ“š æœ¬ç« ç›®å½•

- [23.1 åˆ†åº“åˆ†è¡¨ç­–ç•¥](#231-åˆ†åº“åˆ†è¡¨ç­–ç•¥)
- [23.2 ShardingSphere å®è·µ](#232-shardingsphere-å®è·µ)
- [23.3 æ•°æ®è¿ç§»](#233-æ•°æ®è¿ç§»)
- [23.4 è·¯ç”±ç­–ç•¥](#234-è·¯ç”±ç­–ç•¥)
- [23.5 æ‰©ç¼©å®¹æ–¹æ¡ˆ](#235-æ‰©ç¼©å®¹æ–¹æ¡ˆ)

---

## åˆ†åº“åˆ†è¡¨ç­–ç•¥

### ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨

**æ€§èƒ½ç“¶é¢ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               å•æœºæ•°æ®åº“ç“¶é¢ˆ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  æ•°æ®é‡å¢é•¿ â†’ 1000ä¸‡+ è®°å½• â†’ æŸ¥è¯¢å˜æ…¢                â”‚
â”‚  å¹¶å‘å¢åŠ  â†’ 10000+ QPS â†’ æ•°æ®åº“å‹åŠ›è¿‡å¤§              â”‚
â”‚  ç£ç›˜ç©ºé—´ â†’ å•ç›˜æœ‰é™ â†’ æ— æ³•æ— é™æ‰©å±•                  â”‚
â”‚  ç½‘ç»œå¸¦å®½ â†’ å•æœºç“¶é¢ˆ â†’ æˆä¸ºæ€§èƒ½ç“¶é¢ˆ                  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â†“ åˆ†åº“åˆ†è¡¨è§£å†³

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                åˆ†åº“åˆ†è¡¨æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  æ•°æ®æ°´å¹³åˆ†æ•£ â†’ å‡å°‘å•è¡¨æ•°æ®é‡ â†’ æå‡æŸ¥è¯¢é€Ÿåº¦        â”‚
â”‚  è¯·æ±‚åˆ†æ•£ â†’ é™ä½å•åº“å‹åŠ› â†’ æå‡å¹¶å‘èƒ½åŠ›              â”‚
â”‚  å¤šæœºå­˜å‚¨ â†’ æ¨ªå‘æ‰©å±• â†’ æ— é™å®¹é‡                      â”‚
â”‚  è´Ÿè½½å‡è¡¡ â†’ ä¼˜åŒ–èµ„æºåˆ©ç”¨ â†’ æå‡æ•´ä½“æ€§èƒ½              â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½•æ—¶éœ€è¦åˆ†åº“åˆ†è¡¨**ï¼š

| æŒ‡æ ‡ | é˜ˆå€¼ | è¯´æ˜ |
|-----|------|-----|
| **æ•°æ®é‡** | å•è¡¨ > 1000ä¸‡ | B+æ ‘æ·±åº¦å¢åŠ ï¼ŒæŸ¥è¯¢å˜æ…¢ |
| **å¹¶å‘é‡** | å•åº“ QPS > 5000 | CPUã€ç£ç›˜IOæˆä¸ºç“¶é¢ˆ |
| **ç£ç›˜ç©ºé—´** | å•åº“ > 500GB | å¤‡ä»½ã€æ¢å¤å›°éš¾ |
| **ç½‘ç»œå¸¦å®½** | å¸¦å®½ä½¿ç”¨ç‡ > 70% | ç½‘ç»œæˆä¸ºç“¶é¢ˆ |

### åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ

**1. å‚ç›´åˆ†åº“ï¼ˆæŒ‰ä¸šåŠ¡æ‹†åˆ†ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å•ä½“æ•°æ®åº“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ç”¨æˆ·è¡¨ â”‚ â”‚ è®¢å•è¡¨ â”‚ â”‚ å•†å“è¡¨ â”‚ â”‚ æ—¥å¿—è¡¨ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‚ç›´åˆ†åº“                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ç”¨æˆ·æ•°æ®åº“ â”‚  â”‚ è®¢å•æ•°æ®åº“ â”‚  â”‚ å•†å“æ•°æ®åº“ â”‚    â”‚
â”‚  â”‚ user_db    â”‚  â”‚ order_db   â”‚  â”‚ product_db â”‚    â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚    â”‚
â”‚  â”‚ - users    â”‚  â”‚ - orders   â”‚  â”‚ - products â”‚    â”‚
â”‚  â”‚ - profiles â”‚  â”‚ - payments â”‚  â”‚ - categoriesâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚ æ—¥å¿—æ•°æ®åº“ â”‚  (ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸å½±å“æ ¸å¿ƒä¸šåŠ¡)          â”‚
â”‚  â”‚ log_db     â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼š
âœ… ä¸šåŠ¡è§£è€¦ï¼Œä¾¿äºç»´æŠ¤
âœ… é™ä½å•åº“è¿æ¥æ•°
âœ… ä¾¿äºç‹¬ç«‹ä¼˜åŒ–å’Œæ‰©å±•
âœ… æ•…éšœéš”ç¦»

ç¼ºç‚¹ï¼š
âŒ è·¨åº“äº‹åŠ¡é—®é¢˜
âŒ è·¨åº“ JOIN å›°éš¾
âŒ åº”ç”¨å±‚å¤æ‚åº¦å¢åŠ 
```

**2. æ°´å¹³åˆ†è¡¨ï¼ˆå•åº“åˆ†è¡¨ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ°´å¹³åˆ†è¡¨                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  orders è¡¨ï¼ˆæ•°æ®é‡ 5000ä¸‡ï¼‰                           â”‚
â”‚          â†“                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚orders_0 â”‚orders_1 â”‚orders_2 â”‚orders_3 â”‚          â”‚
â”‚  â”‚1250ä¸‡   â”‚1250ä¸‡   â”‚1250ä¸‡   â”‚1250ä¸‡   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                      â”‚
â”‚  åˆ†è¡¨è§„åˆ™ï¼šuser_id % 4                               â”‚
â”‚  - orders_0: user_id % 4 = 0                         â”‚
â”‚  - orders_1: user_id % 4 = 1                         â”‚
â”‚  - orders_2: user_id % 4 = 2                         â”‚
â”‚  - orders_3: user_id % 4 = 3                         â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼š
âœ… å‡å°‘å•è¡¨æ•°æ®é‡
âœ… æå‡æŸ¥è¯¢æ€§èƒ½
âœ… ä¸è·¨åº“ï¼Œäº‹åŠ¡ç›¸å¯¹ç®€å•

ç¼ºç‚¹ï¼š
âŒ è·¨è¡¨ JOIN å›°éš¾
âŒ æ•°æ®æ‰©å®¹éœ€è¦è¿ç§»
âŒ åº”ç”¨å±‚è·¯ç”±å¤æ‚
```

**3. æ°´å¹³åˆ†åº“ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ°´å¹³åˆ†åº“åˆ†è¡¨                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚          DB0ï¼ˆ192.168.1.10ï¼‰              â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚       â”‚
â”‚  â”‚  â”‚orders_0â”‚ â”‚orders_1â”‚ â”‚users_0 â”‚        â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚          DB1ï¼ˆ192.168.1.11ï¼‰              â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚       â”‚
â”‚  â”‚  â”‚orders_2â”‚ â”‚orders_3â”‚ â”‚users_1 â”‚        â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                      â”‚
â”‚  åˆ†åº“è§„åˆ™ï¼šuser_id % 2                               â”‚
â”‚  åˆ†è¡¨è§„åˆ™ï¼šuser_id % 2                               â”‚
â”‚                                                      â”‚
â”‚  user_id=1 â†’ DB0.users_0                            â”‚
â”‚  user_id=2 â†’ DB1.users_1                            â”‚
â”‚  user_id=3 â†’ DB0.users_0                            â”‚
â”‚  user_id=4 â†’ DB1.users_1                            â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼š
âœ… æ€§èƒ½çº¿æ€§æ‰©å±•
âœ… é™ä½å•åº“å‹åŠ›
âœ… æå‡ç³»ç»Ÿå®¹é‡

ç¼ºç‚¹ï¼š
âŒ æ¶æ„å¤æ‚
âŒ è·¨åº“äº‹åŠ¡å›°éš¾
âŒ è¿ç»´æˆæœ¬é«˜
âŒ æ•°æ®è¿ç§»å›°éš¾
```

### åˆ†ç‰‡ç­–ç•¥é€‰æ‹©

**1. Hash åˆ†ç‰‡**

```sql
-- ä¼˜ç‚¹ï¼šæ•°æ®å‡åŒ€åˆ†å¸ƒ
-- ç¼ºç‚¹ï¼šæ‰©å®¹éœ€è¦æ•°æ®è¿ç§»

-- åˆ†ç‰‡å‡½æ•°
shard_index = hash(user_id) % shard_count

-- ç¤ºä¾‹
user_id = 12345
shard_count = 4
shard_index = hash(12345) % 4 = 1  â†’ orders_1
```

**2. Range åˆ†ç‰‡**

```sql
-- ä¼˜ç‚¹ï¼šèŒƒå›´æŸ¥è¯¢å¿«
-- ç¼ºç‚¹ï¼šå¯èƒ½æ•°æ®åˆ†å¸ƒä¸å‡

-- æŒ‰ç”¨æˆ·IDèŒƒå›´
DB0: 0 - 1000000
DB1: 1000001 - 2000000
DB2: 2000001 - 3000000
DB3: 3000001 - 4000000

-- æŒ‰æ—¶é—´èŒƒå›´
DB0: 2024å¹´æ•°æ®
DB1: 2023å¹´æ•°æ®
DB2: 2022å¹´æ•°æ®
```

**3. ä¸€è‡´æ€§Hash**

```
                    Hash ç¯
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚
      DB3 â”€                      â”€ DB1
          â”‚\                    /â”‚
          â”‚ \                  / â”‚
          â”‚  \                /  â”‚
          â”‚   \              /   â”‚
          â”‚    \            /    â”‚
          â”‚     \          /     â”‚
          â”‚      \        /      â”‚
          â”‚       \      /       â”‚
          â”‚        \    /        â”‚
          â”‚         \  /         â”‚
          â”‚          \/          â”‚
          â”‚          /\          â”‚
          â”‚         /  \         â”‚
        DB0 â”€â”€â”€â”€â”€â”€/    \â”€â”€â”€â”€â”€â”€â”€â”€ DB2
                  /      \
                 /        \


ä¼˜ç‚¹ï¼š
âœ… æœ€å°åŒ–æ•°æ®è¿ç§»
âœ… èŠ‚ç‚¹å¢åˆ å½±å“æœ€å°

ç¼ºç‚¹ï¼š
âŒ å®ç°å¤æ‚
âŒ å¯èƒ½åˆ†å¸ƒä¸å‡ï¼ˆéœ€è¦è™šæ‹ŸèŠ‚ç‚¹ï¼‰
```

---

## ShardingSphere å®è·µ

### ShardingSphere æ¶æ„

```mermaid
graph TB
    A[åº”ç”¨] --> B[ShardingSphere]
    B --> C[SQL è§£æ]
    C --> D[è·¯ç”±]
    D --> E[æ”¹å†™]
    E --> F[æ‰§è¡Œ]
    F --> G[å½’å¹¶]
    G --> A

    F --> H[DB0]
    F --> I[DB1]
    F --> J[DB2]
```

### Sharding-JDBC é…ç½®

**Spring Boot é…ç½®ï¼ˆYAMLï¼‰**ï¼š

```yaml
spring:
  shardingsphere:
    datasource:
      names: ds0,ds1
      ds0:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        jdbc-url: jdbc:mysql://192.168.1.10:3306/db0
        username: root
        password: password
      ds1:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        jdbc-url: jdbc:mysql://192.168.1.11:3306/db1
        username: root
        password: password

    rules:
      sharding:
        tables:
          # è®¢å•è¡¨é…ç½®
          t_order:
            actual-data-nodes: ds$->{0..1}.t_order_$->{0..1}
            database-strategy:
              standard:
                sharding-column: user_id
                sharding-algorithm-name: db_mod
            table-strategy:
              standard:
                sharding-column: user_id
                sharding-algorithm-name: table_mod
            key-generate-strategy:
              column: order_id
              key-generator-name: snowflake

        sharding-algorithms:
          db_mod:
            type: MOD
            props:
              sharding-count: 2
          table_mod:
            type: MOD
            props:
              sharding-count: 2

        key-generators:
          snowflake:
            type: SNOWFLAKE

    props:
      sql-show: true
```

**Java é…ç½®**ï¼š

```java
@Configuration
public class ShardingConfig {

    @Bean
    public DataSource shardingDataSource() throws SQLException {
        // é…ç½®æ•°æ®æº
        Map<String, DataSource> dataSourceMap = new HashMap<>();
        dataSourceMap.put("ds0", createDataSource("192.168.1.10", "db0"));
        dataSourceMap.put("ds1", createDataSource("192.168.1.11", "db1"));

        // è®¢å•è¡¨è§„åˆ™
        ShardingRuleConfiguration orderRule = new ShardingRuleConfiguration();
        orderRule.getTables().add(getOrderTableRule());

        // åˆ†ç‰‡ç®—æ³•
        Properties dbProps = new Properties();
        dbProps.setProperty("sharding-count", "2");

        Properties tableProps = new Properties();
        tableProps.setProperty("sharding-count", "2");

        orderRule.getShardingAlgorithms().put("db_mod",
            new ShardingAlgorithmsConfiguration("MOD", dbProps));
        orderRule.getShardingAlgorithms().put("table_mod",
            new ShardingAlgorithmsConfiguration("MOD", tableProps));

        // åˆ›å»º ShardingDataSource
        return ShardingSphereDataSourceFactory.createDataSource(
            dataSourceMap,
            Collections.singleton(orderRule),
            new Properties()
        );
    }

    private ShardingTableRuleConfiguration getOrderTableRule() {
        ShardingTableRuleConfiguration table = new ShardingTableRuleConfiguration(
            "t_order",
            "ds$->{0..1}.t_order_$->{0..1}"
        );

        // åˆ†åº“ç­–ç•¥
        table.setDatabaseShardingStrategy(new StandardShardingStrategyConfiguration(
            "user_id",
            "db_mod"
        ));

        // åˆ†è¡¨ç­–ç•¥
        table.setTableShardingStrategy(new StandardShardingStrategyConfiguration(
            "user_id",
            "table_mod"
        ));

        // ä¸»é”®ç”Ÿæˆ
        table.setKeyGenerateStrategy(new KeyGenerateStrategyConfiguration(
            "order_id",
            "snowflake"
        ));

        return table;
    }

    private DataSource createDataSource(String host, String database) {
        HikariConfig config = new HikariConfig();
        config.setDriverClassName("com.mysql.cj.jdbc.Driver");
        config.setJdbcUrl(String.format("jdbc:mysql://%s:3306/%s", host, database));
        config.setUsername("root");
        config.setPassword("password");
        config.setMaximumPoolSize(10);
        return new HikariDataSource(config);
    }
}
```

### è¯»å†™åˆ†ç¦»

```yaml
spring:
  shardingsphere:
    datasource:
      names: master,slave0,slave1
      master:
        type: com.zaxxer.hikari.HikariDataSource
        jdbc-url: jdbc:mysql://192.168.1.10:3306/db
        username: root
        password: password
      slave0:
        type: com.zaxxer.hikari.HikariDataSource
        jdbc-url: jdbc:mysql://192.168.1.11:3306/db
        username: root
        password: password
      slave1:
        type: com.zaxxer.hikari.HikariDataSource
        jdbc-url: jdbc:mysql://192.168.1.12:3306/db
        username: root
        password: password

    rules:
      readwrite-splitting:
        data-sources:
          readwrite_ds:
            static-strategy:
              write-data-source-name: master
              read-data-source-names: slave0,slave1
            load-balancer-name: round_robin

        load-balancers:
          round_robin:
            type: ROUND_ROBIN
```

### å¹¿æ’­è¡¨é…ç½®

```yaml
# å¹¿æ’­è¡¨ï¼šæ¯ä¸ªåº“éƒ½æœ‰ä¸€ä»½å®Œæ•´çš„è¡¨æ•°æ®
# é€‚åˆæ•°æ®é‡å°ã€æ”¹åŠ¨å°‘çš„å­—å…¸è¡¨

spring:
  shardingsphere:
    rules:
      sharding:
        broadcast-tables:
          - t_dict  # å­—å…¸è¡¨
          - t_config  # é…ç½®è¡¨
          - t_region  # åœ°åŒºè¡¨

        tables:
          t_dict:
            key-generate-strategy:
              column: id
              key-generator-name: snowflake
```

### ç»‘å®šè¡¨é…ç½®

```yaml
# ç»‘å®šè¡¨ï¼šåˆ†ç‰‡é”®ç›¸åŒçš„è¡¨ï¼Œåœ¨å…³è”æŸ¥è¯¢æ—¶é¿å…ç¬›å¡å°”ç§¯

spring:
  shardingsphere:
    rules:
      sharding:
        binding-tables:
          - t_order,t_order_item  # è®¢å•è¡¨å’Œè®¢å•æ˜ç»†è¡¨ç»‘å®š

        tables:
          t_order:
            actual-data-nodes: ds$->{0..1}.t_order_$->{0..1}
            table-strategy:
              standard:
                sharding-column: user_id
                sharding-algorithm-name: table_mod

          t_order_item:
            actual-data-nodes: ds$->{0..1}.t_order_item_$->{0..1}
            table-strategy:
              standard:
                sharding-column: user_id
                sharding-algorithm-name: table_mod

# å…³è”æŸ¥è¯¢ç¤ºä¾‹ï¼š
# SELECT * FROM t_order o JOIN t_order_item i ON o.order_id = i.order_id
#
# ä¸ä½¿ç”¨ç»‘å®šè¡¨ï¼šç¬›å¡å°”ç§¯ â†’ 2åº“ x 2è¡¨ x 2åº“ x 2è¡¨ = 16æ¬¡æŸ¥è¯¢
# ä½¿ç”¨ç»‘å®šè¡¨ï¼š4æ¬¡æŸ¥è¯¢ï¼ˆåŒä¸€åˆ†ç‰‡çš„è¡¨ç›´æ¥ JOINï¼‰
```

---

## æ•°æ®è¿ç§»

### åœæœºè¿ç§»ï¼ˆç®€å•ç²—æš´ï¼‰

```bash
# æ­¥éª¤ï¼š
# 1. åœæ­¢åº”ç”¨å†™å…¥
# 2. å¯¼å‡ºå…¨é‡æ•°æ®
mysqldump -u root -p --single-transaction --routines --triggers \
  --all-databases > full_backup.sql

# 3. å¯¼å…¥åˆ°æ–°åº“
mysql -u root -p < full_backup.sql

# 4. éªŒè¯æ•°æ®ä¸€è‡´æ€§
# 5. åˆ‡æ¢åº”ç”¨é…ç½®
# 6. é‡å¯åº”ç”¨

# ç¼ºç‚¹ï¼šé•¿æ—¶é—´åœæœºï¼Œç”¨æˆ·ä½“éªŒå·®
```

### åŒå†™è¿ç§»ï¼ˆæ¨èï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åŒå†™è¿ç§»æµç¨‹                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  é˜¶æ®µ1: åº”ç”¨åŒå†™                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ åº”ç”¨   â”‚â”€â”€â”€â†’â”‚ æ—§åº“ï¼ˆä¸»ï¼‰  â”‚                      â”‚
â”‚  â”‚        â”‚â”€â”€â”€â†’â”‚ æ–°åº“ï¼ˆä»ï¼‰  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â†“         â†“         â†“                        â”‚
â”‚      åŒå†™æ•°æ®     åŒæ­¥ï¼ˆå¼‚æ­¥ï¼‰                       â”‚
â”‚                                                      â”‚
â”‚  é˜¶æ®µ2: å†å²æ•°æ®è¿ç§»                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ è¿ç§»ç¨‹åº â”‚ â”€â”€â”€â†’ â”‚ æ–°åº“ï¼ˆä»ï¼‰  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       æ‰¹é‡è¿ç§»                                       â”‚
â”‚                                                      â”‚
â”‚  é˜¶æ®µ3: æ•°æ®æ ¡éªŒ                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ æ ¡éªŒç¨‹åº â”‚ â”€â”€â”€â†’ â”‚ å·®å¼‚ä¿®å¤   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                      â”‚
â”‚  é˜¶æ®µ4: åˆ‡æ¢è¯»æµé‡                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ åº”ç”¨   â”‚â”€â”€â”€â†’â”‚ æ–°åº“ï¼ˆä¸»ï¼‰  â”‚ â† è¯»æµé‡åˆ‡æ¢         â”‚
â”‚  â”‚        â”‚â”€â”€â”€â†’â”‚ æ—§åº“ï¼ˆä»ï¼‰  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                      â”‚
â”‚  é˜¶æ®µ5: åœæ­¢æ—§åº“å†™å…¥                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ åº”ç”¨   â”‚â”€â”€â”€â†’â”‚ æ–°åº“ï¼ˆä¸»ï¼‰  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŒå†™è¿ç§»ä»£ç ç¤ºä¾‹**ï¼š

```java
@Service
public class OrderService {

    @Autowired
    private OrderMapper oldOrderMapper;

    @Autowired
    private OrderMapper newOrderMapper;

    // åŒå†™
    @Transactional
    public void createOrder(Order order) {
        // å…ˆå†™æ—§åº“
        oldOrderMapper.insert(order);

        // å¼‚æ­¥å†™æ–°åº“ï¼ˆå¤±è´¥ä¸å½±å“ä¸»æµç¨‹ï¼‰
        CompletableFuture.runAsync(() -> {
            try {
                newOrderMapper.insert(order);
            } catch (Exception e) {
                log.error("å†™å…¥æ–°åº“å¤±è´¥", e);
                // ä¿å­˜åˆ°å¤±è´¥é˜Ÿåˆ—ï¼Œåç»­é‡è¯•
                failureQueue.add(order);
            }
        });
    }

    // æ•°æ®è¿ç§»
    public void migrateData() {
        int pageSize = 1000;
        int lastId = 0;

        while (true) {
            List<Order> orders = oldOrderMapper.selectByIdRange(lastId, lastId + pageSize);

            if (orders.isEmpty()) {
                break;
            }

            // æ‰¹é‡æ’å…¥æ–°åº“
            for (Order order : orders) {
                try {
                    newOrderMapper.insert(order);
                } catch (Exception e) {
                    log.error("è¿ç§»è®¢å•å¤±è´¥: {}", order.getId(), e);
                }
            }

            lastId += pageSize;
        }
    }
}
```

### å¢é‡åŒæ­¥

```java
// åŸºäº Binlog çš„å¢é‡åŒæ­¥

@Service
public class BinlogSyncService {

    @Autowired
    private CanalClient canalClient;

    public void startSync() {
        while (true) {
            Message message = canalClient.getWithoutAck(100);
            long batchId = message.getId();
            List<CanalEntry.Entry> entries = message.getEntries();

            if (batchId != -1 && !entries.isEmpty()) {
                for (CanalEntry.Entry entry : entries) {
                    if (entry.getEntryType() == CanalEntry.EntryType.ROWDATA) {
                        CanalEntry.RowChange rowChange =
                            CanalEntry.RowChange.parseFrom(entry.getStoreValue());

                        for (CanalEntry.RowData rowData : rowChange.getRowDatasList()) {
                            if (rowChange.getEventType() == CanalEntry.EventType.INSERT) {
                                handleInsert(rowData.getAfterColumnsList());
                            } else if (rowChange.getEventType() == CanalEntry.EventType.UPDATE) {
                                handleUpdate(rowData.getAfterColumnsList());
                            } else if (rowChange.getEventType() == CanalEntry.EventType.DELETE) {
                                handleDelete(rowData.getBeforeColumnsList());
                            }
                        }
                    }
                }
            }

            canalClient.ack(batchId);
        }
    }
}
```

---

## è·¯ç”±ç­–ç•¥

### åˆ†åº“åˆ†è¡¨è·¯ç”±

**æ ‡å‡†è·¯ç”±**ï¼š

```java
// åŸºäºå•å­—æ®µçš„è·¯ç”±
public interface ShardingAlgorithm extends ShardingAlgorithm {

    // doSharding æ‰§è¡Œè·¯ç”±è®¡ç®—
    Collection<String> doSharding(
        Collection<String> availableTargetNames,
        ComplexKeysShardingValue shardingValue
    );
}

// è‡ªå®šä¹‰å–æ¨¡è·¯ç”±
public class ModShardingAlgorithm implements PreciseShardingAlgorithm<Long> {

    private final int shardingCount;

    public ModShardingAlgorithm(int shardingCount) {
        this.shardingCount = shardingCount;
    }

    @Override
    public String doSharding(
        Collection<String> availableTargetNames,
        PreciseShardingValue<Long> shardingValue
    ) {
        Long value = shardingValue.getValue();
        int index = (int) (value % shardingCount);

        for (String target : availableTargetNames) {
            if (target.endsWith(String.valueOf(index))) {
                return target;
            }
        }

        throw new IllegalArgumentException("æ— å¯ç”¨åˆ†ç‰‡");
    }
}
```

**å¤åˆè·¯ç”±**ï¼š

```java
// å¤šå­—æ®µè·¯ç”±
public class ComplexShardingAlgorithm
    implements ComplexKeysShardingAlgorithm<Long> {

    @Override
    public Collection<String> doSharding(
        Collection<String> availableTargetNames,
        ComplexKeysShardingValue<Long> shardingValue
    ) {
        // è·å–å¤šä¸ªåˆ†ç‰‡é”®çš„å€¼
        Collection<Long> userIds = shardingValue.getColumnNameAndShardingValuesMap()
            .get("user_id");
        Collection<Long> orderIds = shardingValue.getColumnNameAndShardingValuesMap()
            .get("order_id");

        Set<String> result = new HashSet<>();

        if (userIds != null) {
            for (Long userId : userIds) {
                int index = (int) (userId % 4);
                result.add("t_order_" + index);
            }
        }

        if (orderIds != null) {
            for (Long orderId : orderIds) {
                int index = (int) (orderId % 4);
                result.add("t_order_" + index);
            }
        }

        return result;
    }
}
```

### Hint è·¯ç”±ï¼ˆå¼ºåˆ¶è·¯ç”±ï¼‰

```java
// ä½¿ç”¨ Hint å¼ºåˆ¶æŒ‡å®šåˆ†ç‰‡

@Service
public class OrderService {

    @Autowired
    private OrderMapper orderMapper;

    // å¼ºåˆ¶è·¯ç”±åˆ°æŒ‡å®šåˆ†ç‰‡
    public void forceInsertOrder(Order order, String shardingValue) {
        // è®¾ç½® Hint
        HintManager hintManager = HintManager.getInstance();
        try {
            // æ·»åŠ åˆ†ç‰‡å€¼
            hintManager.addTableShardingValue("t_order", shardingValue);

            // æ‰§è¡Œ SQLï¼ˆä¼šä½¿ç”¨ Hint è·¯ç”±ï¼‰
            orderMapper.insert(order);
        } finally {
            hintManager.close();
        }
    }

    // å¼ºåˆ¶è·¯ç”±åˆ°ä¸»åº“
    public Order getOrderFromMaster(Long orderId) {
        HintManager hintManager = HintManager.getInstance();
        try {
            hintManager.setMasterRouteOnly();
            return orderMapper.selectById(orderId);
        } finally {
            hintManager.close();
        }
    }
}
```

---

## æ‰©ç¼©å®¹æ–¹æ¡ˆ

### åœ¨çº¿æ‰©å®¹ï¼ˆå€å¢æ³•ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ‰©å®¹å‰ï¼ˆ2åˆ†ç‰‡ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  shard_0: user_id % 2 = 0                           â”‚
â”‚  shard_1: user_id % 2 = 1                           â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ‰©å®¹åï¼ˆ4åˆ†ç‰‡ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  æ–°åˆ†ç‰‡è§„åˆ™ï¼šuser_id % 4                             â”‚
â”‚                                                      â”‚
â”‚  shard_0: user_id % 4 = 0  â† ä¿ç•™åŸæœ‰æ•°æ®            â”‚
â”‚  shard_1: user_id % 4 = 1  â† ä¿ç•™åŸæœ‰æ•°æ®            â”‚
â”‚  shard_2: user_id % 4 = 2  â† æ–°å»ºï¼Œéœ€è¿ç§»æ•°æ®        â”‚
â”‚  shard_3: user_id % 4 = 3  â† æ–°å»ºï¼Œéœ€è¿ç§»æ•°æ®        â”‚
â”‚                                                      â”‚
â”‚  æ•°æ®è¿ç§»ï¼š                                          â”‚
â”‚  - shard_0 çš„ 50% æ•°æ® â†’ shard_2                    â”‚
â”‚  - shard_1 çš„ 50% æ•°æ® â†’ shard_3                    â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼š
âœ… åªéœ€è¿ç§»ä¸€åŠæ•°æ®
âœ… å€å¢æ‰©å®¹ï¼Œè¿ç§»æ–¹æ¡ˆç®€å•

ç¼ºç‚¹ï¼š
âŒ å¿…é¡»å€å¢ï¼Œä¸å¤Ÿçµæ´»
âŒ æ•°æ®è¿ç§»é‡å¤§
```

**æ‰©å®¹æ­¥éª¤**ï¼š

```java
// 1. æ–°å»ºåˆ†ç‰‡
CREATE DATABASE db2;
CREATE TABLE db2.t_order_2 LIKE db0.t_order_0;
CREATE TABLE db2.t_order_3 LIKE db0.t_order_1;

// 2. æ•°æ®è¿ç§»ï¼ˆåŒå†™ + åŒæ­¥ï¼‰
public void migrateShardData() {
    // ä» shard_0 è¿ç§»ä¸€åŠæ•°æ®åˆ° shard_2
    List<Order> orders = orderMapper.selectByShard(0);
    for (Order order : orders) {
        if (order.getUserId() % 4 == 2) {
            orderMapper.insertToShard(order, 2);
            // éªŒè¯ååˆ é™¤åŸæ•°æ®
            orderMapper.deleteById(order.getId(), 0);
        }
    }
}

// 3. åˆ‡æ¢è·¯ç”±è§„åˆ™
// æ—§è§„åˆ™ï¼šuser_id % 2
// æ–°è§„åˆ™ï¼šuser_id % 4

// 4. ä¸‹çº¿æ—§åˆ†ç‰‡ï¼ˆå¯é€‰ï¼‰
```

### ä¸€è‡´æ€§Hashæ‰©å®¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¸€è‡´æ€§Hashæ‰©å®¹ï¼ˆå¹³æ»‘æ‰©å®¹ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  åˆå§‹çŠ¶æ€ï¼š3ä¸ªèŠ‚ç‚¹                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚      Hash ç¯                         â”‚           â”‚
â”‚  â”‚                                      â”‚           â”‚
â”‚  â”‚    DB0 â”€â”€â”€â”€ DB1 â”€â”€â”€â”€ DB2            â”‚           â”‚
â”‚  â”‚     |        |        |              â”‚           â”‚
â”‚  â”‚   1000ä¸ª   1000ä¸ª   1000ä¸ªèŠ‚ç‚¹       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                      â”‚
â”‚  æ·»åŠ èŠ‚ç‚¹ï¼šDB3                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚      Hash ç¯                         â”‚           â”‚
â”‚  â”‚                                      â”‚           â”‚
â”‚  â”‚    DB0 â”€â”€ DB3 â”€â”€â”€ DB1 â”€â”€â”€â”€ DB2      â”‚           â”‚
â”‚  â”‚     |      |        |       |        â”‚           â”‚
â”‚  â”‚   750ä¸ª  250ä¸ª    750ä¸ª   1000ä¸ª     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                      â”‚
â”‚  æ•°æ®è¿ç§»ï¼š                                          â”‚
â”‚  - DB0 è¿ç§» 250ä¸ªèŠ‚ç‚¹åˆ° DB3ï¼ˆæ€»æ•°æ®é‡çš„ 1/12ï¼‰       â”‚
â”‚  - å…¶ä»–èŠ‚ç‚¹æ•°æ®ä¸å˜                                 â”‚
â”‚                                                      â”‚
â”‚  ä¼˜ç‚¹ï¼š                                             â”‚
â”‚  âœ… æœ€å°åŒ–æ•°æ®è¿ç§»                                   â”‚
â”‚  âœ… æ”¯æŒä»»æ„æ•°é‡æ‰©å®¹                                 â”‚
â”‚  âœ… èŠ‚ç‚¹å¢åˆ å½±å“æœ€å°                                 â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æœ¬ç« å°ç»“

### å­¦ä¹ æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œè¯·ç¡®è®¤ä½ èƒ½å¤Ÿï¼š

- [ ] ç†è§£åˆ†åº“åˆ†è¡¨çš„å¿…è¦æ€§å’Œæ—¶æœº
- [ ] æŒæ¡å‚ç›´åˆ†åº“å’Œæ°´å¹³åˆ†è¡¨çš„ç­–ç•¥
- [ ] ç†Ÿç»ƒä½¿ç”¨ ShardingSphere è¿›è¡Œåˆ†åº“åˆ†è¡¨
- [ ] å®ç°è¯»å†™åˆ†ç¦»å’Œå¹¿æ’­è¡¨
- [ ] è®¾è®¡æ•°æ®è¿ç§»æ–¹æ¡ˆï¼ˆåŒå†™ã€å¢é‡åŒæ­¥ï¼‰
- [ ] å®ç°è‡ªå®šä¹‰è·¯ç”±ç­–ç•¥
- [ ] è®¾è®¡åœ¨çº¿æ‰©å®¹æ–¹æ¡ˆ
- [ ] å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡å’Œè·¨åº“æŸ¥è¯¢é—®é¢˜

### æ ¸å¿ƒè¦ç‚¹å›é¡¾

1. **åˆ†ç‰‡ç­–ç•¥**ï¼šå‚ç›´åˆ†åº“ï¼ˆä¸šåŠ¡æ‹†åˆ†ï¼‰ã€æ°´å¹³åˆ†è¡¨ï¼ˆæ•°æ®æ‹†åˆ†ï¼‰
2. **ä¸­é—´ä»¶**ï¼šShardingSphere æ˜¯ä¸»æµé€‰æ‹©ï¼Œæ”¯æŒåˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»
3. **æ•°æ®è¿ç§»**ï¼šåŒå†™è¿ç§» + å¢é‡åŒæ­¥ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
4. **è·¯ç”±ç­–ç•¥**ï¼šHash åˆ†ç‰‡ã€Range åˆ†ç‰‡ã€ä¸€è‡´æ€§Hash
5. **æ‰©ç¼©å®¹**ï¼šå€å¢æ³•æœ€ç®€å•ï¼Œä¸€è‡´æ€§Hashæœ€çµæ´»

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [ç¬¬26ç« ï¼šåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ â†’](./chapter-25)
- [ç¬¬22ç« ï¼šMongoDB æ–‡æ¡£æ•°æ®åº“ â†’](./chapter-21)
- [ShardingSphere å®˜æ–¹æ–‡æ¡£](https://shardingsphere.apache.org/document/current/en/overview/)
- [æ•°æ®åº“åˆ†åº“åˆ†è¡¨åŸºç¡€](https://shardingsphere.apache.org/document/current/en/concepts/)

---

**æ›´æ–°æ—¶é—´**ï¼š2026å¹´2æœˆ | **ç‰ˆæœ¬**ï¼šv1.0
