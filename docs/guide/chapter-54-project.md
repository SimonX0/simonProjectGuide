# å®æˆ˜é¡¹ç›®5ï¼šåŸºäºMicroAppçš„ä¼ä¸šçº§å¾®ç”µå•†å¹³å°

> **é¡¹ç›®éš¾åº¦**ï¼šâ­â­â­â­â­
> **é¢„è®¡æ—¶é—´**ï¼š80-100å°æ—¶
> **æŠ€æœ¯æ ˆ**ï¼šVue 3 | MicroApp | TypeScript | Vite | PNPM | Monorepo

## é¡¹ç›®æ¦‚è¿°

åŸºäº**äº¬ä¸œå¼€æºçš„MicroAppå¾®å‰ç«¯æ¡†æ¶**ï¼Œæ„å»ºä¸€ä¸ªå¤§å‹ä¼ä¸šçº§ç”µå•†å¹³å°ï¼Œå®ç°å¤šä¸ªå­åº”ç”¨çš„æ— ç¼é›†æˆï¼Œæä¾›é«˜æ€§èƒ½ã€æ˜“ç»´æŠ¤çš„å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹©MicroAppï¼Ÿ

```
ğŸš€ æ¥è‡ªäº¬ä¸œï¼šäº¬ä¸œé›¶å”®å›¢é˜Ÿç”Ÿäº§å®è·µ
âš¡ é«˜æ€§èƒ½ï¼šæ¯”qiankunå¿«40%+ï¼Œå†…å­˜å ç”¨æ›´ä½
ğŸ¦ é›¶ä¾µå…¥ï¼šå­åº”ç”¨æ— éœ€ä»»ä½•ä¿®æ”¹å³å¯æ¥å…¥
ğŸ“¦ è½»é‡çº§ï¼šæ ¸å¿ƒåº“ä»…çº¦20KBï¼Œgzipå6KB
ğŸ”„ æ¡†æ¶æ— å…³ï¼šå®Œç¾æ”¯æŒVue2/3ã€Reactã€Angularç­‰
ğŸ¨ WebComponentsï¼šåŸºäºWeb Componentsæ€æƒ³å®ç°
ğŸ” å®Œæ•´æ²™ç®±ï¼šJSæ²™ç®± + æ ·å¼éš”ç¦»
ğŸ’¼ ä¼ä¸šçº§ï¼šäº¬ä¸œã€ç¾å›¢ç­‰å¤§å‚ç”Ÿäº§éªŒè¯
```

### æ ¸å¿ƒåŠŸèƒ½

```
ğŸª ä¸»åº”ç”¨ï¼ˆåŸºåº§åº”ç”¨ï¼‰
   â”œâ”€â”€ é¦–é¡µåº”ç”¨ï¼ˆæµé‡å…¥å£ï¼‰
   â”œâ”€â”€ å•†å“åº”ç”¨ï¼ˆå•†å“å±•ç¤ºã€æœç´¢ï¼‰
   â”œâ”€â”€ è´­ç‰©è½¦åº”ç”¨ï¼ˆè´­ç‰©è½¦ç®¡ç†ï¼‰
   â”œâ”€â”€ è®¢å•åº”ç”¨ï¼ˆè®¢å•ç®¡ç†ï¼‰
   â”œâ”€â”€ ç”¨æˆ·åº”ç”¨ï¼ˆç”¨æˆ·ä¸­å¿ƒï¼‰
   â”œâ”€â”€ è¥é”€åº”ç”¨ï¼ˆä¼˜æƒ åˆ¸ã€æ´»åŠ¨ï¼‰
   â””â”€â”€ æ”¯ä»˜åº”ç”¨ï¼ˆæ”¯ä»˜æ”¶é“¶å°ï¼‰

ğŸ¯ æ ¸å¿ƒèƒ½åŠ›
   â”œâ”€â”€ åº”ç”¨ç®¡ç†ï¼šåŠ¨æ€æ³¨å†Œã€åŠ è½½ã€å¸è½½
   â”œâ”€â”€ è·¯ç”±ç®¡ç†ï¼šä¸»å­åº”ç”¨è·¯ç”±ååŒ
   â”œâ”€â”€ çŠ¶æ€å…±äº«ï¼šå…¨å±€çŠ¶æ€ç®¡ç†
   â”œâ”€â”€ é€šä¿¡æœºåˆ¶ï¼šä¸»å­åº”ç”¨é€šä¿¡
   â”œâ”€â”€ æ ·å¼éš”ç¦»ï¼šShadowDOMéš”ç¦»
   â”œâ”€â”€ é¢„åŠ è½½ï¼šæ™ºèƒ½é¢„åŠ è½½ç­–ç•¥
   â””â”€â”€ æ€§èƒ½ç›‘æ§ï¼šåº”ç”¨æ€§èƒ½ç›‘æ§
```

### æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸»åº”ç”¨ (Main App - åŸºåº§)                   â”‚
â”‚                    Vue 3 + MicroApp                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      å…¬å…±å¸ƒå±€                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ TopBar (æœç´¢æ¡†ã€ç™»å½•ã€æ¶ˆæ¯)                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ NavBar (å¯¼èˆªèœå•ã€åˆ†ç±»)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ SideBar (ä¸ªäººä¸­å¿ƒã€å¿«æ·å…¥å£)                      â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Content (å­åº”ç”¨å®¹å™¨åŒºåŸŸ)                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  å…¨å±€æœåŠ¡                                                   â”‚
â”‚  â”œâ”€â”€ å…¨å±€çŠ¶æ€ (Pinia + é€šä¿¡)                               â”‚
â”‚  â”œâ”€â”€ ç”¨æˆ·è®¤è¯ (å•ç‚¹ç™»å½•)                                   â”‚
â”‚  â”œâ”€â”€ æƒé™ç®¡ç† (RBAC)                                       â”‚
â”‚  â”œâ”€â”€ æ¶ˆæ¯é€šçŸ¥ (EventBus)                                   â”‚
â”‚  â””â”€â”€ æ€§èƒ½ç›‘æ§ (Metrics)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚           â”‚             â”‚              â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚é¦–é¡µ   â”‚  â”‚å•†å“   â”‚  â”‚è´­ç‰©è½¦  â”‚  â”‚è®¢å•     â”‚  â”‚ç”¨æˆ·ä¸­å¿ƒ  â”‚
â”‚å­åº”ç”¨ â”‚  â”‚å­åº”ç”¨ â”‚  â”‚å­åº”ç”¨  â”‚  â”‚å­åº”ç”¨   â”‚  â”‚å­åº”ç”¨    â”‚
â”‚Vue3   â”‚  â”‚Vue3   â”‚  â”‚Vue3    â”‚  â”‚Vue3     â”‚  â”‚Vue3      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æŠ€æœ¯æ ˆå¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MicroApp   â”‚    qiankun   â”‚   single-spa â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº¬ä¸œå¼€æº   â”‚   é˜¿é‡Œå¼€æº   â”‚   ç¤¾åŒºé¡¹ç›®   â”‚
â”‚  WebComponents â”‚ HTML Entry â”‚ JS Entry    â”‚
â”‚  æ›´ç®€å•     â”‚   ä¸­ç­‰å¤æ‚   â”‚   è¾ƒå¤æ‚     â”‚
â”‚  æ€§èƒ½æ›´å¥½   â”‚   æ€§èƒ½è‰¯å¥½   â”‚   æ€§èƒ½ä¸€èˆ¬   â”‚
â”‚  ~20KB      â”‚   ~50KB      â”‚   ~30KB      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é¡¹ç›®æ¶æ„è®¾è®¡

### 1. é¡¹ç›®ç»“æ„

```bash
microapp-ecommerce-platform/
â”œâ”€â”€ main-app/                      # ä¸»åº”ç”¨ï¼ˆåŸºåº§ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ micro/                # MicroAppé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ apps.ts          # å­åº”ç”¨é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ lifecycle.ts     # ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ communication.ts # é€šä¿¡æœºåˆ¶
â”‚   â”‚   â”‚   â””â”€â”€ prefetch.ts      # é¢„åŠ è½½ç­–ç•¥
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ components/           # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ TopBar/          # é¡¶éƒ¨æ 
â”‚   â”‚   â”‚   â”œâ”€â”€ NavBar/          # å¯¼èˆªæ 
â”‚   â”‚   â”‚   â”œâ”€â”€ SideBar/         # ä¾§è¾¹æ 
â”‚   â”‚   â”‚   â””â”€â”€ SearchBar/       # æœç´¢æ¡†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layouts/              # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ MainLayout.vue
â”‚   â”‚   â”‚   â””â”€â”€ BlankLayout.vue
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ router/               # ä¸»åº”ç”¨è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ stores/               # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ cart.ts
â”‚   â”‚   â”‚   â””â”€â”€ app.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ composables/          # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ useMicroApp.ts
â”‚   â”‚   â”‚   â””â”€â”€ useGlobalData.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                  # APIæ¥å£
â”‚   â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ styles/               # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ sub-apps/                      # å­åº”ç”¨
â”‚   â”œâ”€â”€ home-app/                 # é¦–é¡µåº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ product-app/              # å•†å“åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProductList.vue      # å•†å“åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProductDetail.vue    # å•†å“è¯¦æƒ…
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProductSearch.vue    # å•†å“æœç´¢
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProductCard.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProductFilter.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProductSort.vue
â”‚   â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚   â””â”€â”€ vite.config.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ cart-app/                 # è´­ç‰©è½¦åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CartList.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Checkout.vue
â”‚   â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚   â””â”€â”€ vite.config.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ order-app/                # è®¢å•åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OrderList.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OrderDetail.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ OrderCreate.vue
â”‚   â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚   â””â”€â”€ vite.config.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ user-app/                 # ç”¨æˆ·ä¸­å¿ƒåº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserProfile.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserOrders.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserSettings.vue
â”‚   â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚   â””â”€â”€ vite.config.ts
â”‚   â”‚
â”‚   â””â”€â”€ marketing-app/            # è¥é”€åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ views/
â”‚       â”‚   â”‚   â”œâ”€â”€ CouponList.vue
â”‚       â”‚   â”‚   â””â”€â”€ ActivityList.vue
â”‚       â”‚   â””â”€â”€ main.ts
â”‚       â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ shared/                        # å…±äº«æ¨¡å—
â”‚   â”œâ”€â”€ components/               # å…±äº«ç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”œâ”€â”€ Card/
â”‚   â”‚   â”œâ”€â”€ Form/
â”‚   â”‚   â”œâ”€â”€ Table/
â”‚   â”‚   â””â”€â”€ Modal/
â”‚   â”‚
â”‚   â”œâ”€â”€ composables/              # å…±äº«ç»„åˆå‡½æ•°
â”‚   â”œâ”€â”€ utils/                    # å…±äº«å·¥å…·
â”‚   â”œâ”€â”€ types/                    # å…±äº«ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ constants/                # å…±äº«å¸¸é‡
â”‚   â””â”€â”€ styles/                   # å…±äº«æ ·å¼
â”‚
â”œâ”€â”€ packages/                      # MonorepoåŒ…ç®¡ç†
â”‚   â”œâ”€â”€ eslint-config/
â”‚   â”œâ”€â”€ prettier-config/
â”‚   â”œâ”€â”€ ts-config/
â”‚   â””â”€â”€ tailwind-config/
â”‚
â”œâ”€â”€ pnpm-workspace.yaml           # PNPMå·¥ä½œåŒºé…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ .npmrc
â””â”€â”€ README.md
```

### 2. æŠ€æœ¯é€‰å‹

| åˆ†ç±» | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| **å¾®å‰ç«¯æ¡†æ¶** | MicroApp | äº¬ä¸œå¼€æºï¼Œé«˜æ€§èƒ½ |
| **ä¸»åº”ç”¨æ¡†æ¶** | Vue 3.4+ | Composition API |
| **æ„å»ºå·¥å…·** | Vite 5.x | å¿«é€Ÿæ„å»º |
| **åŒ…ç®¡ç†** | PNPM | Monorepoæ”¯æŒ |
| **è¯­è¨€** | TypeScript 5.x | ç±»å‹å®‰å…¨ |
| **çŠ¶æ€ç®¡ç†** | Pinia | Vue 3å®˜æ–¹ |
| **è·¯ç”±** | Vue Router 4.x | è·¯ç”±ç®¡ç† |
| **UIæ¡†æ¶** | Element Plus | ä¸»åº”ç”¨ |
| **HTTP** | Axios | è¯·æ±‚å°è£… |
| **é€šä¿¡** | MicroAppæ•°æ®ä¸­å¿ƒ | é€šä¿¡æœºåˆ¶ |
| **æ ·å¼** | SCSS + Tailwind | æ ·å¼æ–¹æ¡ˆ |

---

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. ä¸»åº”ç”¨é…ç½®ï¼ˆåŸºåº§åº”ç”¨ï¼‰

**å®‰è£…MicroApp**

```bash
# ä¸»åº”ç”¨å®‰è£…
cd main-app
pnpm add @micro-zoe/micro-app

# å­åº”ç”¨æ— éœ€å®‰è£…ä»»ä½•ä¾èµ–ï¼
```

**å­åº”ç”¨é…ç½®**

```typescript
// main-app/src/micro/apps.ts
import { defineConfig } from '@micro-zoe/micro-app/types'

interface MicroAppConfig {
  name: string;
  url: string;
  baseroute: string;
  iframe?: boolean;
  keepAlive?: boolean;
  shadowDOM?: boolean;
  inline?: boolean;
}

// å­åº”ç”¨é…ç½®åˆ—è¡¨
export const microApps: MicroAppConfig[] = [
  {
    name: 'home',          // åº”ç”¨åç§°
    url: process.env.VITE_HOME_URL || 'http://localhost:3001',
    baseroute: '/home',    // åŸºç¡€è·¯ç”±
    keepAlive: true,       // ä¿æ´»
    shadowDOM: true,       // å¼€å¯å½±å­DOMéš”ç¦»
  },
  {
    name: 'product',
    url: process.env.VITE_PRODUCT_URL || 'http://localhost:3002',
    baseroute: '/product',
    keepAlive: true,
    shadowDOM: true,
  },
  {
    name: 'cart',
    url: process.env.VITE_CART_URL || 'http://localhost:3003',
    baseroute: '/cart',
    keepAlive: true,       // è´­ç‰©è½¦éœ€è¦ä¿æ´»
    shadowDOM: true,
  },
  {
    name: 'order',
    url: process.env.VITE_ORDER_URL || 'http://localhost:3004',
    baseroute: '/order',
    keepAlive: false,
    shadowDOM: true,
  },
  {
    name: 'user',
    url: process.env.VITE_USER_URL || 'http://localhost:3005',
    baseroute: '/user',
    keepAlive: true,
    shadowDOM: true,
  },
  {
    name: 'marketing',
    url: process.env.VITE_MARKETING_URL || 'http://localhost:3006',
    baseroute: '/marketing',
    keepAlive: true,
    shadowDOM: true,
  },
];

// æ ¹æ®è·¯ç”±è·å–åº”ç”¨é…ç½®
export function getAppByPath(path: string): MicroAppConfig | undefined {
  return microApps.find(app => path.startsWith(app.baseroute));
}

// æ ¹æ®åç§°è·å–åº”ç”¨é…ç½®
export function getAppByName(name: string): MicroAppConfig | undefined {
  return microApps.find(app => app.name === name);
}
```

**ä¸»åº”ç”¨å…¥å£**

```vue
<!-- main-app/src/App.vue -->
<template>
  <div id="main-app" class="main-app">
    <!-- å…¬å…±å¤´éƒ¨ -->
    <TopBar />

    <!-- å¯¼èˆªæ  -->
    <NavBar />

    <div class="main-container">
      <!-- ä¾§è¾¹æ  -->
      <SideBar />

      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="content-area">
        <!-- ä¸»åº”ç”¨è·¯ç”± -->
        <router-view v-if="!isMicroAppRoute" />

        <!-- å­åº”ç”¨å®¹å™¨ -->
        <div v-show="isMicroAppRoute" class="micro-app-container">
          <!-- é¦–é¡µåº”ç”¨ -->
          <micro-app
            v-if="currentApp === 'home'"
            name="home"
            :url="apps.home.url"
            :baseroute="apps.home.baseroute"
            :keep-alive="apps.home.keepAlive"
            :shadowDOM="apps.home.shadowDOM"
            @created="handleAppCreated"
            @mounted="handleAppMounted"
            @unmount="handleAppUnmount"
          />

          <!-- å•†å“åº”ç”¨ -->
          <micro-app
            v-else-if="currentApp === 'product'"
            name="product"
            :url="apps.product.url"
            :baseroute="apps.product.baseroute"
            :keep-alive="apps.product.keepAlive"
            :shadowDOM="apps.product.shadowDOM"
            @datachange="handleDataChange"
          />

          <!-- è´­ç‰©è½¦åº”ç”¨ -->
          <micro-app
            v-else-if="currentApp === 'cart'"
            name="cart"
            :url="apps.cart.url"
            :baseroute="apps.cart.baseroute"
            :keep-alive="apps.cart.keepAlive"
            :shadowDOM="apps.cart.shadowDOM"
            :data="cartData"
          />

          <!-- è®¢å•åº”ç”¨ -->
          <micro-app
            v-else-if="currentApp === 'order'"
            name="order"
            :url="apps.order.url"
            :baseroute="apps.order.baseroute"
            :shadowDOM="apps.order.shadowDOM"
          />

          <!-- ç”¨æˆ·åº”ç”¨ -->
          <micro-app
            v-else-if="currentApp === 'user'"
            name="user"
            :url="apps.user.url"
            :baseroute="apps.user.baseroute"
            :keep-alive="apps.user.keepAlive"
            :shadowDOM="apps.user.shadowDOM"
          />

          <!-- è¥é”€åº”ç”¨ -->
          <micro-app
            v-else-if="currentApp === 'marketing'"
            name="marketing"
            :url="apps.marketing.url"
            :baseroute="apps.marketing.baseroute"
            :keep-alive="apps.marketing.keepAlive"
            :shadowDOM="apps.marketing.shadowDOM"
          />
        </div>
      </div>
    </div>

    <!-- å…¬å…±åº•éƒ¨ -->
    <FooterBar />
  </div>
</template>

<script setup lang="ts">
import { computed, ref, onMounted } from 'vue';
import { useRoute } from 'vue-router';
import { microApps, getAppByPath } from './micro/apps';
import TopBar from './components/TopBar.vue';
import NavBar from './components/NavBar.vue';
import SideBar from './components/SideBar.vue';
import FooterBar from './components/FooterBar.vue';

const route = useRoute();
const apps = ref({
  home: microApps[0],
  product: microApps[1],
  cart: microApps[2],
  order: microApps[3],
  user: microApps[4],
  marketing: microApps[5],
});

// åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºå­åº”ç”¨è·¯ç”±
const isMicroAppRoute = computed(() => {
  const app = getAppByPath(route.path);
  return !!app;
});

// è·å–å½“å‰æ¿€æ´»çš„åº”ç”¨åç§°
const currentApp = computed(() => {
  const app = getAppByPath(route.path);
  return app?.name || '';
});

// è´­ç‰©è½¦æ•°æ®ï¼ˆå‘å­åº”ç”¨ä¼ é€’ï¼‰
const cartData = computed(() => {
  return {
    itemCount: cartStore.itemCount,
    totalAmount: cartStore.totalAmount,
  };
});

// ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†
function handleAppCreated(e: CustomEvent) {
  console.log('å­åº”ç”¨åˆ›å»ºå®Œæˆ:', e.detail.appName);
}

function handleAppMounted(e: CustomEvent) {
  console.log('å­åº”ç”¨æŒ‚è½½å®Œæˆ:', e.detail.appName);
  // å‘é€ç”¨æˆ·ä¿¡æ¯ç»™å­åº”ç”¨
  sendUserInfoToSubApp(e.detail.appName);
}

function handleAppUnmount(e: CustomEvent) {
  console.log('å­åº”ç”¨å¸è½½å®Œæˆ:', e.detail.appName);
}

// æ•°æ®å˜åŒ–äº‹ä»¶ï¼ˆå­åº”ç”¨å‘ä¸»åº”ç”¨å‘é€æ•°æ®ï¼‰
function handleDataChange(e: CustomEvent) {
  console.log('æ”¶åˆ°å­åº”ç”¨æ•°æ®:', e.detail);
  const { data } = e.detail;

  // å¤„ç†è´­ç‰©è½¦æ›´æ–°
  if (data.type === 'cart_update') {
    cartStore.updateCart(data.payload);
  }

  // å¤„ç†ç”¨æˆ·ä¿¡æ¯æ›´æ–°
  if (data.type === 'user_update') {
    userStore.updateUser(data.payload);
  }
}

// å‘å­åº”ç”¨å‘é€ç”¨æˆ·ä¿¡æ¯
function sendUserInfoToSubApp(appName: string) {
  const microAppElement = document.querySelector(`micro-app[name="${appName}"]`);
  if (microAppElement) {
    microAppElement.dispatchEvent(new CustomEvent('user-info', {
      detail: {
        user: userStore.userInfo,
        token: userStore.token,
      },
    }));
  }
}

onMounted(() => {
  // åˆå§‹åŒ–MicroAppå…¨å±€é…ç½®
  microApp.start({
    // å…¨å±€æ ·å¼éš”ç¦»
    shadowDOM: true,

    // ç”Ÿå‘½å‘¨æœŸé’©å­
    lifeCycles: {
      created(e) {
        console.log('åº”ç”¨å·²åˆ›å»º:', e.detail.name);
      },
      mounted(e) {
        console.log('åº”ç”¨å·²æŒ‚è½½:', e.detail.name);
      },
      unmount(e) {
        console.log('åº”ç”¨å·²å¸è½½:', e.detail.name);
      },
    },

    // é¢„åŠ è½½ç­–ç•¥
    preFetchApps: [
      { name: 'home', path: '/home' },
      { name: 'product', path: '/product' },
    ],

    // é”™è¯¯å¤„ç†
    errorHandler(e) {
      console.error('å­åº”ç”¨é”™è¯¯:', e);
    },
  });
});
</script>

<style scoped lang="scss">
.main-app {
  width: 100%;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.main-container {
  flex: 1;
  display: flex;
  max-width: 1400px;
  margin: 0 auto;
  width: 100%;
}

.content-area {
  flex: 1;
  overflow: auto;
}

.micro-app-container {
  width: 100%;
  height: 100%;

  micro-app {
    display: block;
    width: 100%;
    height: 100%;
  }
}
</style>
```

### 2. MicroAppå…¨å±€é…ç½®

```typescript
// main-app/src/micro/index.ts
import microApp from '@micro-zoe/micro-app';

// MicroAppå…¨å±€é…ç½®
export function initMicroApp() {
  microApp.start({
    // æ˜¯å¦å¼€å¯shadowDOM
    shadowDOM: true,

    // æ˜¯å¦å¼€å¯è‡ªå®šä¹‰æ ·å¼
    inline: false,

    // ç”Ÿå‘½å‘¨æœŸé’©å­
    lifeCycles: {
      created(e: CustomEvent) {
        console.log('%c [MicroApp] å­åº”ç”¨åˆ›å»º', 'color: #42b983', e.detail);
      },
      mounted(e: CustomEvent) {
        console.log('%c [MicroApp] å­åº”ç”¨æŒ‚è½½', 'color: #42b983', e.detail);
        // é€šçŸ¥ä¸»åº”ç”¨æ›´æ–°æ ‡é¢˜
        document.title = `${e.detail.title} - ç”µå•†å¹³å°`;
      },
      unmount(e: CustomEvent) {
        console.log('%c [MicroApp] å­åº”ç”¨å¸è½½', 'color: #f56c6c', e.detail);
      },
      error(e: CustomEvent) {
        console.error('%c [MicroApp] å­åº”ç”¨é”™è¯¯', 'color: #f56c6c', e.detail);
      },
    },

    // å…¨å±€æ•°æ®ç›‘å¬
    globalAssets: {
      // å…¨å±€CSS
      css: [],
      // å…¨å±€JS
      js: [],
    },

    // æ’ä»¶ç³»ç»Ÿ
    plugins: {
      // æ•°æ®ä¸­å¿ƒæ’ä»¶ï¼ˆç”¨äºä¸»å­åº”ç”¨é€šä¿¡ï¼‰
      globalData: {
        setData: (data: any) => {
          console.log('è®¾ç½®å…¨å±€æ•°æ®:', data);
        },
        getData: () => {
          return {};
        },
      },
    },

    // é¢„åŠ è½½ç­–ç•¥
    preFetchApps: (appNameList: string[]) => {
      // æ ¹æ®ç”¨æˆ·è¡Œä¸ºé¢„æµ‹è¦åŠ è½½çš„åº”ç”¨
      return appNameList.filter(name => ['home', 'product'].includes(name));
    },

    // è‡ªå®šä¹‰æ¸²æŸ“
    customFetch: (url: string, options: RequestInit) => {
      // æ·»åŠ è®¤è¯token
      const token = localStorage.getItem('token');
      if (token) {
        options.headers = {
          ...options.headers,
          Authorization: `Bearer ${token}`,
        };
      }
      return window.fetch(url, options);
    },
  });
}
```

### 3. ä¸»å­åº”ç”¨é€šä¿¡

**ä¸»åº”ç”¨æä¾›æ•°æ®**

```typescript
// main-app/src/micro/communication.ts
import microApp from '@micro-zoe/micro-app';

// ä¸»åº”ç”¨å‘å­åº”ç”¨å‘é€æ•°æ®
export function sendDataToSubApp(appName: string, data: any) {
  const appElement = document.querySelector(`micro-app[name="${appName}"]`) as any;

  if (appElement) {
    // ä½¿ç”¨MicroAppçš„æ•°æ®é€šä¿¡æœºåˆ¶
    appElement.dispatchEvent(new CustomEvent('main-data', {
      detail: data,
    }));

    // æˆ–è€…ä½¿ç”¨microAppçš„å…¨å±€æ•°æ®ä¸­å¿ƒ
    microApp.setData(appName, data);
  }
}

// ç›‘å¬å­åº”ç”¨å‘é€çš„æ•°æ®
export function listenToSubApp(appName: string, callback: (data: any) => void) {
  const appElement = document.querySelector(`micro-app[name="${appName}"]`) as any;

  if (appElement) {
    appElement.addEventListener('data-change', (e: CustomEvent) => {
      callback(e.detail);
    });
  }
}

// è®¾ç½®å…¨å±€æ•°æ®ï¼ˆæ‰€æœ‰å­åº”ç”¨éƒ½å¯è®¿é—®ï¼‰
export function setGlobalData(key: string, value: any) {
  microApp.setGlobalData({ [key]: value });
}

// è·å–å…¨å±€æ•°æ®
export function getGlobalData(key: string) {
  return microApp.getGlobalData(key);
}
```

**å­åº”ç”¨æ¥æ”¶æ•°æ®**

```typescript
// sub-apps/product-app/src/main.ts
import { createApp } from 'vue';
import App from './App.vue';
import router from './router';

let app: any;

// ç›‘å¬ä¸»åº”ç”¨ä¼ é€’çš„æ•°æ®
if (window.__MICRO_APP_ENVIRONMENT__) {
  // MicroAppç¯å¢ƒ
  window.addEventListener('main-data', (event: any) => {
    console.log('æ”¶åˆ°ä¸»åº”ç”¨æ•°æ®:', event.detail);
    const { user, token, cart } = event.detail;

    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨æˆ–çŠ¶æ€ç®¡ç†
    if (user) {
      localStorage.setItem('user', JSON.stringify(user));
    }
    if (token) {
      localStorage.setItem('token', token);
    }
  });

  // è·å–å…¨å±€æ•°æ®
  window.microApp.addDataListener((data: any) => {
    console.log('æ”¶åˆ°å…¨å±€æ•°æ®å˜åŒ–:', data);
  });
}

export async function bootstrap() {
  console.log('ProductApp bootstrap');
}

export async function mount() {
  console.log('ProductApp mount');

  app = createApp(App);
  app.use(router);
  app.mount('#app');
}

export async function unmount() {
  console.log('ProductApp unmount');
  app?.unmount();
}

// ç‹¬ç«‹è¿è¡Œç¯å¢ƒ
if (!window.__MICRO_APP_ENVIRONMENT__) {
  mount();
}
```

**å­åº”ç”¨å‘ä¸»åº”ç”¨å‘é€æ•°æ®**

```typescript
// sub-apps/cart-app/src/views/CartList.vue
<script setup lang="ts">
import { onMounted } from 'vue';

// å‘ä¸»åº”ç”¨å‘é€è´­ç‰©è½¦æ›´æ–°
function updateCart() {
  if (window.__MICRO_APP_ENVIRONMENT__) {
    // æ–¹å¼1ï¼šé€šè¿‡dispatchEvent
    window.dispatchEvent(new CustomEvent('cart-update', {
      detail: {
        type: 'cart_update',
        payload: {
          itemCount: 5,
          totalAmount: 299.99,
        }
      }
    }));

    // æ–¹å¼2ï¼šé€šè¿‡microAppå…¨å±€æ•°æ®
    window.microApp.dispatch({
      type: 'cart_update',
      payload: {
        itemCount: 5,
        totalAmount: 299.99,
      }
    });
  }
}

onMounted(() => {
  // è·å–ä¸»åº”ç”¨ä¼ é€’çš„ç”¨æˆ·ä¿¡æ¯
  window.microApp.addDataListener((data: any) => {
    console.log('ä¸»åº”ç”¨æ•°æ®å˜åŒ–:', data);
    if (data.user) {
      // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    }
    if (data.cart) {
      // æ›´æ–°è´­ç‰©è½¦
    }
  });
});
</script>
```

### 4. å­åº”ç”¨é…ç½®

**å­åº”ç”¨å…¥å£ï¼ˆé›¶ä¾µå…¥ï¼ï¼‰**

```typescript
// sub-apps/product-app/src/main.ts
import { createApp } from 'vue';
import { createPinia } from 'pinia';
import ElementPlus from 'element-plus';
import 'element-plus/dist/index.css';

import App from './App.vue';
import router from './router';

let app: any;

// MicroAppä¼šè‡ªåŠ¨è°ƒç”¨è¿™äº›ç”Ÿå‘½å‘¨æœŸ
export async function bootstrap() {
  console.log('[ProductApp] bootstrap');
}

export async function mount() {
  console.log('[ProductApp] mount');

  app = createApp(App);

  app.use(createPinia());
  app.use(router);
  app.use(ElementPlus);

  app.mount('#app'); // æ³¨æ„ï¼šMicroAppè¦æ±‚å­åº”ç”¨å¿…é¡»æŒ‚è½½åˆ°#app
}

export async function unmount() {
  console.log('[ProductApp] unmount');
  app?.unmount();
}

// ç‹¬ç«‹è¿è¡Œç¯å¢ƒï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
if (!window.__MICRO_APP_ENVIRONMENT__) {
  mount();
}
```

**å­åº”ç”¨è·¯ç”±é…ç½®**

```typescript
// sub-apps/product-app/src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router';

const router = createRouter({
  // MicroAppç¯å¢ƒä½¿ç”¨baserouteï¼Œç‹¬ç«‹ç¯å¢ƒä½¿ç”¨æ ¹è·¯å¾„
  history: createWebHistory(
    window.__MICRO_APP_ENVIRONMENT__
      ? '/product'  // å¿…é¡»ä¸ä¸»åº”ç”¨é…ç½®çš„baserouteä¸€è‡´
      : '/'
  ),
  routes: [
    {
      path: '/',
      redirect: '/list',
    },
    {
      path: '/list',
      name: 'ProductList',
      component: () => import('../views/ProductList.vue'),
      meta: { title: 'å•†å“åˆ—è¡¨' },
    },
    {
      path: '/detail/:id',
      name: 'ProductDetail',
      component: () => import('../views/ProductDetail.vue'),
      meta: { title: 'å•†å“è¯¦æƒ…' },
    },
    {
      path: '/search',
      name: 'ProductSearch',
      component: () => import('../views/ProductSearch.vue'),
      meta: { title: 'å•†å“æœç´¢' },
    },
  ],
});

router.beforeEach((to, from, next) => {
  // è®¾ç½®é¡µé¢æ ‡é¢˜
  if (to.meta.title) {
    // MicroAppä¼šè‡ªåŠ¨æ›´æ–°ä¸»åº”ç”¨æ ‡é¢˜
    document.title = `${to.meta.title} - ç”µå•†å¹³å°`;
  }
  next();
});

export default router;
```

**å­åº”ç”¨Viteé…ç½®**

```typescript
// sub-apps/product-app/vite.config.ts
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';

export default defineConfig({
  plugins: [vue()],

  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },

  server: {
    port: 3002,
    cors: true, // å¿…é¡»å¼€å¯è·¨åŸŸ
    origin: 'http://localhost:3000', // ä¸»åº”ç”¨åœ°å€
  },

  build: {
    // MicroAppæ¨èä½¿ç”¨libæ¨¡å¼
    lib: {
      entry: './src/main.ts',
      name: 'ProductApp',
      formats: ['es', 'umd'],
      fileName: 'product-app',
    },

    rollupOptions: {
      // å¤–éƒ¨åŒ–Vueç›¸å…³ä¾èµ–
      external: ['vue', 'vue-router', 'pinia', 'element-plus'],
      output: {
        globals: {
          vue: 'Vue',
          'vue-router': 'VueRouter',
          pinia: 'Pinia',
          'element-plus': 'ElementPlus',
        },
      },
    },
  },

  optimizeDeps: {
    exclude: ['product-app'],
  },
});
```

### 5. æ€§èƒ½ä¼˜åŒ–

**é¢„åŠ è½½ç­–ç•¥**

```typescript
// main-app/src/micro/prefetch.ts
import microApp from '@micro-zoe/micro-app';

// æ™ºèƒ½é¢„åŠ è½½
export function initPrefetchStrategy() {
  // ç›‘å¬ç”¨æˆ·è¡Œä¸ºï¼Œé¢„æµ‹å¯èƒ½è®¿é—®çš„å­åº”ç”¨
  let prefetchTimer: any;

  document.addEventListener('mousemove', (e) => {
    clearTimeout(prefetchTimer);

    prefetchTimer = setTimeout(() => {
      const target = e.target as HTMLElement;

      // é¼ æ ‡æ‚¬åœåœ¨å¯¼èˆªé“¾æ¥ä¸Šæ—¶é¢„åŠ è½½
      if (target.tagName === 'A' && target.getAttribute('href')) {
        const href = target.getAttribute('href') || '';
        const appName = getAppNameFromPath(href);

        if (appName) {
          prefetchApp(appName);
        }
      }
    }, 300);
  });
}

// æ ¹æ®è·¯å¾„è·å–åº”ç”¨åç§°
function getAppNameFromPath(path: string): string | null {
  const appMap: Record<string, string> = {
    '/home': 'home',
    '/product': 'product',
    '/cart': 'cart',
  };

  for (const [key, value] of Object.entries(appMap)) {
    if (path.startsWith(key)) {
      return value;
    }
  }

  return null;
}

// é¢„åŠ è½½åº”ç”¨
export function prefetchApp(appName: string) {
  console.log('é¢„åŠ è½½åº”ç”¨:', appName);
  // MicroAppä¼šè‡ªåŠ¨å¤„ç†é¢„åŠ è½½
  microApp.preFetch({
    name: appName,
  });
}
```

**åº”ç”¨ç¼“å­˜**

```typescript
// main-app/src/micro/cache.ts
const appCache = new Map<string, any>();

export const cacheManager = {
  // ç¼“å­˜åº”ç”¨æ•°æ®
  set(appName: string, key: string, value: any) {
    if (!appCache.has(appName)) {
      appCache.set(appName, new Map());
    }
    appCache.get(appName).set(key, value);
  },

  // è·å–ç¼“å­˜æ•°æ®
  get(appName: string, key: string) {
    return appCache.get(appName)?.get(key);
  },

  // æ¸…é™¤åº”ç”¨ç¼“å­˜
  clear(appName: string) {
    appCache.delete(appName);
  },

  // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
  clearAll() {
    appCache.clear();
  },
};
```

### 6. æ ·å¼éš”ç¦»æ–¹æ¡ˆ

**MicroAppæä¾›3ç§æ ·å¼éš”ç¦»**

```vue
<!-- æ–¹å¼1ï¼šShadowDOMéš”ç¦»ï¼ˆæ¨èï¼‰ -->
<template>
  <micro-app
    name="product"
    url="http://localhost:3002"
    :shadowDOM="true"
  />
</template>

<!-- æ–¹å¼2ï¼šä½œç”¨åŸŸæ ·å¼ -->
<template>
  <micro-app
    name="product"
    url="http://localhost:3002"
    :shadowDOM="false"
    scopecss="true"
  />
</template>

<!-- æ–¹å¼3ï¼šæ— éš”ç¦»ï¼ˆä¸æ¨èï¼‰ -->
<template>
  <micro-app
    name="product"
    url="http://localhost:3002"
    :shadowDOM="false"
  />
</template>
```

**å­åº”ç”¨æ ·å¼å¤„ç†**

```scss
// å­åº”ç”¨ä¸­çš„æ ·å¼ä¼šè‡ªåŠ¨è¢«éš”ç¦»
// æ— éœ€ä»»ä½•ç‰¹æ®Šå¤„ç†ï¼

.product-list {
  padding: 20px;

  h1 {
    color: #333;
  }
}
```

---

## éƒ¨ç½²æŒ‡å—

### 1. å¼€å‘ç¯å¢ƒ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourorg/microapp-ecommerce.git
cd microapp-ecommerce

# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨æ‰€æœ‰åº”ç”¨ï¼ˆå¹¶å‘ï¼‰
pnpm dev

# æˆ–å•ç‹¬å¯åŠ¨
pnpm dev:main      # ä¸»åº”ç”¨ :3000
pnpm dev:home      # é¦–é¡µåº”ç”¨ :3001
pnpm dev:product   # å•†å“åº”ç”¨ :3002
pnpm dev:cart      # è´­ç‰©è½¦ :3003
pnpm dev:order     # è®¢å•åº”ç”¨ :3004
pnpm dev:user      # ç”¨æˆ·åº”ç”¨ :3005
pnpm dev:marketing # è¥é”€åº”ç”¨ :3006
```

### 2. ç”Ÿäº§æ„å»º

```bash
# æ„å»ºæ‰€æœ‰åº”ç”¨
pnpm build

# æ„å»ºå•ä¸ªåº”ç”¨
pnpm build:main
pnpm build:product
```

### 3. Nginxé…ç½®

```nginx
# /etc/nginx/conf.d/microapp-ecommerce.conf
server {
    listen 80;
    server_name app.example.com;

    # ä¸»åº”ç”¨
    location / {
        root /var/www/main-app;
        try_files $uri $uri/ /index.html;
    }

    # é¦–é¡µåº”ç”¨
    location /home {
        root /var/www/sub-apps/home-app;
        try_files $uri $uri/ /index.html;
    }

    # å•†å“åº”ç”¨
    location /product {
        root /var/www/sub-apps/product-app;
        try_files $uri $uri/ /index.html;
    }

    # è´­ç‰©è½¦åº”ç”¨
    location /cart {
        root /var/www/sub-apps/cart-app;
        try_files $uri $uri/ /index.html;
    }

    # è®¢å•åº”ç”¨
    location /order {
        root /var/www/sub-apps/order-app;
        try_files $uri $uri/ /index.html;
    }

    # ç”¨æˆ·åº”ç”¨
    location /user {
        root /var/www/sub-apps/user-app;
        try_files $uri $uri/ /index.html;
    }

    # è¥é”€åº”ç”¨
    location /marketing {
        root /var/www/sub-apps/marketing-app;
        try_files $uri $uri/ /index.html;
    }

    # å¯ç”¨gzipå‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # ç¼“å­˜é…ç½®
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### 4. Dockeréƒ¨ç½²

```dockerfile
# Dockerfile (ä¸»åº”ç”¨)
FROM node:18-alpine as builder

WORKDIR /app
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm@8
RUN pnpm install --frozen-lockfile

COPY . .
RUN pnpm build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

---

## MicroApp vs qiankun å®æˆ˜å¯¹æ¯”

| åœºæ™¯ | MicroApp | qiankun |
|------|----------|---------|
| **å­åº”ç”¨æ¥å…¥** | âœ… é›¶ä¾µå…¥ï¼Œæ— éœ€ä¿®æ”¹ | âš ï¸ éœ€è¦ä¿®æ”¹ç”Ÿå‘½å‘¨æœŸ |
| **æ¥å…¥æ—¶é—´** | âœ… 5åˆ†é’Ÿ | âš ï¸ 30åˆ†é’Ÿ |
| **æ ·å¼éš”ç¦»** | âœ… ShadowDOMè‡ªåŠ¨éš”ç¦» | âœ… scopedæ ·å¼ |
| **JSæ²™ç®±** | âœ… å®Œæ•´æ²™ç®± | âœ… Proxyæ²™ç®± |
| **æ€§èƒ½** | âœ… å¿«40%+ | âš ï¸ æ­£å¸¸ |
| **å†…å­˜å ç”¨** | âœ… æ›´ä½ | âš ï¸ è¾ƒé«˜ |
| **å­¦ä¹ æ›²çº¿** | âœ… æ›´ç®€å• | âš ï¸ ç›¸å¯¹å¤æ‚ |
| **æ–‡æ¡£è´¨é‡** | âœ… ä¸­æ–‡æ–‡æ¡£å®Œå–„ | âœ… æ–‡æ¡£å®Œå–„ |
| **ç¤¾åŒºæ´»è·ƒ** | âœ… äº¬ä¸œç»´æŠ¤ | âœ… é˜¿é‡Œç»´æŠ¤ |

---

## å­¦ä¹ æˆæœ

å®Œæˆæœ¬é¡¹ç›®åï¼Œä½ å°†æŒæ¡ï¼š

âœ… **MicroAppæ¡†æ¶**
- é›¶ä¾µå…¥å­åº”ç”¨æ¥å…¥
- ShadowDOMæ ·å¼éš”ç¦»
- å®Œæ•´çš„JSæ²™ç®±æœºåˆ¶
- é«˜æ€§èƒ½æ¸²æŸ“

âœ… **å¾®å‰ç«¯æ¶æ„**
- ä¸»å­åº”ç”¨è®¾è®¡
- é€šä¿¡æœºåˆ¶å®ç°
- çŠ¶æ€å…±äº«æ–¹æ¡ˆ
- ç”Ÿå‘½å‘¨æœŸç®¡ç†

âœ… **ç”µå•†å¹³å°å®æˆ˜**
- å¤šåº”ç”¨ååŒ
- è´­ç‰©è½¦è·¨åº”ç”¨åŒæ­¥
- è®¢å•æµç¨‹å®ç°
- ç”¨æˆ·ä¸­å¿ƒç®¡ç†

âœ… **æ€§èƒ½ä¼˜åŒ–**
- æ™ºèƒ½é¢„åŠ è½½
- åº”ç”¨ç¼“å­˜ç­–ç•¥
- èµ„æºæ‡’åŠ è½½
- æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

âœ… **å·¥ç¨‹åŒ–å®è·µ**
- Monorepoç®¡ç†
- TypeScripté…ç½®
- CI/CDæµç¨‹
- Dockerå®¹å™¨åŒ–

---

## æ‰©å±•ç»ƒä¹ 

- [ ] å®ç°å­åº”ç”¨çƒ­æ›´æ–°
- [ ] æ·»åŠ åº”ç”¨ç‰ˆæœ¬ç®¡ç†
- [ ] å®ç°ç°åº¦å‘å¸ƒ
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§
- [ ] å®ç°å­åº”ç”¨é™çº§

---

## MicroAppèµ„æº

- **å®˜æ–¹æ–‡æ¡£**ï¼šhttps://micro-zoe.github.io/micro-app/
- **GitHub**ï¼šhttps://github.com/micro-zoe/micro-app
- **äº¬ä¸œå®è·µ**ï¼šhttps://mp.weixin.qq.com/s/xxx
- **å¯¹æ¯”åˆ†æ**ï¼šMicroApp vs qiankunæ€§èƒ½æµ‹è¯•

---

**é¡¹ç›®éš¾åº¦**ï¼šâ­â­â­â­â­
**é¢„è®¡æ—¶é—´**ï¼š80-100å°æ—¶
**é€‚åˆäººç¾¤**ï¼šæœ‰Vue3åŸºç¡€ï¼Œæƒ³å­¦ä¹ äº¬ä¸œMicroAppå¾®å‰ç«¯æ¡†æ¶
